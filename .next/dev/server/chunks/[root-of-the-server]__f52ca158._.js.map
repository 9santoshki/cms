{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/db.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase clients\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.error('Error: Supabase environment variables not set');\n  console.log('Please make sure .env.local file contains:');\n  console.log('NEXT_PUBLIC_SUPABASE_URL=');\n  console.log('NEXT_PUBLIC_SUPABASE_ANON_KEY=');\n}\n\nconst supabase = supabaseUrl && supabaseAnonKey ? createClient(supabaseUrl, supabaseAnonKey) : null;\nconst supabaseWithServiceRole = supabaseServiceRoleKey \n  ? createClient(supabaseUrl!, supabaseServiceRoleKey) \n  : null;\n\n// Define types to maintain compatibility with existing code\ntype QueryResult = {\n  rows: any[];\n  rowCount: number;\n  error?: any;\n};\n\n// Function to run authenticated queries for cart operations using service role\nexport async function runAuthenticatedQuery<T>(\n  userId: number,\n  queryFn: (client: any) => Promise<any>\n): Promise<QueryResult> {\n  if (!supabaseWithServiceRole) {\n    console.error('Error: SUPABASE_SERVICE_ROLE_KEY is not set');\n    return {\n      rows: [],\n      rowCount: 0,\n      error: new Error('Missing SUPABASE_SERVICE_ROLE_KEY in environment variables')\n    };\n  }\n\n  try {\n    // Run the query using the service role client to bypass RLS temporarily\n    const result = await queryFn(supabaseWithServiceRole);\n    return {\n      rows: Array.isArray(result.data) ? result.data : (result.data ? [result.data] : []),\n      rowCount: result.data ? (Array.isArray(result.data) ? result.data.length : 1) : 0,\n      error: result.error || null\n    };\n  } catch (error: any) {\n    return {\n      rows: [],\n      rowCount: 0,\n      error: error\n    };\n  }\n}\n\n// Function to run direct SQL queries using service role for cart operations\nexport async function runAuthenticatedSqlQuery(\n  sql: string,\n  params?: any[]\n): Promise<QueryResult> {\n  if (!supabaseWithServiceRole) {\n    console.error('Error: SUPABASE_SERVICE_ROLE_KEY is not set');\n    return {\n      rows: [],\n      rowCount: 0,\n      error: new Error('Missing SUPABASE_SERVICE_ROLE_KEY in environment variables')\n    };\n  }\n\n  try {\n    // Parse the SQL to determine table and operation\n    const sqlLower = sql.toLowerCase().trim();\n\n    if (sqlLower.startsWith('select')) {\n      // Parse SELECT query using regex\n      const selectMatch = sql.match(/select\\s+(.*?)\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*/i);\n      if (!selectMatch) {\n        throw new Error('Could not parse SELECT query');\n      }\n\n      const columns = selectMatch[1].trim();\n      const tableName = selectMatch[2].trim();\n\n      // Handle WHERE clause\n      let queryBuilder = supabaseWithServiceRole.from(tableName).select(columns === '*' ? '*' : columns);\n\n      if (sqlLower.includes('where')) {\n        const whereRegex = /where\\s+(.*?)(?:\\s+order\\s+by|\\s+limit|\\s+group\\s+by|$)/i;\n        const whereMatch = sql.match(whereRegex);\n\n        if (whereMatch && whereMatch[1]) {\n          const whereClause = whereMatch[1].trim();\n\n          // Handle different where patterns\n          if (whereClause.includes('user_id = $1') && params && params.length >= 1) {\n            queryBuilder = queryBuilder.eq('user_id', params[0]);\n          } else if (whereClause.includes('user_id = $1 AND product_id = $2') && params && params.length >= 2) {\n            queryBuilder = queryBuilder.eq('user_id', params[0]).eq('product_id', params[1]);\n          } else if (whereClause.includes('product_id = $1') && params && params.length >= 1) {\n            queryBuilder = queryBuilder.eq('product_id', params[0]);\n          }\n        }\n      }\n\n      const response = await queryBuilder;\n      if (response.error) {\n        return {\n          rows: [],\n          rowCount: 0,\n          error: response.error\n        };\n      }\n\n      return {\n        rows: Array.isArray(response.data) ? response.data : (response.data ? [response.data] : []),\n        rowCount: response.data ? (Array.isArray(response.data) ? response.data.length : 1) : 0,\n        error: null\n      };\n    } \n    else if (sqlLower.startsWith('insert')) {\n      // Parse INSERT statement\n      const insertMatch = sql.match(/insert\\s+into\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(\\s*([^)]+)\\s*\\)\\s+values\\s*\\(\\s*([^)]+)\\s*\\)/i);\n      if (!insertMatch) {\n        throw new Error('Could not parse INSERT query');\n      }\n\n      const tableName = insertMatch[1];\n      const columnsStr = insertMatch[2];\n      const columns = columnsStr.replace(/\\s/g, '').split(','); // Remove spaces and split by comma\n\n      if (!params || params.length === 0) {\n        throw new Error('INSERT query has no parameters');\n      }\n\n      // Create an object mapping columns to parameter values\n      const insertData: any = {};\n      for (let i = 0; i < columns.length && i < params.length; i++) {\n        insertData[columns[i]] = params[i];\n      }\n\n      const response = await supabaseWithServiceRole\n        .from(tableName)\n        .insert(insertData)\n        .select();\n\n      if (response.error) {\n        return {\n          rows: [],\n          rowCount: 0,\n          error: response.error\n        };\n      }\n\n      return {\n        rows: Array.isArray(response.data) ? response.data : (response.data ? [response.data] : []),\n        rowCount: response.data ? (Array.isArray(response.data) ? response.data.length : 1) : 0,\n        error: null\n      };\n    }\n    else if (sqlLower.startsWith('update')) {\n      // Parse UPDATE statement\n      const updateMatch = sql.match(/update\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+set\\s+(.*?)\\s+where\\s+(.*)/i);\n      if (!updateMatch) {\n        throw new Error('Could not parse UPDATE query');\n      }\n\n      const tableName = updateMatch[1];\n      const setClause = updateMatch[2];\n      const whereClause = updateMatch[3];\n\n      // Parse SET clause: col1=$1, col2=$2, etc.\n      const setData: any = {};\n      const setParts = setClause.split(',').map(p => p.trim());\n      let paramIndex = 0;\n      setParts.forEach(part => {\n        const [key, value] = part.split('=').map(p => p.trim());\n        // Map $1, $2 etc to actual parameter values\n        setData[key] = params![paramIndex];\n        paramIndex++;\n      });\n\n      // Parse WHERE clause: col=$n, etc.\n      const whereConditions: any = {};\n      const whereParts = whereClause.split('AND').map(p => p.trim());\n      whereParts.forEach(part => {\n        const [key, valuePlaceholder] = part.split('=').map(p => p.trim());\n        // Assuming the valuePlaceholder is like $1, $2, etc.\n        const paramNum = parseInt(valuePlaceholder.substring(1)) - 1; // Convert $2 to index 1\n        whereConditions[key] = params![paramNum];\n      });\n\n      const response = await supabaseWithServiceRole\n        .from(tableName)\n        .update(setData)\n        .match(whereConditions)\n        .select();\n\n      if (response.error) {\n        return {\n          rows: [],\n          rowCount: 0,\n          error: response.error\n        };\n      }\n\n      return {\n        rows: Array.isArray(response.data) ? response.data : (response.data ? [response.data] : []),\n        rowCount: response.data ? (Array.isArray(response.data) ? response.data.length : 1) : 0,\n        error: null\n      };\n    }\n    else if (sqlLower.startsWith('delete')) {\n      // Parse DELETE statement\n      const deleteMatch = sql.match(/delete\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+where\\s+(.*)/i);\n      if (!deleteMatch) {\n        throw new Error('Could not parse DELETE query');\n      }\n\n      const tableName = deleteMatch[1];\n      const whereClause = deleteMatch[2];\n\n      // Parse WHERE clause\n      const whereConditions: any = {};\n      const whereParts = whereClause.split('AND').map(p => p.trim());\n      let paramIndex = 0;\n      whereParts.forEach(part => {\n        const [key, valuePlaceholder] = part.split('=').map(p => p.trim());\n        // Assuming the valuePlaceholder is like $1, $2, etc.\n        whereConditions[key] = params![paramIndex];\n        paramIndex++;\n      });\n\n      const response = await supabaseWithServiceRole\n        .from(tableName)\n        .delete()\n        .match(whereConditions);\n\n      if (response.error) {\n        return {\n          rows: [],\n          rowCount: 0,\n          error: response.error\n        };\n      }\n\n      return {\n        rows: response.data ? [response.data] : [],\n        rowCount: response.data ? 1 : 0,\n        error: null\n      };\n    }\n    else {\n      throw new Error(`Unsupported SQL operation: ${sql.substring(0, 20)}...`);\n    }\n  } catch (error: any) {\n    return {\n      rows: [],\n      rowCount: 0,\n      error: error\n    };\n  }\n}\n\ninterface DatabaseClientInterface {\n  query: (text: string, params?: any[]) => Promise<QueryResult>;\n  from: (table: string) => any;\n  select: (columns?: string) => any;\n  insert: (data: any) => any;\n  update: (data: any) => any;\n  delete: () => any;\n}\n\n// Create a wrapper that provides both direct query method and Supabase methods\nconst db: DatabaseClientInterface = {\n  // Direct query method that translates SQL to Supabase calls\n  query: async (sql: string, params?: any[]): Promise<QueryResult> => {\n    if (!supabase) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error: new Error('Supabase client not initialized')\n      };\n    }\n\n    try {\n      // Parse SQL to determine operation type\n      const sqlLower = sql.toLowerCase().trim();\n      \n      if (sqlLower.startsWith('select')) {\n        // Parse SELECT query\n        const selectMatch = sql.match(/select\\s+(.*?)\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*/i);\n        if (!selectMatch) {\n          throw new Error('Could not parse SELECT query');\n        }\n\n        const columns = selectMatch[1].trim();\n        const tableName = selectMatch[2].trim();\n\n        // Check if there's a WHERE clause\n        const hasWhere = sqlLower.includes('where');\n        let queryBuilder = supabase.from(tableName).select(columns === '*' ? '*' : columns);\n\n        if (hasWhere) {\n          // Extract WHERE clause parts\n          const whereRegex = /where\\s+(.*?)(?:\\s+order\\s+by|\\s+limit|\\s+group\\s+by|$)/i;\n          const whereMatch = sql.match(whereRegex);\n\n          if (whereMatch && whereMatch[1]) {\n            const whereClause = whereMatch[1].trim();\n            \n            // Handle different WHERE patterns with parameters\n            if (whereClause.includes('email = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('email', params[0]);\n            } else if (whereClause.includes('user_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]);\n            } else if (whereClause.includes('id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('id', params[0]);\n            } else if (whereClause.includes('product_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('product_id', params[0]);\n            } else if (whereClause.includes('user_id = $1 AND product_id = $2') && params && params.length >= 2) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]).eq('product_id', params[1]);\n            } else if (whereClause.includes('slug = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('slug', params[0]);\n            } else {\n              // Generic handling for other patterns - need to extract column name and parameter\n              const genericPattern = /([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*\\$(\\d+)/;\n              const match = whereClause.match(genericPattern);\n              if (match && params && params.length >= parseInt(match[2])) {\n                const col = match[1];\n                const paramIdx = parseInt(match[2]) - 1;\n                queryBuilder = queryBuilder.eq(col, params[paramIdx]);\n              }\n            }\n          }\n        }\n\n        const { data, error } = await queryBuilder;\n        if (error) {\n          return {\n            rows: [],\n            rowCount: 0,\n            error\n          };\n        }\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error: null\n        };\n      } \n      else if (sqlLower.startsWith('insert')) {\n        // Parse INSERT query\n        const insertMatch = sql.match(/insert\\s+into\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(\\s*([^)]+)\\s*\\)\\s+values\\s*\\(\\s*([^)]+)\\s*\\)/i);\n        if (!insertMatch) {\n          throw new Error('Could not parse INSERT query');\n        }\n\n        const tableName = insertMatch[1];\n        const columnsStr = insertMatch[2];\n        const columns = columnsStr.replace(/\\s/g, '').split(','); // Remove spaces and split by comma\n\n        if (!params || params.length === 0) {\n          throw new Error('INSERT query has no parameters');\n        }\n\n        // Create an object mapping columns to parameter values\n        const insertData: any = {};\n        for (let i = 0; i < columns.length && i < params.length; i++) {\n          insertData[columns[i]] = params[i];\n        }\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .insert(insertData)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      } \n      else if (sqlLower.startsWith('update')) {\n        // Parse UPDATE query\n        const updateMatch = sql.match(/update\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+set\\s+(.*?)\\s+where\\s+(.*)/i);\n        if (!updateMatch) {\n          throw new Error('Could not parse UPDATE query');\n        }\n\n        const tableName = updateMatch[1];\n        const setClause = updateMatch[2];\n        const whereClause = updateMatch[3];\n\n        // Parse SET clause: col1=$1, col2=$2, etc.\n        const setData: any = {};\n        const setParts = setClause.split(',').map(p => p.trim());\n        let paramIndex = 0;\n        setParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          setData[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        // Parse WHERE clause: col=$n, etc.\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        whereParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values  \n          const paramNum = parseInt(value.substring(1)) - 1; // Convert $2 to index 1\n          whereConditions[key] = params![paramNum];\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .update(setData)\n          .match(whereConditions)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      } \n      else if (sqlLower.startsWith('delete')) {\n        // Parse DELETE query\n        const deleteMatch = sql.match(/delete\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+where\\s+(.*)/i);\n        if (!deleteMatch) {\n          throw new Error('Could not parse DELETE query');\n        }\n\n        const tableName = deleteMatch[1];\n        const whereClause = deleteMatch[2];\n\n        // Parse WHERE clause\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        let paramIndex = 0;\n        whereParts.forEach(part => {\n          const [key, valuePlaceholder] = part.split('=').map(p => p.trim());\n          // Assuming the valuePlaceholder is like $1, $2, etc.\n          whereConditions[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .delete()\n          .match(whereConditions);\n\n        return {\n          rows: data ? [data] : [],\n          rowCount: data ? 1 : 0,\n          error\n        };\n      } \n      else {\n        throw new Error(`Unsupported SQL operation: ${sql.substring(0, 20)}...`);\n      }\n    } catch (error: any) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error\n      };\n    }\n  },\n  \n  // Supabase methods\n  from: (table: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from(table);\n  },\n  \n  select: (columns?: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').select(columns); // Default to 'users', caller should use from() first\n  },\n  \n  insert: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').insert(data); // Default to 'users', caller should use from() first\n  },\n  \n  update: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').update(data); // Default to 'users', caller should use from() first\n  },\n  \n  delete: () => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').delete(); // Default to 'users', caller should use from() first  \n  }\n};\n\nexport default db;\n\n// Export the supabase client for direct use if needed\nexport { supabase };"],"names":["createClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_ANON_KEY","supabaseServiceRoleKey","SUPABASE_SERVICE_ROLE_KEY","console","error","log","supabase","supabaseWithServiceRole","QueryResult","rows","rowCount","runAuthenticatedQuery","userId","queryFn","client","Promise","Error","result","Array","isArray","data","length","runAuthenticatedSqlQuery","sql","params","sqlLower","toLowerCase","trim","startsWith","selectMatch","match","columns","tableName","queryBuilder","from","select","includes","whereRegex","whereMatch","whereClause","eq","response","insertMatch","columnsStr","replace","split","insertData","i","insert","updateMatch","setClause","setData","setParts","map","p","paramIndex","forEach","part","key","value","whereConditions","whereParts","valuePlaceholder","paramNum","parseInt","substring","update","deleteMatch","delete","DatabaseClientInterface","query","text","table","db","hasWhere","genericPattern","col","paramIdx"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 513, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/cart/%5BproductId%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport db from '@/lib/db';\nimport { getToken } from 'next-auth/jwt';\nimport { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase client for email/password auth\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;\n\nlet supabase: any = null;\nif (supabaseUrl && supabaseAnonKey) {\n  supabase = createClient(supabaseUrl, supabaseAnonKey);\n}\n\n// Helper function to get user by token\nasync function getUserIdFromRequest(request: NextRequest): Promise<{ userId: number | null, authType: 'google' | 'email' | null }> {\n  // First try: NextAuth JWT token (Google auth)\n  try {\n    const token = await getToken({ req: request, secret: process.env.NEXTAUTH_SECRET });\n    if (token && (token.sub || token.id)) {\n      return await getUserIdFromNextAuthToken(token);\n    }\n  } catch (e) {\n    console.log('NextAuth token not found or invalid, trying Bearer token...');\n  }\n\n  // Second try: Custom Bearer token (email/password auth)\n  const authHeader = request.headers.get('authorization');\n  if (authHeader && authHeader.startsWith('Bearer ')) {\n    return await getUserIdFromBearerToken(authHeader);\n  }\n\n  return { userId: null, authType: null };\n}\n\n// Helper for NextAuth tokens\nasync function getUserIdFromNextAuthToken(token: any): Promise<{ userId: number | null, authType: 'google' }> {\n  let userIdValue = token.id || token.sub;\n\n  if (typeof userIdValue === 'number') {\n    userIdValue = userIdValue.toString();\n  } else if (typeof userIdValue !== 'string') {\n    throw new Error('Invalid userId type from token');\n  }\n\n  let userIdNum = parseInt(userIdValue as string, 10);\n\n  // Check if out of range (Google IDs are too large for PostgreSQL INT4)\n  if (isNaN(userIdNum) || userIdNum <= 0 || userIdNum > 2147483647 || userIdNum < -2147483648) {\n    // Try to find user by email first\n    if (token.email) {\n      const userByEmail = await db.query(\n        'SELECT id FROM users WHERE email = $1',\n        [token.email]\n      );\n\n      if (userByEmail.rows.length > 0) {\n        userIdNum = userByEmail.rows[0].id;\n        return { userId: userIdNum, authType: 'google' };\n      }\n    }\n\n    // Try google_id column\n    if (userIdValue) {\n      try {\n        const userLookup = await db.query(\n          'SELECT id FROM users WHERE google_id = $1',\n          [userIdValue as string]\n        );\n\n        if (userLookup.rows.length > 0) {\n          userIdNum = userLookup.rows[0].id;\n          return { userId: userIdNum, authType: 'google' };\n        }\n      } catch (e) {\n        // google_id column might not exist\n      }\n    }\n\n    throw new Error('User not found');\n  }\n\n  return { userId: userIdNum, authType: 'google' };\n}\n\n// Helper for Bearer tokens (email/password auth)\nasync function getUserIdFromBearerToken(authHeader: string): Promise<{ userId: number | null, authType: 'email' }> {\n  const token = authHeader.replace('Bearer ', '');\n\n  // Extract user ID from our mock token format: 'mock-jwt-token-for-user-{userId}'\n  const userTokenPattern = /mock-jwt-token-for-user-(\\d+)/;\n  const match = token.match(userTokenPattern);\n\n  if (match && match[1]) {\n    const userId = parseInt(match[1], 10);\n    if (!isNaN(userId) && userId > 0) {\n      // Verify that this user actually exists in the database\n      const { rows } = await db.query('SELECT id FROM users WHERE id = $1', [userId]);\n      if (rows.length > 0) {\n        return { userId: rows[0].id, authType: 'email' };\n      }\n    }\n  }\n\n  // Fallback: If we can't extract user from token, try to find a default user\n  const { rows } = await db.query(\n    \"SELECT id FROM users WHERE email = $1 LIMIT 1\",\n    ['john@example.com']\n  );\n\n  if (rows.length > 0) {\n    return { userId: rows[0].id, authType: 'email' };\n  }\n\n  throw new Error('User not found for Bearer token');\n}\n\nexport async function DELETE(\n  request: NextRequest,\n  context: { params: Promise<{ productId: string }> }\n) {\n  // Wait for params to be resolved in Next.js 13+ App Router\n  const params = await context.params;\n  const { productId } = params;  // This is the product ID, not cart item ID\n\n  try {\n    // Support both NextAuth and Bearer token authentication\n    const { userId, authType } = await getUserIdFromRequest(request);\n\n    // If user is authenticated, delete from database\n    if (userId && authType) {\n      // Validate the parsed userId\n      if (userId <= 0) {\n        console.error('Invalid userId from token');\n        return NextResponse.json(\n          { success: false, error: 'Invalid user authentication' },\n          { status: 401 }\n        );\n      }\n\n      if (!productId) {\n        return NextResponse.json(\n          { success: false, error: 'Product ID is required' },\n          { status: 400 }\n        );\n      }\n\n      const productIdNum = parseInt(productId);\n\n      if (isNaN(productIdNum) || productIdNum <= 0) {\n        return NextResponse.json(\n          { success: false, error: 'Invalid product ID' },\n          { status: 400 }\n        );\n      }\n\n      // First, check if the cart item exists\n      const checkResult = await db.query(\n        'SELECT id FROM cart_items WHERE user_id = $1 AND product_id = $2',\n        [userId, productIdNum]\n      );\n      \n      if (checkResult.rows.length === 0) {\n        return NextResponse.json(\n          {\n            success: false,\n            error: 'Cart item not found'\n          },\n          { status: 404 }\n        );\n      }\n\n      try {\n        const deleteQuery = `\n          DELETE FROM cart_items\n          WHERE user_id = $1 AND product_id = $2\n        `;\n        const result = await db.query(deleteQuery, [userId, productIdNum]);\n\n        if (result.error) {\n          throw result.error;\n        }\n\n        return NextResponse.json(\n          {\n            success: true,\n            message: 'Item removed from cart'\n          },\n          { status: 200 }\n        );\n      } catch (error) {\n        console.error('Error removing item from cart:', error);\n        return NextResponse.json(\n          {\n            success: false,\n            error: 'Internal server error'\n          },\n          { status: 500 }\n        );\n      }\n    } else {\n      // For unauthenticated users (local cart only), just return success\n      // The frontend will handle local cart item removal\n      if (!productId) {\n        return NextResponse.json(\n          { success: false, error: 'Product ID is required' },\n          { status: 400 }\n        );\n      }\n\n      return NextResponse.json(\n        {\n          success: true,\n          message: 'Item removed from cart'\n        },\n        { status: 200 }\n      );\n    }\n  } catch (error) {\n    console.error('Token verification error:', error);\n    // Still allow the operation for unauthenticated users\n    return NextResponse.json(\n      {\n        success: true,\n        message: 'Item removed from cart'\n      },\n      { status: 200 }\n    );\n  }\n}\n"],"names":["NextRequest","NextResponse","db","getToken","createClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_ANON_KEY","supabase","getUserIdFromRequest","request","Promise","userId","authType","token","req","secret","NEXTAUTH_SECRET","sub","id","getUserIdFromNextAuthToken","e","console","log","authHeader","headers","get","startsWith","getUserIdFromBearerToken","userIdValue","toString","Error","userIdNum","parseInt","isNaN","email","userByEmail","query","rows","length","userLookup","replace","userTokenPattern","match","DELETE","context","params","productId","error","json","success","status","productIdNum","checkResult","deleteQuery","result","message"],"mappings":"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","ignoreList":[],"debugId":null}}]
}