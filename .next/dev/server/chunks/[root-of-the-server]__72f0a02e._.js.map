{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/auth/register/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport bcrypt from 'bcryptjs';\nimport { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase client\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase configuration in environment variables');\n}\n\nconst supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { name, email, password } = await request.json();\n\n    if (!name || !email || !password) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Name, email, and password are required'\n        },\n        { status: 400 }\n      );\n    }\n\n    // Check if user already exists in database\n    const { data: existingUser, error: fetchError } = await supabase\n      .from('users')\n      .select('id')\n      .eq('email', email)\n      .single();\n\n    if (existingUser && !fetchError) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'User with this email already exists'\n        },\n        { status: 409 }\n      );\n    }\n\n    // Hash the password\n    const hashedPassword = await bcrypt.hash(password, 10);\n\n    // Insert new user into database\n    const { data: newUser, error: insertError } = await supabase\n      .from('users')\n      .insert([\n        {\n          name: name,\n          email: email,\n          encrypted_password: hashedPassword,\n          role: 'user', // Default role is 'user'\n          created_at: new Date().toISOString()\n        }\n      ])\n      .select()\n      .single();\n\n    if (insertError) {\n      console.error('Error inserting user:', insertError);\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Error creating user'\n        },\n        { status: 500 }\n      );\n    }\n\n    // Create user object for response (exclude password)\n    const user = {\n      id: newUser.id,\n      name: newUser.name,\n      email: newUser.email,\n      role: newUser.role,\n      created_at: newUser.created_at\n    };\n\n    const token = 'mock-jwt-token-for-development';\n\n    return NextResponse.json(\n      {\n        success: true,\n        data: { user, token }\n      },\n      { status: 201 }\n    );\n  } catch (error) {\n    console.error('Registration error:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Internal server error'\n      },\n      { status: 500 }\n    );\n  }\n}"],"names":["NextRequest","NextResponse","bcrypt","createClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_ANON_KEY","Error","supabase","POST","request","name","email","password","json","success","error","status","data","existingUser","fetchError","from","select","eq","single","hashedPassword","hash","newUser","insertError","insert","encrypted_password","role","created_at","Date","toISOString","console","user","id","token"],"mappings":"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","ignoreList":[],"debugId":null}}]
}