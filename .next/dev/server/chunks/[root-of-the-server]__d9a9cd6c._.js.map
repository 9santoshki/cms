{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/db.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase clients\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.error('Error: Supabase environment variables not set');\n  console.log('Please make sure .env.local file contains:');\n  console.log('NEXT_PUBLIC_SUPABASE_URL=');\n  console.log('NEXT_PUBLIC_SUPABASE_ANON_KEY=');\n}\n\nconst supabase = supabaseUrl && supabaseAnonKey ? createClient(supabaseUrl, supabaseAnonKey) : null;\n\n// Define types to maintain compatibility with existing code\ntype QueryResult = {\n  rows: any[];\n  rowCount: number;\n  error?: any;\n};\n\ninterface DatabaseClientInterface {\n  query: (text: string, params?: any[]) => Promise<QueryResult>;\n  from: (table: string) => any;\n  select: (columns?: string) => any;\n  insert: (data: any) => any;\n  update: (data: any) => any;\n  delete: () => any;\n}\n\n// Create a wrapper that provides both direct query method and Supabase methods\nconst db: DatabaseClientInterface = {\n  // Direct query method that translates SQL to Supabase calls\n  query: async (sql: string, params?: any[]): Promise<QueryResult> => {\n    if (!supabase) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error: new Error('Supabase client not initialized')\n      };\n    }\n\n    try {\n      // Parse SQL to determine operation type\n      const sqlLower = sql.toLowerCase().trim();\n\n      if (sqlLower.startsWith('select')) {\n        // Parse SELECT query - more flexible to handle WHERE clauses and other parts\n        let columns, tableName;\n        const selectMatch = sql.match(/select\\s+(.*?)\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)/i);\n        if (!selectMatch) {\n          throw new Error('Could not parse SELECT query');\n        }\n        columns = selectMatch[1].trim();\n        tableName = selectMatch[2].trim();\n\n        // Check if there's a WHERE clause\n        const hasWhere = sqlLower.includes('where');\n        let queryBuilder = supabase.from(tableName).select(columns === '*' ? '*' : columns);\n\n        if (hasWhere) {\n          // Extract WHERE clause parts\n          const whereRegex = /where\\s+(.*?)(?:\\s+order\\s+by|\\s+limit|\\s+group\\s+by|$)/i;\n          const whereMatch = sql.match(whereRegex);\n\n          if (whereMatch && whereMatch[1]) {\n            const whereClause = whereMatch[1].trim();\n\n            // Handle different WHERE patterns with parameters\n            if (whereClause.includes('email = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('email', params[0]);\n            } else if (whereClause.includes('user_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]);\n            } else if (whereClause.includes('id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('id', params[0]);\n            } else if (whereClause.includes('product_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('product_id', params[0]);\n            } else if (whereClause.includes('user_id = $1 AND product_id = $2') && params && params.length >= 2) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]).eq('product_id', params[1]);\n            } else if (whereClause.includes('slug = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('slug', params[0]);\n            } else {\n              // Generic handling for other patterns - need to extract column name and parameter\n              const genericPattern = /([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*\\$(\\d+)/;\n              const match = whereClause.match(genericPattern);\n              if (match && params && params.length >= parseInt(match[2])) {\n                const col = match[1];\n                const paramIdx = parseInt(match[2]) - 1;\n                queryBuilder = queryBuilder.eq(col, params[paramIdx]);\n              }\n            }\n          }\n        }\n\n        const { data, error } = await queryBuilder;\n        if (error) {\n          return {\n            rows: [],\n            rowCount: 0,\n            error\n          };\n        }\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error: null\n        };\n      }\n      else if (sqlLower.startsWith('insert')) {\n        // Parse INSERT query\n        const insertMatch = sql.match(/insert\\s+into\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(\\s*([^)]+)\\s*\\)\\s+values\\s*\\(\\s*([^)]+)\\s*\\)/i);\n        if (!insertMatch) {\n          throw new Error('Could not parse INSERT query');\n        }\n\n        const tableName = insertMatch[1];\n        const columnsStr = insertMatch[2];\n        const columns = columnsStr.replace(/\\s/g, '').split(','); // Remove spaces and split by comma\n\n        if (!params || params.length === 0) {\n          throw new Error('INSERT query has no parameters');\n        }\n\n        // Create an object mapping columns to parameter values\n        const insertData: any = {};\n        for (let i = 0; i < columns.length && i < params.length; i++) {\n          insertData[columns[i]] = params[i];\n        }\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .insert(insertData)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      }\n      else if (sqlLower.startsWith('update')) {\n        // Parse UPDATE query\n        const updateMatch = sql.match(/update\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+set\\s+(.*?)\\s+where\\s+(.*)/i);\n        if (!updateMatch) {\n          throw new Error('Could not parse UPDATE query');\n        }\n\n        const tableName = updateMatch[1];\n        const setClause = updateMatch[2];\n        const whereClause = updateMatch[3];\n\n        // Parse SET clause: col1=$1, col2=$2, etc.\n        const setData: any = {};\n        const setParts = setClause.split(',').map(p => p.trim());\n        let paramIndex = 0;\n        setParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          setData[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        // Parse WHERE clause: col=$n, etc.\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        whereParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          const paramNum = parseInt(value.substring(1)) - 1; // Convert $2 to index 1\n          whereConditions[key] = params![paramNum];\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .update(setData)\n          .match(whereConditions)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      }\n      else if (sqlLower.startsWith('delete')) {\n        // Parse DELETE query\n        const deleteMatch = sql.match(/delete\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+where\\s+(.*)/i);\n        if (!deleteMatch) {\n          throw new Error('Could not parse DELETE query');\n        }\n\n        const tableName = deleteMatch[1];\n        const whereClause = deleteMatch[2];\n\n        // Parse WHERE clause\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        let paramIndex = 0;\n        whereParts.forEach(part => {\n          const [key, valuePlaceholder] = part.split('=').map(p => p.trim());\n          // Assuming the valuePlaceholder is like $1, $2, etc.\n          whereConditions[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .delete()\n          .match(whereConditions);\n\n        return {\n          rows: data ? [data] : [],\n          rowCount: data ? 1 : 0,\n          error\n        };\n      }\n      else {\n        throw new Error(`Unsupported SQL operation: ${sql.substring(0, 20)}...`);\n      }\n    } catch (error: any) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error\n      };\n    }\n  },\n\n  // Supabase methods\n  from: (table: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from(table);\n  },\n\n  select: (columns?: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').select(columns); // Default to 'users', caller should use from() first\n  },\n\n  insert: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').insert(data); // Default to 'users', caller should use from() first\n  },\n\n  update: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').update(data); // Default to 'users', caller should use from() first\n  },\n\n  delete: () => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').delete(); // Default to 'users', caller should use from() first\n  }\n};\n\nexport default db;\n\n// Export the supabase client for direct use if needed\nexport { supabase };"],"names":["createClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_ANON_KEY","console","error","log","supabase","QueryResult","rows","rowCount","DatabaseClientInterface","query","text","params","Promise","from","table","select","columns","insert","data","update","delete","db","sql","Error","sqlLower","toLowerCase","trim","startsWith","tableName","selectMatch","match","hasWhere","includes","queryBuilder","whereRegex","whereMatch","whereClause","length","eq","genericPattern","parseInt","col","paramIdx","Array","isArray","insertMatch","columnsStr","replace","split","insertData","i","updateMatch","setClause","setData","setParts","map","p","paramIndex","forEach","part","key","value","whereConditions","whereParts","paramNum","substring","deleteMatch","valuePlaceholder"],"mappings":";;;;;;AAAA,SAASA,YAAY,QAAQ,uBAAuB;;AAEpD,8BAAA;AACA,MAAMC,WAAW,GAAGC,OAAO,CAACC,GAAG,CAACC,wBAAwB,4CAAIF,OAAO,CAACC,GAAG,CAACE,YAAY;AACpF,MAAMC,eAAe,GAAGJ,OAAO,CAACC,GAAG,CAACI,6BAA6B,+MAAIL,OAAO,CAACC,GAAG,CAACK,iBAAiB;AAElG,IAAI,CAACP,WAAW,IAAI,CAACK,eAAe,EAAE;;AAOtC,MAAMM,QAAQ,GAAGX,WAAW,IAAIK,eAAe,aAAGN,yMAAY,EAACC,WAAW,EAAEK,eAAe,CAAC,GAAG,IAAI;AAkBnG,+EAAA;AACA,MAAMuB,EAAE,EAAEb,CAA0B,sBAAH;IAC/B,4DAAA;IACAC,KAAK,EAAE,MAAAA,CAAOa,GAAG,EAAE,AAAQX,MAAF,AAAgB,CAAP,EAAE,GAAG,EAAE,CAAC,EAAEC,OAAO,CAACP,WAAW,CAAC,IAAI;QAClE,IAAI,CAACD,QAAQ,EAAE;YACb,OAAO;gBACLE,IAAI,EAAE,EAAE;gBACRC,QAAQ,EAAE,CAAC;gBACXL,KAAK,EAAE,IAAIqB,KAAK,CAAC,iCAAiC;YACpD,CAAC;QACH;QAEA,IAAI;YACF,wCAAA;YACA,MAAMC,QAAQ,GAAGF,GAAG,CAACG,WAAW,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC;YAEzC,IAAIF,QAAQ,CAACG,UAAU,CAAC,QAAQ,CAAC,EAAE;gBACjC,6EAAA;gBACA,IAAIX,OAAO,EAAEY,SAAS;gBACtB,MAAMC,WAAW,GAAGP,GAAG,CAACQ,KAAK,CAAC,mDAAmD,CAAC;gBAClF,IAAI,CAACD,WAAW,EAAE;oBAChB,MAAM,IAAIN,KAAK,CAAC,8BAA8B,CAAC;gBACjD;gBACAP,OAAO,GAAGa,WAAW,CAAC,CAAC,CAAC,CAACH,IAAI,CAAC,CAAC;gBAC/BE,SAAS,GAAGC,WAAW,CAAC,CAAC,CAAC,CAACH,IAAI,CAAC,CAAC;gBAEjC,kCAAA;gBACA,MAAMK,QAAQ,GAAGP,QAAQ,CAACQ,QAAQ,CAAC,OAAO,CAAC;gBAC3C,IAAIC,YAAY,GAAG7B,QAAQ,CAACS,IAAI,CAACe,SAAS,CAAC,CAACb,MAAM,CAACC,OAAO,KAAK,GAAG,GAAG,GAAG,GAAGA,OAAO,CAAC;gBAEnF,IAAIe,QAAQ,EAAE;oBACZ,6BAAA;oBACA,MAAMG,UAAU,GAAG,0DAA0D;oBAC7E,MAAMC,UAAU,GAAGb,GAAG,CAACQ,KAAK,CAACI,UAAU,CAAC;oBAExC,IAAIC,UAAU,IAAIA,UAAU,CAAC,CAAC,CAAC,EAAE;wBAC/B,MAAMC,WAAW,GAAGD,UAAU,CAAC,CAAC,CAAC,CAACT,IAAI,CAAC,CAAC;wBAExC,kDAAA;wBACA,IAAIU,WAAW,CAACJ,QAAQ,CAAC,YAAY,CAAC,IAAIrB,MAAM,IAAIA,MAAM,CAAC0B,MAAM,IAAI,CAAC,EAAE;4BACtEJ,YAAY,GAAGA,YAAY,CAACK,EAAE,CAAC,OAAO,EAAE3B,MAAM,CAAC,CAAC,CAAC,CAAC;wBACpD,CAAC,MAAM,IAAIyB,WAAW,CAACJ,QAAQ,CAAC,cAAc,CAAC,IAAIrB,MAAM,IAAIA,MAAM,CAAC0B,MAAM,IAAI,CAAC,EAAE;4BAC/EJ,YAAY,GAAGA,YAAY,CAACK,EAAE,CAAC,SAAS,EAAE3B,MAAM,CAAC,CAAC,CAAC,CAAC;wBACtD,CAAC,MAAM,IAAIyB,WAAW,CAACJ,QAAQ,CAAC,SAAS,CAAC,IAAIrB,MAAM,IAAIA,MAAM,CAAC0B,MAAM,IAAI,CAAC,EAAE;4BAC1EJ,YAAY,GAAGA,YAAY,CAACK,EAAE,CAAC,IAAI,EAAE3B,MAAM,CAAC,CAAC,CAAC,CAAC;wBACjD,CAAC,MAAM,IAAIyB,WAAW,CAACJ,QAAQ,CAAC,iBAAiB,CAAC,IAAIrB,MAAM,IAAIA,MAAM,CAAC0B,MAAM,IAAI,CAAC,EAAE;4BAClFJ,YAAY,GAAGA,YAAY,CAACK,EAAE,CAAC,YAAY,EAAE3B,MAAM,CAAC,CAAC,CAAC,CAAC;wBACzD,CAAC,MAAM,IAAIyB,WAAW,CAACJ,QAAQ,CAAC,kCAAkC,CAAC,IAAIrB,MAAM,IAAIA,MAAM,CAAC0B,MAAM,IAAI,CAAC,EAAE;4BACnGJ,YAAY,GAAGA,YAAY,CAACK,EAAE,CAAC,SAAS,EAAE3B,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC2B,EAAE,CAAC,YAAY,EAAE3B,MAAM,CAAC,CAAC,CAAC,CAAC;wBAClF,CAAC,MAAM,IAAIyB,WAAW,CAACJ,QAAQ,CAAC,WAAW,CAAC,IAAIrB,MAAM,IAAIA,MAAM,CAAC0B,MAAM,IAAI,CAAC,EAAE;4BAC5EJ,YAAY,GAAGA,YAAY,CAACK,EAAE,CAAC,MAAM,EAAE3B,MAAM,CAAC,CAAC,CAAC,CAAC;wBACnD,CAAC,MAAM;4BACL,kFAAA;4BACA,MAAM4B,cAAc,GAAG,wCAAwC;4BAC/D,MAAMT,KAAK,GAAGM,WAAW,CAACN,KAAK,CAACS,cAAc,CAAC;4BAC/C,IAAIT,KAAK,IAAInB,MAAM,IAAIA,MAAM,CAAC0B,MAAM,IAAIG,QAAQ,CAACV,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE;gCAC1D,MAAMW,GAAG,GAAGX,KAAK,CAAC,CAAC,CAAC;gCACpB,MAAMY,QAAQ,GAAGF,QAAQ,CAACV,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;gCACvCG,YAAY,GAAGA,YAAY,CAACK,EAAE,CAACG,GAAG,EAAE9B,MAAM,CAAC+B,QAAQ,CAAC,CAAC;4BACvD;wBACF;oBACF;gBACF;gBAEA,MAAM,EAAExB,IAAI,EAAEhB,KAAAA,EAAO,GAAG,MAAM+B,YAAY;gBAC1C,IAAI/B,KAAK,EAAE;oBACT,OAAO;wBACLI,IAAI,EAAE,EAAE;wBACRC,QAAQ,EAAE,CAAC;wBACXL;oBACF,CAAC;gBACH;gBACA,OAAO;oBACLI,IAAI,EAAEqC,KAAK,CAACC,OAAO,CAAC1B,IAAI,CAAC,GAAGA,IAAI,GAAIA,IAAI,GAAG;wBAACA,IAAI;qBAAC,GAAG,EAAG;oBACvDX,QAAQ,EAAEW,IAAI,GAAIyB,KAAK,CAACC,OAAO,CAAC1B,IAAI,CAAC,GAAGA,IAAI,CAACmB,MAAM,GAAG,CAAC,GAAI,CAAC;oBAC5DnC,KAAK,EAAE;gBACT,CAAC;YACH,CAAC,MACI,IAAIsB,QAAQ,CAACG,UAAU,CAAC,QAAQ,CAAC,EAAE;gBACtC,qBAAA;gBACA,MAAMkB,WAAW,GAAGvB,GAAG,CAACQ,KAAK,CAAC,4FAA4F,CAAC;gBAC3H,IAAI,CAACe,WAAW,EAAE;oBAChB,MAAM,IAAItB,KAAK,CAAC,8BAA8B,CAAC;gBACjD;gBAEA,MAAMK,SAAS,GAAGiB,WAAW,CAAC,CAAC,CAAC;gBAChC,MAAMC,UAAU,GAAGD,WAAW,CAAC,CAAC,CAAC;gBACjC,MAAM7B,OAAO,GAAG8B,UAAU,CAACC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,mCAAA;gBAE1D,IAAI,CAACrC,MAAM,IAAIA,MAAM,CAAC0B,MAAM,KAAK,CAAC,EAAE;oBAClC,MAAM,IAAId,KAAK,CAAC,gCAAgC,CAAC;gBACnD;gBAEA,uDAAA;gBACA,MAAM0B,UAAU,EAAE,CAAM,CAAC,CAAJ,AAAK;gBAC1B,IAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGlC,OAAO,CAACqB,MAAM,IAAIa,CAAC,GAAGvC,MAAM,CAAC0B,MAAM,EAAEa,CAAC,EAAE,CAAE;oBAC5DD,UAAU,CAACjC,OAAO,CAACkC,CAAC,CAAC,CAAC,GAAGvC,MAAM,CAACuC,CAAC,CAAC;gBACpC;gBAEA,MAAM,EAAEhC,IAAI,EAAEhB,KAAAA,EAAO,GAAG,MAAME,QAAQ,CACnCS,IAAI,CAACe,SAAS,CAAC,CACfX,MAAM,CAACgC,UAAU,CAAC,CAClBlC,MAAM,CAAC,CAAC;gBAEX,OAAO;oBACLT,IAAI,EAAEqC,KAAK,CAACC,OAAO,CAAC1B,IAAI,CAAC,GAAGA,IAAI,GAAIA,IAAI,GAAG;wBAACA,IAAI;qBAAC,GAAG,EAAG;oBACvDX,QAAQ,EAAEW,IAAI,GAAIyB,KAAK,CAACC,OAAO,CAAC1B,IAAI,CAAC,GAAGA,IAAI,CAACmB,MAAM,GAAG,CAAC,GAAI,CAAC;oBAC5DnC;gBACF,CAAC;YACH,CAAC,MACI,IAAIsB,QAAQ,CAACG,UAAU,CAAC,QAAQ,CAAC,EAAE;gBACtC,qBAAA;gBACA,MAAMwB,WAAW,GAAG7B,GAAG,CAACQ,KAAK,CAAC,iEAAiE,CAAC;gBAChG,IAAI,CAACqB,WAAW,EAAE;oBAChB,MAAM,IAAI5B,KAAK,CAAC,8BAA8B,CAAC;gBACjD;gBAEA,MAAMK,SAAS,GAAGuB,WAAW,CAAC,CAAC,CAAC;gBAChC,MAAMC,SAAS,GAAGD,WAAW,CAAC,CAAC,CAAC;gBAChC,MAAMf,WAAW,GAAGe,WAAW,CAAC,CAAC,CAAC;gBAElC,2CAAA;gBACA,MAAME,OAAO,EAAE,CAAM,CAAC,CAAJ,AAAK;gBACvB,MAAMC,QAAQ,GAAGF,SAAS,CAACJ,KAAK,CAAC,GAAG,CAAC,CAACO,GAAG,EAACC,CAAC,GAAIA,CAAC,CAAC9B,IAAI,CAAC,CAAC,CAAC;gBACxD,IAAI+B,UAAU,GAAG,CAAC;gBAClBH,QAAQ,CAACI,OAAO,EAACC,IAAI,IAAI;oBACvB,MAAM,CAACC,GAAG,EAAEC,KAAK,CAAC,GAAGF,IAAI,CAACX,KAAK,CAAC,GAAG,CAAC,CAACO,GAAG,EAACC,CAAC,GAAIA,CAAC,CAAC9B,IAAI,CAAC,CAAC,CAAC;oBACvD,4CAAA;oBACA2B,OAAO,CAACO,GAAG,CAAC,GAAGjD,MAAM,AAAC,CAAC8C,UAAU,CAAC;oBAClCA,UAAU,EAAE;gBACd,CAAC,CAAC;gBAEF,mCAAA;gBACA,MAAMK,eAAe,EAAE,CAAM,CAAC,CAAC,AAAL;gBAC1B,MAAMC,UAAU,GAAG3B,WAAW,CAACY,KAAK,CAAC,KAAK,CAAC,CAACO,GAAG,EAACC,CAAC,GAAIA,CAAC,CAAC9B,IAAI,CAAC,CAAC,CAAC;gBAC9DqC,UAAU,CAACL,OAAO,EAACC,IAAI,IAAI;oBACzB,MAAM,CAACC,GAAG,EAAEC,KAAK,CAAC,GAAGF,IAAI,CAACX,KAAK,CAAC,GAAG,CAAC,CAACO,GAAG,EAACC,CAAC,GAAIA,CAAC,CAAC9B,IAAI,CAAC,CAAC,CAAC;oBACvD,4CAAA;oBACA,MAAMsC,QAAQ,GAAGxB,QAAQ,CAACqB,KAAK,CAACI,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,wBAAA;oBACnDH,eAAe,CAACF,GAAG,CAAC,GAAGjD,MAAM,AAAC,CAACqD,QAAQ,CAAC;gBAC1C,CAAC,CAAC;gBAEF,MAAM,EAAE9C,IAAI,EAAEhB,KAAAA,EAAO,GAAG,MAAME,QAAQ,CACnCS,IAAI,CAACe,SAAS,CAAC,CACfT,MAAM,CAACkC,OAAO,CAAC,CACfvB,KAAK,CAACgC,eAAe,CAAC,CACtB/C,MAAM,CAAC,CAAC;gBAEX,OAAO;oBACLT,IAAI,EAAEqC,KAAK,CAACC,OAAO,CAAC1B,IAAI,CAAC,GAAGA,IAAI,GAAIA,IAAI,GAAG;wBAACA,IAAI;qBAAC,GAAG,EAAG;oBACvDX,QAAQ,EAAEW,IAAI,GAAIyB,KAAK,CAACC,OAAO,CAAC1B,IAAI,CAAC,GAAGA,IAAI,CAACmB,MAAM,GAAG,CAAC,GAAI,CAAC;oBAC5DnC;gBACF,CAAC;YACH,CAAC,MACI,IAAIsB,QAAQ,CAACG,UAAU,CAAC,QAAQ,CAAC,EAAE;gBACtC,qBAAA;gBACA,MAAMuC,WAAW,GAAG5C,GAAG,CAACQ,KAAK,CAAC,0DAA0D,CAAC;gBACzF,IAAI,CAACoC,WAAW,EAAE;oBAChB,MAAM,IAAI3C,KAAK,CAAC,8BAA8B,CAAC;gBACjD;gBAEA,MAAMK,SAAS,GAAGsC,WAAW,CAAC,CAAC,CAAC;gBAChC,MAAM9B,WAAW,GAAG8B,WAAW,CAAC,CAAC,CAAC;gBAElC,qBAAA;gBACA,MAAMJ,eAAe,EAAE,CAAM,CAAC,CAAJ,AAAK;gBAC/B,MAAMC,UAAU,GAAG3B,WAAW,CAACY,KAAK,CAAC,KAAK,CAAC,CAACO,GAAG,EAACC,CAAC,GAAIA,CAAC,CAAC9B,IAAI,CAAC,CAAC,CAAC;gBAC9D,IAAI+B,UAAU,GAAG,CAAC;gBAClBM,UAAU,CAACL,OAAO,EAACC,IAAI,IAAI;oBACzB,MAAM,CAACC,GAAG,EAAEO,gBAAgB,CAAC,GAAGR,IAAI,CAACX,KAAK,CAAC,GAAG,CAAC,CAACO,GAAG,EAACC,CAAC,GAAIA,CAAC,CAAC9B,IAAI,CAAC,CAAC,CAAC;oBAClE,qDAAA;oBACAoC,eAAe,CAACF,GAAG,CAAC,GAAGjD,MAAO,AAAD,CAAE8C,UAAU,CAAC;oBAC1CA,UAAU,EAAE;gBACd,CAAC,CAAC;gBAEF,MAAM,EAAEvC,IAAI,EAAEhB,KAAAA,EAAO,GAAG,MAAME,QAAQ,CACnCS,IAAI,CAACe,SAAS,CAAC,CACfR,MAAM,CAAC,CAAC,CACRU,KAAK,CAACgC,eAAe,CAAC;gBAEzB,OAAO;oBACLxD,IAAI,EAAEY,IAAI,GAAG;wBAACA,IAAI;qBAAC,GAAG,EAAE;oBACxBX,QAAQ,EAAEW,IAAI,GAAG,CAAC,GAAG,CAAC;oBACtBhB;gBACF,CAAC;YACH,CAAC,MACI;gBACH,MAAM,IAAIqB,KAAK,CAAC,CAAA,2BAAA,EAA8BD,GAAG,CAAC2C,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,CAAA,GAAA,CAAK,CAAC;YAC1E;QACF,CAAC,CAAC,OAAO/D,KAAK,EAAE,AAAK,GAAF;YACjB,OAAO;gBACLI,IAAI,EAAE,EAAE;gBACRC,QAAQ,EAAE,CAAC;gBACXL;YACF,CAAC;QACH;IACF,CAAC;IAED,mBAAA;IACAW,IAAI,EAAEA,CAACC,KAAK,EAAE,MAAM,KAAK;QACvB,IAAI,CAACV,QAAQ,EAAE;YACb,MAAM,IAAImB,KAAK,CAAC,iCAAiC,CAAC;QACpD;QACA,OAAOnB,QAAQ,CAACS,IAAI,CAACC,KAAK,CAAC;IAC7B,CAAC;IAEDC,MAAM,EAAEA,CAACC,OAAgB,CAAR,EAAE,MAAM,KAAK;QAC5B,IAAI,CAACZ,QAAQ,EAAE;YACb,MAAM,IAAImB,KAAK,CAAC,iCAAiC,CAAC;QACpD;QACA,OAAOnB,QAAQ,CAACS,IAAI,CAAC,OAAO,CAAC,CAACE,MAAM,CAACC,OAAO,CAAC,CAAC,CAAC,qDAAA;IACjD,CAAC;IAEDC,MAAM,EAAEA,CAACC,IAAI,EAAE,GAAG,KAAK;QACrB,IAAI,CAACd,QAAQ,EAAE;YACb,MAAM,IAAImB,KAAK,CAAC,iCAAiC,CAAC;QACpD;QACA,OAAOnB,QAAQ,CAACS,IAAI,CAAC,OAAO,CAAC,CAACI,MAAM,CAACC,IAAI,CAAC,CAAC,CAAC,qDAAA;IAC9C,CAAC;IAEDC,MAAM,EAAEA,CAACD,IAAI,EAAE,GAAG,KAAK;QACrB,IAAI,CAACd,QAAQ,EAAE;YACb,MAAM,IAAImB,KAAK,CAAC,iCAAiC,CAAC;QACpD;QACA,OAAOnB,QAAQ,CAACS,IAAI,CAAC,OAAO,CAAC,CAACM,MAAM,CAACD,IAAI,CAAC,CAAC,CAAC,qDAAA;IAC9C,CAAC;IAEDE,MAAM,EAAEA,CAAA,KAAM;QACZ,IAAI,CAAChB,QAAQ,EAAE;YACb,MAAM,IAAImB,KAAK,CAAC,iCAAiC,CAAC;QACpD;QACA,OAAOnB,QAAQ,CAACS,IAAI,CAAC,OAAO,CAAC,CAACO,MAAM,CAAC,CAAC,CAAC,CAAC,qDAAA;IAC1C;AACF,CAAC;uCAEcC,EAAE","ignoreList":[],"debugId":null}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/slug.ts"],"sourcesContent":["// utils/slug.ts\nimport db from '@/lib/db';\n\n/**\n * Generate a unique slug from a product name\n * \n * @param {string} name - Product name to convert to a slug\n * @param {number} [excludeId] - Product ID to exclude if updating existing product\n * @returns {Promise<string>} - Unique slug for the product\n */\nexport const generateUniqueSlug = async (name: string, excludeId?: number): Promise<string> => {\n  // Basic slugification: convert to lowercase, replace spaces with hyphens, remove special characters\n  let baseSlug = name\n    .toLowerCase()\n    .replace(/[^\\w\\s-]/g, '') // Remove special characters\n    .replace(/[\\s_-]+/g, '-') // Replace spaces, underscores, and multiple hyphens with single hyphen\n    .replace(/^-+|-+$/g, ''); // Remove leading/trailing hyphens\n\n  // Ensure minimum length and handle empty slug\n  if (baseSlug.length < 3) {\n    baseSlug = `product-${Date.now()}-${Math.random().toString(36).substring(2, 8)}`;\n  }\n\n  // Check if the slug already exists in the database\n  let slug = baseSlug;\n  let counter = 1;\n  let isUnique = false;\n\n  while (!isUnique) {\n    try {\n      const query = excludeId \n        ? 'SELECT id FROM products WHERE slug = $1 AND id != $2' \n        : 'SELECT id FROM products WHERE slug = $1';\n      \n      const params = excludeId ? [slug, excludeId] : [slug];\n      \n      const result = await db.query(query, params);\n      \n      if (result.rows.length === 0) {\n        // Slug is unique\n        isUnique = true;\n      } else {\n        // Slug exists, add counter and try again\n        slug = `${baseSlug}-${counter}`;\n        counter++;\n      }\n    } catch (error) {\n      console.error('Error checking slug uniqueness:', error);\n      // If there's an error, fallback to a unique slug using timestamp\n      slug = `${baseSlug}-${Date.now()}`;\n      isUnique = true;\n    }\n  }\n\n  return slug;\n};"],"names":["db","generateUniqueSlug","name","excludeId","Promise","baseSlug","toLowerCase","replace","length","Date","now","Math","random","toString","substring","slug","counter","isUnique","query","params","result","rows","error","console"],"mappings":"AAAA,gBAAA;;;;;AACA,OAAOA,EAAE,MAAM,UAAU;;AASlB,MAAMC,kBAAkB,GAAG,MAAAA,CAAOC,IAAI,EAAE,AAAQC,MAAF,GAAoB,CAAR,EAAE,MAAM,CAAC,EAAEC,OAAO,CAAC,MAAM,CAAC,IAAI;IAC7F,oGAAA;IACA,IAAIC,QAAQ,GAAGH,IAAI,CAChBI,WAAW,CAAC,CAAC,CACbC,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC,4BAAA;KACzBA,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC,uEAAA;KACzBA,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC,CAAC,kCAAA;IAE5B,8CAAA;IACA,IAAIF,QAAQ,CAACG,MAAM,GAAG,CAAC,EAAE;QACvBH,QAAQ,GAAG,CAAA,QAAA,EAAWI,IAAI,CAACC,GAAG,CAAC,CAAC,CAAA,CAAA,EAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;IAClF;IAEA,mDAAA;IACA,IAAIC,IAAI,GAAGV,QAAQ;IACnB,IAAIW,OAAO,GAAG,CAAC;IACf,IAAIC,QAAQ,GAAG,KAAK;IAEpB,MAAO,CAACA,QAAQ,CAAE;QAChB,IAAI;YACF,MAAMC,KAAK,GAAGf,SAAS,GACnB,sDAAsD,GACtD,yCAAyC;YAE7C,MAAMgB,MAAM,GAAGhB,SAAS,GAAG;gBAACY,IAAI;gBAAEZ,SAAS;aAAC,GAAG;gBAACY,IAAI;aAAC;YAErD,MAAMK,MAAM,GAAG,MAAMpB,6HAAE,CAACkB,KAAK,CAACA,KAAK,EAAEC,MAAM,CAAC;YAE5C,IAAIC,MAAM,CAACC,IAAI,CAACb,MAAM,KAAK,CAAC,EAAE;gBAC5B,iBAAA;gBACAS,QAAQ,GAAG,IAAI;YACjB,CAAC,MAAM;gBACL,yCAAA;gBACAF,IAAI,GAAG,GAAGV,QAAQ,CAAA,CAAA,EAAIW,OAAO,EAAE;gBAC/BA,OAAO,EAAE;YACX;QACF,CAAC,CAAC,OAAOM,KAAK,EAAE;YACdC,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;YACvD,iEAAA;YACAP,IAAI,GAAG,GAAGV,QAAQ,CAAA,CAAA,EAAII,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;YAClCO,QAAQ,GAAG,IAAI;QACjB;IACF;IAEA,OAAOF,IAAI;AACb,CAAC","ignoreList":[],"debugId":null}},
    {"offset": {"line": 319, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/products/%5Bid%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport db from '@/lib/db';\nimport { generateUniqueSlug } from '@/lib/slug';\n\nexport async function GET(_request: NextRequest, context: { params: Promise<{ id: string }> }) {\n  try {\n    // Wait for params to be resolved in Next.js 13+ App Router\n    const params = await context.params;\n    const productIdOrSlug = params.id;\n\n    if (productIdOrSlug === undefined) {\n      console.error('Parameter is undefined');\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Product parameter is missing'\n        },\n        { status: 400 }\n      );\n    }\n\n    // Prefer slug lookup for better SEO and UX\n    // First try to find by slug (non-numeric string)\n    const isNumericId = /^\\d+$/.test(productIdOrSlug);\n    let productResult;\n\n    if (!isNumericId) {\n      // Parameter is a slug (string with non-numeric characters)\n      productResult = await db.query('SELECT * FROM products WHERE slug = $1', [productIdOrSlug]);\n    } else {\n      // Parameter is a numeric ID\n      const productId = parseInt(productIdOrSlug, 10);\n      if (isNaN(productId)) {\n        return NextResponse.json(\n          {\n            success: false,\n            error: `Invalid product ID: ${productIdOrSlug}`\n          },\n          { status: 400 }\n        );\n      }\n      productResult = await db.query('SELECT * FROM products WHERE id = $1', [productId]);\n    }\n\n    if (productResult.rows.length === 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Product not found'\n        },\n        { status: 404 }\n      );\n    }\n\n    if (productResult.rows.length === 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Product not found'\n        },\n        { status: 404 }\n      );\n    }\n\n    const product = productResult.rows[0];\n    \n    // Fetch associated images for the product\n    // Handle case where product_images table might not exist yet\n    let productWithImages;\n    try {\n      const imagesResult = await db.query(\n        'SELECT image_url, is_primary, sort_order FROM product_images WHERE product_id = $1 ORDER BY sort_order',\n        [product.id]\n      );\n      \n      productWithImages = {\n        ...product,\n        images: imagesResult.rows.map((img: any) => img.image_url),\n        primary_image: imagesResult.rows.find((img: any) => img.is_primary)?.image_url || product.image_url\n      };\n    } catch (imageError) {\n      // If product_images table doesn't exist, return product with just the original image_url\n      console.warn(`Could not fetch images for product ${product.id}:`, (imageError as Error).message || imageError);\n      productWithImages = {\n        ...product,\n        images: product.image_url ? [product.image_url] : [],\n        primary_image: product.image_url\n      };\n    }\n\n    return NextResponse.json({\n      success: true,\n      data: productWithImages\n    });\n  } catch (error) {\n    console.error('Error fetching product:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Internal server error'\n      },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(request: NextRequest, { params }: { params: { id: string } }) {\n  try {\n    const { id } = params;\n\n    // Convert the id to integer for database query\n    const productId = parseInt(id, 10);\n\n    const body = await request.json();\n    const { name, description, price, image_url, image_urls, category } = body;\n\n    if (!name || !description || !price || price <= 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Name, description, and price are required'\n        },\n        { status: 400 }\n      );\n    }\n\n    // Start a transaction to ensure data consistency\n    const client = await db.connect();\n    try {\n      await client.query('BEGIN');\n\n      // First fetch the existing product\n      const existingProductResult = await client.query('SELECT * FROM products WHERE id = $1', [productId]);\n      if (existingProductResult.rows.length === 0) {\n        await client.query('ROLLBACK');\n        return NextResponse.json(\n          {\n            success: false,\n            error: 'Product not found'\n          },\n          { status: 404 }\n        );\n      }\n\n      const existingProduct = existingProductResult.rows[0];\n\n      // If name has changed, generate a new unique slug\n      let updatedFields = 'name = $1, description = $2, price = $3, image_url = $4, category = $5';\n      const queryParams = [name, description, price, image_url, category];\n      \n      if (name !== existingProduct.name) {\n        // Generate new slug based on the new name\n        const newSlug = await generateUniqueSlug(name, productId);\n        updatedFields += ', slug = $6';\n        queryParams.push(newSlug);\n        queryParams.push(productId); // Id for WHERE clause\n      } else {\n        queryParams.push(productId); // Id for WHERE clause\n      }\n      \n      // Update the product\n      const productResult = await client.query(\n        `UPDATE products SET ${updatedFields} WHERE id = $${queryParams.length} RETURNING *`,\n        queryParams\n      );\n\n      if (productResult.rows.length === 0) {\n        await client.query('ROLLBACK');\n        return NextResponse.json(\n          {\n            success: false,\n            error: 'Product not found'\n          },\n          { status: 404 }\n        );\n      }\n\n      const product = productResult.rows[0];\n\n      // Delete existing images for this product (handle case where table might not exist)\n      try {\n        await client.query('DELETE FROM product_images WHERE product_id = $1', [productId]);\n      } catch (deleteError) {\n        console.warn(`Could not delete images for product ${productId}:`, (deleteError as Error).message || deleteError);\n      }\n\n      // If multiple images are provided, add them to the product_images table\n      if (Array.isArray(image_urls) && image_urls.length > 0) {\n        try {\n          for (let i = 0; i < image_urls.length; i++) {\n            const isPrimary = i === 0; // Make the first image primary by default\n            await client.query(\n              'INSERT INTO product_images (product_id, image_url, is_primary, sort_order) VALUES ($1, $2, $3, $4)',\n              [product.id, image_urls[i], isPrimary, i]\n            );\n          }\n        } catch (insertError) {\n          console.warn(`Could not insert images for product ${product.id}:`, (insertError as Error).message || insertError);\n        }\n      } else if (image_url) {\n        // If only a single image is provided, add it as a primary image\n        try {\n          await client.query(\n            'INSERT INTO product_images (product_id, image_url, is_primary, sort_order) VALUES ($1, $2, $3, $4)',\n            [product.id, image_url, true, 0]\n          );\n        } catch (insertError) {\n          console.warn(`Could not insert image for product ${product.id}:`, (insertError as Error).message || insertError);\n        }\n      }\n\n      await client.query('COMMIT');\n\n      // Fetch the updated product with its images to return\n      // Handle case where product_images table might not exist yet\n      let productWithImages;\n      try {\n        const imagesResult = await client.query(\n          'SELECT image_url, is_primary, sort_order FROM product_images WHERE product_id = $1 ORDER BY sort_order',\n          [product.id]\n        );\n        \n        productWithImages = {\n          ...product,\n          images: imagesResult.rows.map((img: any) => img.image_url),\n          primary_image: imagesResult.rows.find((img: any) => img.is_primary)?.image_url || product.image_url\n        };\n      } catch (imageError) {\n        // If product_images table doesn't exist, return product with just the original image_url\n        console.warn(`Could not fetch images for product ${product.id}:`, (imageError as Error).message || imageError);\n        productWithImages = {\n          ...product,\n          images: product.image_url ? [product.image_url] : [],\n          primary_image: product.image_url\n        };\n      }\n\n      return NextResponse.json({\n        success: true,\n        data: productWithImages\n      });\n    } catch (error) {\n      await client.query('ROLLBACK');\n      throw error;\n    } finally {\n      client.release();\n    }\n  } catch (error) {\n    console.error('Error updating product:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Internal server error'\n      },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function DELETE(_request: NextRequest, { params }: { params: { id: string } }) {\n  try {\n    const { id } = params;\n\n    // Convert the id to integer for database query\n    const productId = parseInt(id, 10);\n\n    const { rowCount } = await db.query('DELETE FROM products WHERE id = $1', [productId]);\n\n    if (rowCount === 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Product not found'\n        },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Product deleted successfully'\n    });\n  } catch (error) {\n    console.error('Error deleting product:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Internal server error'\n      },\n      { status: 500 }\n    );\n  }\n}"],"names":["NextRequest","NextResponse","db","generateUniqueSlug","GET","_request","context","params","Promise","id","productIdOrSlug","undefined","console","error","json","success","status","isNumericId","test","productResult","query","productId","parseInt","isNaN","rows","length","product","productWithImages","imagesResult","images","map","img","image_url","primary_image","find","is_primary","imageError","warn","Error","message","data","PUT","request","body","name","description","price","image_urls","category","client","connect","existingProductResult","existingProduct","updatedFields","queryParams","newSlug","push","deleteError","Array","isArray","i","isPrimary","insertError","release","DELETE","rowCount"],"mappings":"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","ignoreList":[],"debugId":null}}]
}