{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/db.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase clients\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.error('Error: Supabase environment variables not set');\n  console.log('Please make sure .env.local file contains:');\n  console.log('NEXT_PUBLIC_SUPABASE_URL=');\n  console.log('NEXT_PUBLIC_SUPABASE_ANON_KEY=');\n}\n\nconst supabase = supabaseUrl && supabaseAnonKey ? createClient(supabaseUrl, supabaseAnonKey) : null;\n\n// Define types to maintain compatibility with existing code\ntype QueryResult = {\n  rows: any[];\n  rowCount: number;\n  error?: any;\n};\n\ninterface DatabaseClientInterface {\n  query: (text: string, params?: any[]) => Promise<QueryResult>;\n  from: (table: string) => any;\n  select: (columns?: string) => any;\n  insert: (data: any) => any;\n  update: (data: any) => any;\n  delete: () => any;\n}\n\n// Create a wrapper that provides both direct query method and Supabase methods\nconst db: DatabaseClientInterface = {\n  // Direct query method that translates SQL to Supabase calls\n  query: async (sql: string, params?: any[]): Promise<QueryResult> => {\n    if (!supabase) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error: new Error('Supabase client not initialized')\n      };\n    }\n\n    try {\n      // Parse SQL to determine operation type\n      const sqlLower = sql.toLowerCase().trim();\n\n      if (sqlLower.startsWith('select')) {\n        // Parse SELECT query - more flexible to handle WHERE clauses and other parts\n        let columns, tableName;\n        const selectMatch = sql.match(/select\\s+(.*?)\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)/i);\n        if (!selectMatch) {\n          throw new Error('Could not parse SELECT query');\n        }\n        columns = selectMatch[1].trim();\n        tableName = selectMatch[2].trim();\n\n        // Check if there's a WHERE clause\n        const hasWhere = sqlLower.includes('where');\n        let queryBuilder = supabase.from(tableName).select(columns === '*' ? '*' : columns);\n\n        if (hasWhere) {\n          // Extract WHERE clause parts\n          const whereRegex = /where\\s+(.*?)(?:\\s+order\\s+by|\\s+limit|\\s+group\\s+by|$)/i;\n          const whereMatch = sql.match(whereRegex);\n\n          if (whereMatch && whereMatch[1]) {\n            const whereClause = whereMatch[1].trim();\n\n            // Handle different WHERE patterns with parameters\n            if (whereClause.includes('email = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('email', params[0]);\n            } else if (whereClause.includes('user_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]);\n            } else if (whereClause.includes('id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('id', params[0]);\n            } else if (whereClause.includes('product_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('product_id', params[0]);\n            } else if (whereClause.includes('user_id = $1 AND product_id = $2') && params && params.length >= 2) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]).eq('product_id', params[1]);\n            } else if (whereClause.includes('slug = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('slug', params[0]);\n            } else {\n              // Generic handling for other patterns - need to extract column name and parameter\n              const genericPattern = /([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*\\$(\\d+)/;\n              const match = whereClause.match(genericPattern);\n              if (match && params && params.length >= parseInt(match[2])) {\n                const col = match[1];\n                const paramIdx = parseInt(match[2]) - 1;\n                queryBuilder = queryBuilder.eq(col, params[paramIdx]);\n              }\n            }\n          }\n        }\n\n        const { data, error } = await queryBuilder;\n        if (error) {\n          return {\n            rows: [],\n            rowCount: 0,\n            error\n          };\n        }\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error: null\n        };\n      }\n      else if (sqlLower.startsWith('insert')) {\n        // Parse INSERT query\n        const insertMatch = sql.match(/insert\\s+into\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(\\s*([^)]+)\\s*\\)\\s+values\\s*\\(\\s*([^)]+)\\s*\\)/i);\n        if (!insertMatch) {\n          throw new Error('Could not parse INSERT query');\n        }\n\n        const tableName = insertMatch[1];\n        const columnsStr = insertMatch[2];\n        const columns = columnsStr.replace(/\\s/g, '').split(','); // Remove spaces and split by comma\n\n        if (!params || params.length === 0) {\n          throw new Error('INSERT query has no parameters');\n        }\n\n        // Create an object mapping columns to parameter values\n        const insertData: any = {};\n        for (let i = 0; i < columns.length && i < params.length; i++) {\n          insertData[columns[i]] = params[i];\n        }\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .insert(insertData)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      }\n      else if (sqlLower.startsWith('update')) {\n        // Parse UPDATE query\n        const updateMatch = sql.match(/update\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+set\\s+(.*?)\\s+where\\s+(.*)/i);\n        if (!updateMatch) {\n          throw new Error('Could not parse UPDATE query');\n        }\n\n        const tableName = updateMatch[1];\n        const setClause = updateMatch[2];\n        const whereClause = updateMatch[3];\n\n        // Parse SET clause: col1=$1, col2=$2, etc.\n        const setData: any = {};\n        const setParts = setClause.split(',').map(p => p.trim());\n        let paramIndex = 0;\n        setParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          setData[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        // Parse WHERE clause: col=$n, etc.\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        whereParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          const paramNum = parseInt(value.substring(1)) - 1; // Convert $2 to index 1\n          whereConditions[key] = params![paramNum];\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .update(setData)\n          .match(whereConditions)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      }\n      else if (sqlLower.startsWith('delete')) {\n        // Parse DELETE query\n        const deleteMatch = sql.match(/delete\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+where\\s+(.*)/i);\n        if (!deleteMatch) {\n          throw new Error('Could not parse DELETE query');\n        }\n\n        const tableName = deleteMatch[1];\n        const whereClause = deleteMatch[2];\n\n        // Parse WHERE clause\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        let paramIndex = 0;\n        whereParts.forEach(part => {\n          const [key, valuePlaceholder] = part.split('=').map(p => p.trim());\n          // Assuming the valuePlaceholder is like $1, $2, etc.\n          whereConditions[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .delete()\n          .match(whereConditions);\n\n        return {\n          rows: data ? [data] : [],\n          rowCount: data ? 1 : 0,\n          error\n        };\n      }\n      else {\n        throw new Error(`Unsupported SQL operation: ${sql.substring(0, 20)}...`);\n      }\n    } catch (error: any) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error\n      };\n    }\n  },\n\n  // Supabase methods\n  from: (table: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from(table);\n  },\n\n  select: (columns?: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').select(columns); // Default to 'users', caller should use from() first\n  },\n\n  insert: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').insert(data); // Default to 'users', caller should use from() first\n  },\n\n  update: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').update(data); // Default to 'users', caller should use from() first\n  },\n\n  delete: () => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').delete(); // Default to 'users', caller should use from() first\n  }\n};\n\nexport default db;\n\n// Export the supabase client for direct use if needed\nexport { supabase };"],"names":["createClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_ANON_KEY","console","error","log","supabase","QueryResult","rows","rowCount","DatabaseClientInterface","query","text","params","Promise","from","table","select","columns","insert","data","update","delete","db","sql","Error","sqlLower","toLowerCase","trim","startsWith","tableName","selectMatch","match","hasWhere","includes","queryBuilder","whereRegex","whereMatch","whereClause","length","eq","genericPattern","parseInt","col","paramIdx","Array","isArray","insertMatch","columnsStr","replace","split","insertData","i","updateMatch","setClause","setData","setParts","map","p","paramIndex","forEach","part","key","value","whereConditions","whereParts","paramNum","substring","deleteMatch","valuePlaceholder"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 292, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/cart/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport db from '@/lib/db';\nimport jwt from 'jsonwebtoken';\n\n// Verify JWT token and return user ID\nasync function getUserIdFromRequest(request: NextRequest) {\n  const authHeader = request.headers.get('authorization');\n  \n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    return null;\n  }\n  \n  const token = authHeader.replace('Bearer ', '');\n  const jwtSecret = process.env.JWT_SECRET;\n\n  if (!jwtSecret) {\n    throw new Error('JWT_SECRET is not set in environment variables');\n  }\n  \n  try {\n    const decoded = jwt.verify(token, jwtSecret) as { id: number; email: string; role: string };\n    return decoded.id;\n  } catch (error) {\n    console.error('JWT verification failed:', error);\n    return null;\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const userId = await getUserIdFromRequest(request);\n\n    if (userId) {\n      // Authenticated user - get database cart\n      const cartItemsResult = await db.query(\n        `SELECT ci.id, ci.product_id, ci.quantity, \n                p.name, p.price, p.image_url\n         FROM cart_items ci\n         JOIN products p ON ci.product_id = p.id\n         WHERE ci.user_id = $1`,\n        [userId]\n      );\n\n      if (cartItemsResult.error) {\n        return NextResponse.json(\n          { success: false, error: 'Failed to fetch cart items' },\n          { status: 500 }\n        );\n      }\n\n      return NextResponse.json(\n        { success: true, data: cartItemsResult.rows },\n        { status: 200 }\n      );\n    } else {\n      // Unauthenticated user - return empty cart\n      return NextResponse.json(\n        { success: true, data: [] },\n        { status: 200 }\n      );\n    }\n  } catch (error) {\n    console.error('Error fetching cart:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const userId = await getUserIdFromRequest(request);\n    \n    if (!userId) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    const { product_id, quantity = 1 } = await request.json();\n\n    if (!product_id || typeof product_id !== 'number' || product_id <= 0) {\n      return NextResponse.json(\n        { success: false, error: 'Valid product ID is required' },\n        { status: 400 }\n      );\n    }\n\n    if (typeof quantity !== 'number' || isNaN(quantity) || quantity <= 0) {\n      return NextResponse.json(\n        { success: false, error: 'Valid positive quantity is required' },\n        { status: 400 }\n      );\n    }\n\n    // First check if the cart item already exists\n    const existingItemResult = await db.query(\n      'SELECT id, quantity FROM cart_items WHERE user_id = $1 AND product_id = $2',\n      [userId, product_id]\n    );\n\n    let result;\n    if (existingItemResult.rows.length > 0) {\n      // Item exists, update the quantity by adding to existing quantity\n      const newQuantity = existingItemResult.rows[0].quantity + quantity;\n      const updateResult = await db.query(\n        'UPDATE cart_items SET quantity = $1 WHERE user_id = $2 AND product_id = $3 RETURNING id, product_id, quantity',\n        [newQuantity, userId, product_id]\n      );\n\n      if (updateResult.error) {\n        console.error('Error updating cart item:', updateResult.error);\n        return NextResponse.json(\n          { success: false, error: 'Failed to update cart item' },\n          { status: 500 }\n        );\n      }\n\n      if (updateResult.rows.length === 0) {\n        return NextResponse.json(\n          { success: false, error: 'Failed to update cart item' },\n          { status: 500 }\n        );\n      }\n\n      result = updateResult.rows[0];\n    } else {\n      // Item doesn't exist, insert new cart item\n      const insertResult = await db.query(\n        'INSERT INTO cart_items (user_id, product_id, quantity) VALUES ($1, $2, $3) RETURNING id, product_id, quantity',\n        [userId, product_id, quantity]\n      );\n\n      if (insertResult.error) {\n        // Check if it's a duplicate key error (race condition - another request inserted it)\n        if (insertResult.error.code === '23505' || \n            insertResult.error.message?.toLowerCase().includes('duplicate') ||\n            insertResult.error.message?.toLowerCase().includes('unique')) {\n          // Race condition: item was inserted by another request, update instead\n          const updateResult = await db.query(\n            'UPDATE cart_items SET quantity = quantity + $1 WHERE user_id = $2 AND product_id = $3 RETURNING id, product_id, quantity',\n            [quantity, userId, product_id]\n          );\n          \n          if (updateResult.error || updateResult.rows.length === 0) {\n            return NextResponse.json(\n              { success: false, error: 'Failed to add item to cart' },\n              { status: 500 }\n            );\n          }\n          result = updateResult.rows[0];\n        } else {\n          console.error('Error inserting cart item:', insertResult.error);\n          return NextResponse.json(\n            { success: false, error: 'Failed to add item to cart' },\n            { status: 500 }\n          );\n        }\n      } else if (insertResult.rows.length === 0) {\n        return NextResponse.json(\n          { success: false, error: 'Failed to add item to cart' },\n          { status: 500 }\n        );\n      } else {\n        result = insertResult.rows[0];\n      }\n    }\n\n    // Get product details to return with the cart item\n    const productResult = await db.query(\n      'SELECT name, price, image_url FROM products WHERE id = $1',\n      [product_id]\n    );\n\n    return NextResponse.json(\n      {\n        success: true,\n        data: {\n          ...result,\n          name: productResult.rows[0]?.name || 'Unknown Product',\n          price: productResult.rows[0]?.price || 0,\n          image_url: productResult.rows[0]?.image_url || null\n        }\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error('Error adding to cart:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    const userId = await getUserIdFromRequest(request);\n    \n    if (!userId) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    const { product_id, quantity } = await request.json();\n\n    if (!product_id || typeof product_id !== 'number' || product_id <= 0) {\n      return NextResponse.json(\n        { success: false, error: 'Valid product ID is required' },\n        { status: 400 }\n      );\n    }\n\n    if (typeof quantity !== 'number' || isNaN(quantity)) {\n      return NextResponse.json(\n        { success: false, error: 'Valid quantity is required' },\n        { status: 400 }\n      );\n    }\n\n    if (quantity <= 0) {\n      // If quantity is 0 or negative, remove item from cart\n      const deleteResult = await db.query(\n        'DELETE FROM cart_items WHERE user_id = $1 AND product_id = $2',\n        [userId, product_id]\n      );\n      \n      if (deleteResult.error) {\n        return NextResponse.json(\n          { success: false, error: 'Failed to remove item from cart' },\n          { status: 500 }\n        );\n      }\n      \n      return NextResponse.json(\n        { success: true, message: 'Item removed from cart' },\n        { status: 200 }\n      );\n    } else {\n      // Update quantity\n      const updateResult = await db.query(\n        'UPDATE cart_items SET quantity = $1 WHERE user_id = $2 AND product_id = $3',\n        [quantity, userId, product_id]\n      );\n      \n      if (updateResult.error) {\n        return NextResponse.json(\n          { success: false, error: 'Failed to update cart item' },\n          { status: 500 }\n        );\n      }\n\n      // Get the updated cart item\n      const updatedCartItemResult = await db.query(\n        'SELECT id, product_id, quantity FROM cart_items WHERE user_id = $1 AND product_id = $2',\n        [userId, product_id]\n      );\n      \n      // Get product details to return with updated cart item\n      const productResult = await db.query(\n        'SELECT name, price, image_url FROM products WHERE id = $1',\n        [product_id]\n      );\n\n      return NextResponse.json(\n        {\n          success: true,\n          data: {\n            ...updatedCartItemResult.rows[0],\n            name: productResult.rows[0]?.name || 'Unknown Product',\n            price: productResult.rows[0]?.price || 0,\n            image_url: productResult.rows[0]?.image_url || null\n          }\n        },\n        { status: 200 }\n      );\n    }\n  } catch (error) {\n    console.error('Error updating cart:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  try {\n    const userId = await getUserIdFromRequest(request);\n\n    if (userId) {\n      // Authenticated user - clear database cart\n      await db.query('DELETE FROM cart_items WHERE user_id = $1', [userId]);\n    }\n    // For unauthenticated users, just return success for client-side handling\n    \n    return NextResponse.json(\n      { success: true, message: 'Cart cleared' },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error('Error clearing cart:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"],"names":["NextRequest","NextResponse","db","jwt","getUserIdFromRequest","request","authHeader","headers","get","startsWith","token","replace","jwtSecret","process","env","JWT_SECRET","Error","decoded","verify","id","email","role","error","console","GET","userId","cartItemsResult","query","json","success","status","data","rows","POST","product_id","quantity","isNaN","existingItemResult","result","length","newQuantity","updateResult","insertResult","code","message","toLowerCase","includes","productResult","name","price","image_url","PUT","deleteResult","updatedCartItemResult","DELETE"],"mappings":"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","ignoreList":[],"debugId":null}}]
}