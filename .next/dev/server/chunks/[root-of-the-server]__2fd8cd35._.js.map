{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/db.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase clients\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.error('Error: Supabase environment variables not set');\n  console.log('Please make sure .env.local file contains:');\n  console.log('NEXT_PUBLIC_SUPABASE_URL=');\n  console.log('NEXT_PUBLIC_SUPABASE_ANON_KEY=');\n}\n\nconst supabase = supabaseUrl && supabaseAnonKey ? createClient(supabaseUrl, supabaseAnonKey) : null;\n\n// Define types to maintain compatibility with existing code\ntype QueryResult = {\n  rows: any[];\n  rowCount: number;\n  error?: any;\n};\n\ninterface DatabaseClientInterface {\n  query: (text: string, params?: any[]) => Promise<QueryResult>;\n  from: (table: string) => any;\n  select: (columns?: string) => any;\n  insert: (data: any) => any;\n  update: (data: any) => any;\n  delete: () => any;\n}\n\n// Create a wrapper that provides both direct query method and Supabase methods\nconst db: DatabaseClientInterface = {\n  // Direct query method that translates SQL to Supabase calls\n  query: async (sql: string, params?: any[]): Promise<QueryResult> => {\n    if (!supabase) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error: new Error('Supabase client not initialized')\n      };\n    }\n\n    try {\n      // Parse SQL to determine operation type\n      const sqlLower = sql.toLowerCase().trim();\n\n      if (sqlLower.startsWith('select')) {\n        // Parse SELECT query - more flexible to handle WHERE clauses and other parts\n        let columns, tableName;\n        const selectMatch = sql.match(/select\\s+(.*?)\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)/i);\n        if (!selectMatch) {\n          throw new Error('Could not parse SELECT query');\n        }\n        columns = selectMatch[1].trim();\n        tableName = selectMatch[2].trim();\n\n        // Check if there's a WHERE clause\n        const hasWhere = sqlLower.includes('where');\n        let queryBuilder = supabase.from(tableName).select(columns === '*' ? '*' : columns);\n\n        if (hasWhere) {\n          // Extract WHERE clause parts\n          const whereRegex = /where\\s+(.*?)(?:\\s+order\\s+by|\\s+limit|\\s+group\\s+by|$)/i;\n          const whereMatch = sql.match(whereRegex);\n\n          if (whereMatch && whereMatch[1]) {\n            const whereClause = whereMatch[1].trim();\n\n            // Handle different WHERE patterns with parameters\n            if (whereClause.includes('email = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('email', params[0]);\n            } else if (whereClause.includes('user_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]);\n            } else if (whereClause.includes('id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('id', params[0]);\n            } else if (whereClause.includes('product_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('product_id', params[0]);\n            } else if (whereClause.includes('user_id = $1 AND product_id = $2') && params && params.length >= 2) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]).eq('product_id', params[1]);\n            } else if (whereClause.includes('slug = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('slug', params[0]);\n            } else {\n              // Generic handling for other patterns - need to extract column name and parameter\n              const genericPattern = /([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*\\$(\\d+)/;\n              const match = whereClause.match(genericPattern);\n              if (match && params && params.length >= parseInt(match[2])) {\n                const col = match[1];\n                const paramIdx = parseInt(match[2]) - 1;\n                queryBuilder = queryBuilder.eq(col, params[paramIdx]);\n              }\n            }\n          }\n        }\n\n        const { data, error } = await queryBuilder;\n        if (error) {\n          return {\n            rows: [],\n            rowCount: 0,\n            error\n          };\n        }\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error: null\n        };\n      }\n      else if (sqlLower.startsWith('insert')) {\n        // Parse INSERT query\n        const insertMatch = sql.match(/insert\\s+into\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(\\s*([^)]+)\\s*\\)\\s+values\\s*\\(\\s*([^)]+)\\s*\\)/i);\n        if (!insertMatch) {\n          throw new Error('Could not parse INSERT query');\n        }\n\n        const tableName = insertMatch[1];\n        const columnsStr = insertMatch[2];\n        const columns = columnsStr.replace(/\\s/g, '').split(','); // Remove spaces and split by comma\n\n        if (!params || params.length === 0) {\n          throw new Error('INSERT query has no parameters');\n        }\n\n        // Create an object mapping columns to parameter values\n        const insertData: any = {};\n        for (let i = 0; i < columns.length && i < params.length; i++) {\n          insertData[columns[i]] = params[i];\n        }\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .insert(insertData)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      }\n      else if (sqlLower.startsWith('update')) {\n        // Parse UPDATE query\n        const updateMatch = sql.match(/update\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+set\\s+(.*?)\\s+where\\s+(.*)/i);\n        if (!updateMatch) {\n          throw new Error('Could not parse UPDATE query');\n        }\n\n        const tableName = updateMatch[1];\n        const setClause = updateMatch[2];\n        const whereClause = updateMatch[3];\n\n        // Parse SET clause: col1=$1, col2=$2, etc.\n        const setData: any = {};\n        const setParts = setClause.split(',').map(p => p.trim());\n        let paramIndex = 0;\n        setParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          setData[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        // Parse WHERE clause: col=$n, etc.\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        whereParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          const paramNum = parseInt(value.substring(1)) - 1; // Convert $2 to index 1\n          whereConditions[key] = params![paramNum];\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .update(setData)\n          .match(whereConditions)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      }\n      else if (sqlLower.startsWith('delete')) {\n        // Parse DELETE query\n        const deleteMatch = sql.match(/delete\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+where\\s+(.*)/i);\n        if (!deleteMatch) {\n          throw new Error('Could not parse DELETE query');\n        }\n\n        const tableName = deleteMatch[1];\n        const whereClause = deleteMatch[2];\n\n        // Parse WHERE clause\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        let paramIndex = 0;\n        whereParts.forEach(part => {\n          const [key, valuePlaceholder] = part.split('=').map(p => p.trim());\n          // Assuming the valuePlaceholder is like $1, $2, etc.\n          whereConditions[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .delete()\n          .match(whereConditions);\n\n        return {\n          rows: data ? [data] : [],\n          rowCount: data ? 1 : 0,\n          error\n        };\n      }\n      else {\n        throw new Error(`Unsupported SQL operation: ${sql.substring(0, 20)}...`);\n      }\n    } catch (error: any) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error\n      };\n    }\n  },\n\n  // Supabase methods\n  from: (table: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from(table);\n  },\n\n  select: (columns?: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').select(columns); // Default to 'users', caller should use from() first\n  },\n\n  insert: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').insert(data); // Default to 'users', caller should use from() first\n  },\n\n  update: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').update(data); // Default to 'users', caller should use from() first\n  },\n\n  delete: () => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').delete(); // Default to 'users', caller should use from() first\n  }\n};\n\nexport default db;\n\n// Export the supabase client for direct use if needed\nexport { supabase };"],"names":["createClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_ANON_KEY","console","error","log","supabase","QueryResult","rows","rowCount","DatabaseClientInterface","query","text","params","Promise","from","table","select","columns","insert","data","update","delete","db","sql","Error","sqlLower","toLowerCase","trim","startsWith","tableName","selectMatch","match","hasWhere","includes","queryBuilder","whereRegex","whereMatch","whereClause","length","eq","genericPattern","parseInt","col","paramIdx","Array","isArray","insertMatch","columnsStr","replace","split","insertData","i","updateMatch","setClause","setData","setParts","map","p","paramIndex","forEach","part","key","value","whereConditions","whereParts","paramNum","substring","deleteMatch","valuePlaceholder"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 328, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/auth.ts"],"sourcesContent":["import NextAuth, { type AuthOptions } from 'next-auth';\nimport GoogleProvider from 'next-auth/providers/google';\nimport db from '@/lib/db'; // Your database connection\n\nconst authOptions: AuthOptions = {\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n    }),\n  ],\n  secret: process.env.NEXTAUTH_SECRET, // You should add this to your environment variables\n  session: {\n    strategy: 'jwt' as const, // Use JWT for session handling\n  },\n  callbacks: {\n    async signIn({ user, account, profile }) {\n      try {\n        console.log('NextAuth signIn callback invoked for user:', user?.email || profile?.email || profile?.sub);\n        \n        // First, try to find user by email (most reliable)\n        const existingUserByEmail = await db.query(\n          'SELECT id, email, name, role, google_id FROM users WHERE email = $1',\n          [user.email || '']\n        );\n        \n        let existingUser;\n        \n        if (existingUserByEmail.rows.length > 0) {\n          existingUser = existingUserByEmail.rows[0];\n          user.id = existingUser.id;\n          \n          // If user exists but doesn't have google_id set, update it\n          if (!existingUser.google_id && profile?.sub) {\n            try {\n              await db.query(\n                `UPDATE users SET google_id = $1, avatar = $2 WHERE email = $3`,\n                [profile.sub, user.image, user.email]\n              );\n              console.log('Updated existing user with Google ID:', user.email);\n            } catch (updateError) {\n              console.warn('Could not update user with Google ID (column might not exist):', updateError);\n              // Continue - the column might not exist yet\n            }\n          }\n        } else {\n          // User doesn't exist by email, try by google_id if available\n          if (profile?.sub) {\n            const existingUserByGoogle = await db.query(\n              'SELECT id, email, name, role FROM users WHERE google_id = $1',\n              [profile?.sub || '']\n            );\n            \n            if (existingUserByGoogle.rows.length > 0) {\n              existingUser = existingUserByGoogle.rows[0];\n              user.id = existingUser.id;\n              \n              // Update email if it changed\n              if (user.email && user.email !== existingUser.email) {\n                await db.query(\n                  'UPDATE users SET email = $1 WHERE id = $2',\n                  [user.email, existingUser.id]\n                );\n              }\n            }\n          }\n        }\n        \n        if (!existingUser) {\n          // User doesn't exist at all, create new user\n          try {\n            const insertResult = await db.query(\n              `INSERT INTO users (name, email, google_id, avatar, role, encrypted_password)\n               VALUES ($1, $2, $3, $4, $5, $6)\n               RETURNING id, email, name, role`,\n              [\n                user.name || user.email?.split('@')[0] || 'Google User',\n                user.email || '',\n                profile?.sub || '',\n                user.image || null,\n                'user', // Default role for Google auth users\n                null // No password for Google users\n              ]\n            );\n            \n            // Update user object with database user info\n            user.id = insertResult.rows[0].id;\n            console.log('Created new Google user:', user.email, 'with ID:', user.id);\n          } catch (insertError: any) {\n            if (insertError.message && insertError.message.includes('column \"google_id\" of relation \"users\" does not exist')) {\n              console.warn('google_id column does not exist, falling back to basic user creation');\n              // Fallback: create user without google_id\n              const insertResult = await db.query(\n                `INSERT INTO users (name, email, avatar, role, encrypted_password)\n                 VALUES ($1, $2, $3, $4, $5)\n                 RETURNING id, email, name, role`,\n                [\n                  user.name || user.email?.split('@')[0] || 'Google User',\n                  user.email || '',\n                  user.image || null,\n                  'user',\n                  null\n                ]\n              );\n              user.id = insertResult.rows[0].id;\n            } else {\n              throw insertError;\n            }\n          }\n        } else {\n          // User exists, update their info if needed\n          try {\n            await db.query(\n              `UPDATE users \n               SET name = COALESCE($1, name), avatar = COALESCE($2, avatar)\n               WHERE id = $3`,\n              [user.name, user.image, user.id]\n            );\n          } catch (updateError) {\n            console.warn('Could not update user info (google_id column might not exist):', updateError);\n            // Continue without updating\n          }\n        }\n        \n        console.log('signIn callback completed for', user?.email, 'with ID:', user.id);\n        return true; // Allow sign in\n      } catch (error) {\n        // Log the error but allow sign in to proceed to avoid blocking users when DB is down\n        console.error('Error in signIn callback (allowing sign in):', error);\n        return true; // Allow sign in even on DB errors\n      }\n    },\n    async jwt({ token, account, profile, user }) {\n      if (account) {\n        token.accessToken = account.access_token;\n        token.sub = profile?.sub;\n        token.email = profile?.email || user?.email;\n      }\n      \n      // Always ensure we have the correct database user ID in the token\n      // This is critical for Google users - we need the database ID, not the Google ID\n      if (user?.id) {\n        // User object from signIn callback has the database ID\n        token.id = user.id;\n        console.log('JWT callback: Set token.id from user.id:', token.id);\n      } else if (token.sub || token.email) {\n        // No user object (e.g., on token refresh), look up the database user ID\n        try {\n          // First try to find by email (most reliable)\n          if (token.email) {\n            const userByEmail = await db.query(\n              'SELECT id FROM users WHERE email = $1',\n              [token.email]\n            );\n            \n            if (userByEmail.rows.length > 0) {\n              token.id = userByEmail.rows[0].id;\n              console.log('JWT callback: Found user by email, set token.id:', token.id);\n            }\n          }\n          \n          // If not found by email, try google_id\n          if (!token.id && token.sub) {\n            const userQuery = await db.query(\n              'SELECT id FROM users WHERE google_id = $1',\n              [token.sub]\n            );\n            \n            if (userQuery.rows.length > 0) {\n              token.id = userQuery.rows[0].id;\n              console.log('JWT callback: Found user by google_id, set token.id:', token.id);\n            }\n          }\n          \n          // If still no token.id, we have a problem\n          if (!token.id) {\n            console.error('JWT callback: Could not find database user ID for token:', { sub: token.sub, email: token.email });\n          }\n        } catch (error) {\n          console.error('Error looking up user ID in jwt callback:', error);\n          // Don't update token.id if lookup fails, let the API handle the error\n        }\n      }\n      \n      // Log the token for debugging\n      if (process.env.NODE_ENV === 'development') {\n        console.log('JWT token prepared:', { \n          id: token.id, \n          email: token.email, \n          hasSub: !!token.sub,\n          sub: token.sub \n        });\n      }\n      \n      return token;\n    },\n    async session({ session, token }) {\n      if (session.user && token) {\n        // Add custom properties to session\n        (session.user as any).id = token.id as string;\n        // @ts-ignore\n        session.accessToken = token.accessToken;\n      }\n      return session;\n    },\n  },\n  // Add debug to see what's happening during auth\n  debug: process.env.NODE_ENV === 'development',\n};\n\nconst handler = NextAuth(authOptions);\n\nexport default handler;\nexport { handler as auth, authOptions };"],"names":["NextAuth","AuthOptions","GoogleProvider","db","authOptions","providers","clientId","process","env","GOOGLE_CLIENT_ID","clientSecret","GOOGLE_CLIENT_SECRET","secret","NEXTAUTH_SECRET","session","strategy","const","callbacks","signIn","user","account","profile","console","log","email","sub","existingUserByEmail","query","existingUser","rows","length","id","google_id","image","updateError","warn","existingUserByGoogle","insertResult","name","split","insertError","message","includes","error","jwt","token","accessToken","access_token","userByEmail","userQuery","NODE_ENV","hasSub","debug","handler","auth"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 535, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth from 'next-auth';\nimport { authOptions } from '@/lib/auth';\n\n// Export the handlers for Next.js\nconst handler = NextAuth(authOptions);\nexport { handler as GET, handler as POST };"],"names":["NextAuth","authOptions","handler","GET","POST"],"mappings":";;;;;;AAAA,OAAOA,QAAQ,MAAM,WAAW;AAChC,SAASC,WAAW,QAAQ,YAAY;;;AAExC,kCAAA;AACA,MAAMC,OAAO,OAAGF,kJAAQ,EAACC,mIAAW,CAAC","ignoreList":[],"debugId":null}}]
}