{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/db.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase clients\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.error('Error: Supabase environment variables not set');\n  console.log('Please make sure .env.local file contains:');\n  console.log('NEXT_PUBLIC_SUPABASE_URL=');\n  console.log('NEXT_PUBLIC_SUPABASE_ANON_KEY=');\n}\n\nconst supabase = supabaseUrl && supabaseAnonKey ? createClient(supabaseUrl, supabaseAnonKey) : null;\n\n// Define types to maintain compatibility with existing code\ntype QueryResult = {\n  rows: any[];\n  rowCount: number;\n  error?: any;\n};\n\ninterface DatabaseClientInterface {\n  query: (text: string, params?: any[]) => Promise<QueryResult>;\n  from: (table: string) => any;\n  select: (columns?: string) => any;\n  insert: (data: any) => any;\n  update: (data: any) => any;\n  delete: () => any;\n}\n\n// Create a wrapper that provides both direct query method and Supabase methods\nconst db: DatabaseClientInterface = {\n  // Direct query method that translates SQL to Supabase calls\n  query: async (sql: string, params?: any[]): Promise<QueryResult> => {\n    if (!supabase) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error: new Error('Supabase client not initialized')\n      };\n    }\n\n    try {\n      // Parse SQL to determine operation type\n      const sqlLower = sql.toLowerCase().trim();\n\n      if (sqlLower.startsWith('select')) {\n        // Parse SELECT query - more flexible to handle WHERE clauses and other parts\n        let columns, tableName;\n        const selectMatch = sql.match(/select\\s+(.*?)\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)/i);\n        if (!selectMatch) {\n          throw new Error('Could not parse SELECT query');\n        }\n        columns = selectMatch[1].trim();\n        tableName = selectMatch[2].trim();\n\n        // Check if there's a WHERE clause\n        const hasWhere = sqlLower.includes('where');\n        let queryBuilder = supabase.from(tableName).select(columns === '*' ? '*' : columns);\n\n        if (hasWhere) {\n          // Extract WHERE clause parts\n          const whereRegex = /where\\s+(.*?)(?:\\s+order\\s+by|\\s+limit|\\s+group\\s+by|$)/i;\n          const whereMatch = sql.match(whereRegex);\n\n          if (whereMatch && whereMatch[1]) {\n            const whereClause = whereMatch[1].trim();\n\n            // Handle different WHERE patterns with parameters\n            if (whereClause.includes('email = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('email', params[0]);\n            } else if (whereClause.includes('user_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]);\n            } else if (whereClause.includes('id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('id', params[0]);\n            } else if (whereClause.includes('product_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('product_id', params[0]);\n            } else if (whereClause.includes('user_id = $1 AND product_id = $2') && params && params.length >= 2) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]).eq('product_id', params[1]);\n            } else if (whereClause.includes('slug = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('slug', params[0]);\n            } else {\n              // Generic handling for other patterns - need to extract column name and parameter\n              const genericPattern = /([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*\\$(\\d+)/;\n              const match = whereClause.match(genericPattern);\n              if (match && params && params.length >= parseInt(match[2])) {\n                const col = match[1];\n                const paramIdx = parseInt(match[2]) - 1;\n                queryBuilder = queryBuilder.eq(col, params[paramIdx]);\n              }\n            }\n          }\n        }\n\n        const { data, error } = await queryBuilder;\n        if (error) {\n          return {\n            rows: [],\n            rowCount: 0,\n            error\n          };\n        }\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error: null\n        };\n      }\n      else if (sqlLower.startsWith('insert')) {\n        // Parse INSERT query\n        const insertMatch = sql.match(/insert\\s+into\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(\\s*([^)]+)\\s*\\)\\s+values\\s*\\(\\s*([^)]+)\\s*\\)/i);\n        if (!insertMatch) {\n          throw new Error('Could not parse INSERT query');\n        }\n\n        const tableName = insertMatch[1];\n        const columnsStr = insertMatch[2];\n        const columns = columnsStr.replace(/\\s/g, '').split(','); // Remove spaces and split by comma\n\n        if (!params || params.length === 0) {\n          throw new Error('INSERT query has no parameters');\n        }\n\n        // Create an object mapping columns to parameter values\n        const insertData: any = {};\n        for (let i = 0; i < columns.length && i < params.length; i++) {\n          insertData[columns[i]] = params[i];\n        }\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .insert(insertData)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      }\n      else if (sqlLower.startsWith('update')) {\n        // Parse UPDATE query\n        const updateMatch = sql.match(/update\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+set\\s+(.*?)\\s+where\\s+(.*)/i);\n        if (!updateMatch) {\n          throw new Error('Could not parse UPDATE query');\n        }\n\n        const tableName = updateMatch[1];\n        const setClause = updateMatch[2];\n        const whereClause = updateMatch[3];\n\n        // Parse SET clause: col1=$1, col2=$2, etc.\n        const setData: any = {};\n        const setParts = setClause.split(',').map(p => p.trim());\n        let paramIndex = 0;\n        setParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          setData[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        // Parse WHERE clause: col=$n, etc.\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        whereParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          const paramNum = parseInt(value.substring(1)) - 1; // Convert $2 to index 1\n          whereConditions[key] = params![paramNum];\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .update(setData)\n          .match(whereConditions)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      }\n      else if (sqlLower.startsWith('delete')) {\n        // Parse DELETE query\n        const deleteMatch = sql.match(/delete\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+where\\s+(.*)/i);\n        if (!deleteMatch) {\n          throw new Error('Could not parse DELETE query');\n        }\n\n        const tableName = deleteMatch[1];\n        const whereClause = deleteMatch[2];\n\n        // Parse WHERE clause\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        let paramIndex = 0;\n        whereParts.forEach(part => {\n          const [key, valuePlaceholder] = part.split('=').map(p => p.trim());\n          // Assuming the valuePlaceholder is like $1, $2, etc.\n          whereConditions[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .delete()\n          .match(whereConditions);\n\n        return {\n          rows: data ? [data] : [],\n          rowCount: data ? 1 : 0,\n          error\n        };\n      }\n      else {\n        throw new Error(`Unsupported SQL operation: ${sql.substring(0, 20)}...`);\n      }\n    } catch (error: any) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error\n      };\n    }\n  },\n\n  // Supabase methods\n  from: (table: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from(table);\n  },\n\n  select: (columns?: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').select(columns); // Default to 'users', caller should use from() first\n  },\n\n  insert: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').insert(data); // Default to 'users', caller should use from() first\n  },\n\n  update: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').update(data); // Default to 'users', caller should use from() first\n  },\n\n  delete: () => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').delete(); // Default to 'users', caller should use from() first\n  }\n};\n\nexport default db;\n\n// Export the supabase client for direct use if needed\nexport { supabase };"],"names":["createClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_ANON_KEY","console","error","log","supabase","QueryResult","rows","rowCount","DatabaseClientInterface","query","text","params","Promise","from","table","select","columns","insert","data","update","delete","db","sql","Error","sqlLower","toLowerCase","trim","startsWith","tableName","selectMatch","match","hasWhere","includes","queryBuilder","whereRegex","whereMatch","whereClause","length","eq","genericPattern","parseInt","col","paramIdx","Array","isArray","insertMatch","columnsStr","replace","split","insertData","i","updateMatch","setClause","setData","setParts","map","p","paramIndex","forEach","part","key","value","whereConditions","whereParts","paramNum","substring","deleteMatch","valuePlaceholder"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/slug.ts"],"sourcesContent":["// utils/slug.ts\nimport db from '@/lib/db';\n\n/**\n * Generate a unique slug from a product name\n * \n * @param {string} name - Product name to convert to a slug\n * @param {number} [excludeId] - Product ID to exclude if updating existing product\n * @returns {Promise<string>} - Unique slug for the product\n */\nexport const generateUniqueSlug = async (name: string, excludeId?: number): Promise<string> => {\n  // Basic slugification: convert to lowercase, replace spaces with hyphens, remove special characters\n  let baseSlug = name\n    .toLowerCase()\n    .replace(/[^\\w\\s-]/g, '') // Remove special characters\n    .replace(/[\\s_-]+/g, '-') // Replace spaces, underscores, and multiple hyphens with single hyphen\n    .replace(/^-+|-+$/g, ''); // Remove leading/trailing hyphens\n\n  // Ensure minimum length and handle empty slug\n  if (baseSlug.length < 3) {\n    baseSlug = `product-${Date.now()}-${Math.random().toString(36).substring(2, 8)}`;\n  }\n\n  // Check if the slug already exists in the database\n  let slug = baseSlug;\n  let counter = 1;\n  let isUnique = false;\n\n  while (!isUnique) {\n    try {\n      const query = excludeId \n        ? 'SELECT id FROM products WHERE slug = $1 AND id != $2' \n        : 'SELECT id FROM products WHERE slug = $1';\n      \n      const params = excludeId ? [slug, excludeId] : [slug];\n      \n      const result = await db.query(query, params);\n      \n      if (result.rows.length === 0) {\n        // Slug is unique\n        isUnique = true;\n      } else {\n        // Slug exists, add counter and try again\n        slug = `${baseSlug}-${counter}`;\n        counter++;\n      }\n    } catch (error) {\n      console.error('Error checking slug uniqueness:', error);\n      // If there's an error, fallback to a unique slug using timestamp\n      slug = `${baseSlug}-${Date.now()}`;\n      isUnique = true;\n    }\n  }\n\n  return slug;\n};"],"names":["db","generateUniqueSlug","name","excludeId","Promise","baseSlug","toLowerCase","replace","length","Date","now","Math","random","toString","substring","slug","counter","isUnique","query","params","result","rows","error","console"],"mappings":"AAAA,gBAAA;;;;;AACA,OAAOA,EAAE,MAAM,UAAU;;AASlB,MAAMC,kBAAkB,GAAG,MAAAA,CAAOC,IAAI,EAAE,AAAQC,MAAF,GAAoB,CAAR,EAAE,MAAM,CAAC,EAAEC,OAAO,CAAC,MAAM,CAAC,IAAI;IAC7F,oGAAA;IACA,IAAIC,QAAQ,GAAGH,IAAI,CAChBI,WAAW,CAAC,CAAC,CACbC,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC,4BAAA;KACzBA,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC,uEAAA;KACzBA,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC,CAAC,kCAAA;IAE5B,8CAAA;IACA,IAAIF,QAAQ,CAACG,MAAM,GAAG,CAAC,EAAE;QACvBH,QAAQ,GAAG,CAAA,QAAA,EAAWI,IAAI,CAACC,GAAG,CAAC,CAAC,CAAA,CAAA,EAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;IAClF;IAEA,mDAAA;IACA,IAAIC,IAAI,GAAGV,QAAQ;IACnB,IAAIW,OAAO,GAAG,CAAC;IACf,IAAIC,QAAQ,GAAG,KAAK;IAEpB,MAAO,CAACA,QAAQ,CAAE;QAChB,IAAI;YACF,MAAMC,KAAK,GAAGf,SAAS,GACnB,sDAAsD,GACtD,yCAAyC;YAE7C,MAAMgB,MAAM,GAAGhB,SAAS,GAAG;gBAACY,IAAI;gBAAEZ,SAAS;aAAC,GAAG;gBAACY,IAAI;aAAC;YAErD,MAAMK,MAAM,GAAG,MAAMpB,6HAAE,CAACkB,KAAK,CAACA,KAAK,EAAEC,MAAM,CAAC;YAE5C,IAAIC,MAAM,CAACC,IAAI,CAACb,MAAM,KAAK,CAAC,EAAE;gBAC5B,iBAAA;gBACAS,QAAQ,GAAG,IAAI;YACjB,CAAC,MAAM;gBACL,yCAAA;gBACAF,IAAI,GAAG,GAAGV,QAAQ,CAAA,CAAA,EAAIW,OAAO,EAAE;gBAC/BA,OAAO,EAAE;YACX;QACF,CAAC,CAAC,OAAOM,KAAK,EAAE;YACdC,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;YACvD,iEAAA;YACAP,IAAI,GAAG,GAAGV,QAAQ,CAAA,CAAA,EAAII,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;YAClCO,QAAQ,GAAG,IAAI;QACjB;IACF;IAEA,OAAOF,IAAI;AACb,CAAC","ignoreList":[],"debugId":null}},
    {"offset": {"line": 319, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/products/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport db from '@/lib/db';\nimport { generateUniqueSlug } from '@/lib/slug';\n\n// Handle preflight requests\nexport async function OPTIONS(request: NextRequest) {\n  return NextResponse.json({}, {\n    headers: {\n      \"Access-Control-Allow-Credentials\": \"true\",\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"GET,DELETE,PATCH,POST,PUT,OPTIONS\",\n      \"Access-Control-Allow-Headers\": \"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization\",\n    },\n  });\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Extract search, filter, and pagination parameters from query\n    const { searchParams } = new URL(request.url);\n    const search = searchParams.get('search') || '';\n    const category = searchParams.get('category') || '';\n    const minPrice = searchParams.get('minPrice') ? parseFloat(searchParams.get('minPrice')!) : null;\n    const maxPrice = searchParams.get('maxPrice') ? parseFloat(searchParams.get('maxPrice')!) : null;\n    const page = parseInt(searchParams.get('page') || '1');\n    const limit = parseInt(searchParams.get('limit') || '12');\n    const offset = (page - 1) * limit;\n\n    // Build the query with filtering conditions\n    let query = `\n      SELECT \n        p.id, \n        p.name, \n        p.description, \n        p.price, \n        p.category, \n        p.images, \n        p.stock_quantity,\n        p.created_at,\n        p.updated_at,\n        p.slug\n      FROM products p\n      WHERE 1=1\n    `;\n    const queryParams: any[] = [];\n\n    if (search) {\n      queryParams.push(`%${search}%`, `%${search}%`);\n      query += ` AND (p.name ILIKE $${queryParams.length - 1} OR p.description ILIKE $${queryParams.length})`;\n    }\n\n    if (category) {\n      queryParams.push(category);\n      query += ` AND p.category = $${queryParams.length}`;\n    }\n\n    if (minPrice !== null && !isNaN(minPrice)) {\n      queryParams.push(minPrice);\n      query += ` AND p.price >= $${queryParams.length}`;\n    }\n\n    if (maxPrice !== null && !isNaN(maxPrice)) {\n      queryParams.push(maxPrice);\n      query += ` AND p.price <= $${queryParams.length}`;\n    }\n\n    // Add pagination\n    queryParams.push(limit, offset);\n    query += ` ORDER BY p.created_at DESC LIMIT $${queryParams.length - 1} OFFSET $${queryParams.length}`;\n\n    // Get products with their associated images\n    const productsResult = await db.query(query, queryParams);\n\n    // For each product, try to fetch its associated images\n    // Handle case where product_images table might not exist yet\n    const productsWithImages = await Promise.all(productsResult.rows.map(async (product) => {\n      try {\n        const imagesResult = await db.query(\n          'SELECT image_url, is_primary, sort_order FROM product_images WHERE product_id = $1 ORDER BY sort_order',\n          [product.id]\n        );\n\n        return {\n          ...product,\n          images: imagesResult.rows.map((img: any) => img.image_url),\n          primary_image: imagesResult.rows.find((img: any) => img.is_primary)?.image_url || product.image_url\n        };\n      } catch (imageError) {\n        // If product_images table doesn't exist, return product with just the original image_url\n        console.warn(`Could not fetch images for product ${product.id}:`, (imageError as Error).message || imageError);\n        return {\n          ...product,\n          images: Array.isArray(product.images) ? product.images : (product.image_url ? [product.image_url] : []),\n          primary_image: product.image_url\n        };\n      }\n    }));\n\n    // Get total count for pagination\n    let countQuery = `SELECT COUNT(*) FROM products p WHERE 1=1`;\n    const countParams: any[] = [];\n\n    if (search) {\n      countParams.push(`%${search}%`, `%${search}%`);\n      countQuery += ` AND (p.name ILIKE $${countParams.length - 1} OR p.description ILIKE $${countParams.length})`;\n    }\n\n    if (category) {\n      countParams.push(category);\n      countQuery += ` AND p.category = $${countParams.length}`;\n    }\n\n    if (minPrice !== null && !isNaN(minPrice)) {\n      countParams.push(minPrice);\n      countQuery += ` AND p.price >= $${countParams.length}`;\n    }\n\n    if (maxPrice !== null && !isNaN(maxPrice)) {\n      countParams.push(maxPrice);\n      countQuery += ` AND p.price <= $${countParams.length}`;\n    }\n\n    const countResult = await db.query(countQuery, countParams);\n    const total = parseInt(countResult.rows[0].count);\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        products: productsWithImages,\n        pagination: {\n          page,\n          limit,\n          total,\n          pages: Math.ceil(total / limit),\n          hasMore: page < Math.ceil(total / limit)\n        },\n        filters: {\n          search,\n          category,\n          minPrice,\n          maxPrice\n        }\n      }\n    }, {\n      headers: {\n        \"Access-Control-Allow-Credentials\": \"true\",\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Methods\": \"GET,DELETE,PATCH,POST,PUT,OPTIONS\",\n        \"Access-Control-Allow-Headers\": \"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization\",\n      },\n    });\n  } catch (error) {\n    console.error('Error fetching products:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Internal server error'\n      },\n      {\n        status: 500,\n        headers: {\n          \"Access-Control-Allow-Credentials\": \"true\",\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Access-Control-Allow-Methods\": \"GET,DELETE,PATCH,POST,PUT,OPTIONS\",\n          \"Access-Control-Allow-Headers\": \"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization\",\n        },\n      }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { name, description, price, image_url, image_urls, category } = body;\n\n    if (!name || !description || !price || price <= 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Name, description, and price are required'\n        },\n        {\n          status: 400,\n          headers: {\n            \"Access-Control-Allow-Credentials\": \"true\",\n            \"Access-Control-Allow-Origin\": \"*\",\n            \"Access-Control-Allow-Methods\": \"GET,DELETE,PATCH,POST,PUT,OPTIONS\",\n            \"Access-Control-Allow-Headers\": \"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization\",\n          },\n        }\n      );\n    }\n\n    // Generate a unique slug for the product\n    const slug = await generateUniqueSlug(name);\n\n    // Create the product first\n    const productResult = await db.query(\n      'INSERT INTO products (name, description, price, image_url, category, slug) VALUES ($1, $2, $3, $4, $5, $6) RETURNING *',\n      [name, description, price, image_url, category, slug]\n    );\n\n    const product = productResult.rows[0];\n\n    // If multiple images are provided, add them to the product_images table\n    if (Array.isArray(image_urls) && image_urls.length > 0) {\n      try {\n        for (let i = 0; i < image_urls.length; i++) {\n          const isPrimary = i === 0; // Make the first image primary by default\n          await db.query(\n            'INSERT INTO product_images (product_id, image_url, is_primary, sort_order) VALUES ($1, $2, $3, $4)',\n            [product.id, image_urls[i], isPrimary, i]\n          );\n        }\n      } catch (insertError) {\n        console.warn(`Could not insert images for product ${product.id}:`, (insertError as Error).message || insertError);\n      }\n    } else if (image_url) {\n      // If only a single image is provided, add it as a primary image\n      try {\n        await db.query(\n          'INSERT INTO product_images (product_id, image_url, is_primary, sort_order) VALUES ($1, $2, $3, $4)',\n          [product.id, image_url, true, 0]\n        );\n      } catch (insertError) {\n        console.warn(`Could not insert image for product ${product.id}:`, (insertError as Error).message || insertError);\n      }\n    }\n\n    // Fetch the product with its images to return\n    // Handle case where product_images table might not exist yet\n    let productWithImages;\n    try {\n      const imagesResult = await db.query(\n        'SELECT image_url, is_primary, sort_order FROM product_images WHERE product_id = $1 ORDER BY sort_order',\n        [product.id]\n      );\n\n      productWithImages = {\n        ...product,\n        images: imagesResult.rows.map((img: any) => img.image_url),\n        primary_image: imagesResult.rows.find((img: any) => img.is_primary)?.image_url || product.image_url\n      };\n    } catch (imageError) {\n      // If product_images table doesn't exist, return product with just the original image_url\n      console.warn(`Could not fetch images for product ${product.id}:`, (imageError as Error).message || imageError);\n      productWithImages = {\n        ...product,\n        images: product.image_url ? [product.image_url] : [],\n        primary_image: product.image_url\n      };\n    }\n\n    return NextResponse.json(\n      {\n        success: true,\n        data: productWithImages\n      },\n      {\n        status: 201,\n        headers: {\n          \"Access-Control-Allow-Credentials\": \"true\",\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Access-Control-Allow-Methods\": \"GET,DELETE,PATCH,POST,PUT,OPTIONS\",\n          \"Access-Control-Allow-Headers\": \"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization\",\n        },\n      }\n    );\n  } catch (error) {\n    console.error('Error creating product:', error);\n    return NextResponse.json(\n      {\n        success: false,\n        error: 'Internal server error'\n      },\n      {\n        status: 500,\n        headers: {\n          \"Access-Control-Allow-Credentials\": \"true\",\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"Access-Control-Allow-Methods\": \"GET,DELETE,PATCH,POST,PUT,OPTIONS\",\n          \"Access-Control-Allow-Headers\": \"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization\",\n        },\n      }\n    );\n  }\n}"],"names":["NextRequest","NextResponse","db","generateUniqueSlug","OPTIONS","request","json","headers","GET","searchParams","URL","url","search","get","category","minPrice","parseFloat","maxPrice","page","parseInt","limit","offset","query","queryParams","push","length","isNaN","productsResult","productsWithImages","Promise","all","rows","map","product","imagesResult","id","images","img","image_url","primary_image","find","is_primary","imageError","console","warn","Error","message","Array","isArray","countQuery","countParams","countResult","total","count","success","data","products","pagination","pages","Math","ceil","hasMore","filters","error","status","POST","body","name","description","price","image_urls","slug","productResult","i","isPrimary","insertError","productWithImages"],"mappings":"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","ignoreList":[],"debugId":null}}]
}