{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/db.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase client\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || process.env.SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  console.error('Error: Supabase environment variables not set');\n  console.log('Please make sure .env.local file contains:');\n  console.log('NEXT_PUBLIC_SUPABASE_URL=');\n  console.log('NEXT_PUBLIC_SUPABASE_ANON_KEY=');\n}\n\nconst supabase = supabaseUrl && supabaseAnonKey ? createClient(supabaseUrl, supabaseAnonKey) : null;\n\n// Define types to maintain compatibility with existing code\ntype QueryResult = {\n  rows: any[];\n  rowCount: number;\n  error?: any;\n};\n\ninterface DatabaseClientInterface {\n  query: (text: string, params?: any[]) => Promise<QueryResult>;\n  from: (table: string) => any;\n  select: (columns?: string) => any;\n  insert: (data: any) => any;\n  update: (data: any) => any;\n  delete: () => any;\n}\n\n// Create a wrapper that provides both direct query method and Supabase methods\nconst db: DatabaseClientInterface = {\n  // Direct query method that translates SQL to Supabase calls\n  query: async (sql: string, params?: any[]): Promise<QueryResult> => {\n    if (!supabase) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error: new Error('Supabase client not initialized')\n      };\n    }\n\n    try {\n      // Parse SQL to determine operation type\n      const sqlLower = sql.toLowerCase().trim();\n      \n      if (sqlLower.startsWith('select')) {\n        // Parse SELECT query\n        const selectMatch = sql.match(/select\\s+(.*?)\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*/i);\n        if (!selectMatch) {\n          throw new Error('Could not parse SELECT query');\n        }\n\n        const columns = selectMatch[1].trim();\n        const tableName = selectMatch[2].trim();\n\n        // Check if there's a WHERE clause\n        const hasWhere = sqlLower.includes('where');\n        let queryBuilder = supabase.from(tableName).select(columns === '*' ? '*' : columns);\n\n        if (hasWhere) {\n          // Extract WHERE clause parts\n          const whereRegex = /where\\s+(.*?)(?:\\s+order\\s+by|\\s+limit|\\s+group\\s+by|$)/i;\n          const whereMatch = sql.match(whereRegex);\n\n          if (whereMatch && whereMatch[1]) {\n            const whereClause = whereMatch[1].trim();\n            \n            // Handle different WHERE patterns with parameters\n            if (whereClause.includes('email = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('email', params[0]);\n            } else if (whereClause.includes('user_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]);\n            } else if (whereClause.includes('id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('id', params[0]);\n            } else if (whereClause.includes('product_id = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('product_id', params[0]);\n            } else if (whereClause.includes('user_id = $1 AND product_id = $2') && params && params.length >= 2) {\n              queryBuilder = queryBuilder.eq('user_id', params[0]).eq('product_id', params[1]);\n            } else if (whereClause.includes('slug = $1') && params && params.length >= 1) {\n              queryBuilder = queryBuilder.eq('slug', params[0]);\n            } else {\n              // Generic handling for other patterns - need to extract column name and parameter\n              const genericPattern = /([a-zA-Z_][a-zA-Z0-9_]*)\\s*=\\s*\\$(\\d+)/;\n              const match = whereClause.match(genericPattern);\n              if (match && params && params.length >= parseInt(match[2])) {\n                const col = match[1];\n                const paramIdx = parseInt(match[2]) - 1;\n                queryBuilder = queryBuilder.eq(col, params[paramIdx]);\n              }\n            }\n          }\n        }\n\n        const { data, error } = await queryBuilder;\n        if (error) {\n          return {\n            rows: [],\n            rowCount: 0,\n            error\n          };\n        }\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error: null\n        };\n      } \n      else if (sqlLower.startsWith('insert')) {\n        // Parse INSERT query\n        const insertMatch = sql.match(/insert\\s+into\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(\\s*([^)]+)\\s*\\)\\s+values\\s*\\(\\s*([^)]+)\\s*\\)/i);\n        if (!insertMatch) {\n          throw new Error('Could not parse INSERT query');\n        }\n\n        const tableName = insertMatch[1];\n        const columnsStr = insertMatch[2];\n        const columns = columnsStr.replace(/\\s/g, '').split(','); // Remove spaces and split by comma\n\n        if (!params || params.length === 0) {\n          throw new Error('INSERT query has no parameters');\n        }\n\n        // Create an object mapping columns to parameter values\n        const insertData: any = {};\n        for (let i = 0; i < columns.length && i < params.length; i++) {\n          insertData[columns[i]] = params[i];\n        }\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .insert(insertData)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      } \n      else if (sqlLower.startsWith('update')) {\n        // Parse UPDATE query\n        const updateMatch = sql.match(/update\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+set\\s+(.*?)\\s+where\\s+(.*)/i);\n        if (!updateMatch) {\n          throw new Error('Could not parse UPDATE query');\n        }\n\n        const tableName = updateMatch[1];\n        const setClause = updateMatch[2];\n        const whereClause = updateMatch[3];\n\n        // Parse SET clause: col1=$1, col2=$2, etc.\n        const setData: any = {};\n        const setParts = setClause.split(',').map(p => p.trim());\n        let paramIndex = 0;\n        setParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values\n          setData[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        // Parse WHERE clause: col=$n, etc.\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        whereParts.forEach(part => {\n          const [key, value] = part.split('=').map(p => p.trim());\n          // Map $1, $2 etc to actual parameter values  \n          const paramNum = parseInt(value.substring(1)) - 1; // Convert $2 to index 1\n          whereConditions[key] = params![paramNum];\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .update(setData)\n          .match(whereConditions)\n          .select();\n\n        return {\n          rows: Array.isArray(data) ? data : (data ? [data] : []),\n          rowCount: data ? (Array.isArray(data) ? data.length : 1) : 0,\n          error\n        };\n      } \n      else if (sqlLower.startsWith('delete')) {\n        // Parse DELETE query\n        const deleteMatch = sql.match(/delete\\s+from\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+where\\s+(.*)/i);\n        if (!deleteMatch) {\n          throw new Error('Could not parse DELETE query');\n        }\n\n        const tableName = deleteMatch[1];\n        const whereClause = deleteMatch[2];\n\n        // Parse WHERE clause\n        const whereConditions: any = {};\n        const whereParts = whereClause.split('AND').map(p => p.trim());\n        let paramIndex = 0;\n        whereParts.forEach(part => {\n          const [key, valuePlaceholder] = part.split('=').map(p => p.trim());\n          // Assuming the valuePlaceholder is like $1, $2, etc.\n          whereConditions[key] = params![paramIndex];\n          paramIndex++;\n        });\n\n        const { data, error } = await supabase\n          .from(tableName)\n          .delete()\n          .match(whereConditions);\n\n        return {\n          rows: data ? [data] : [],\n          rowCount: data ? 1 : 0,\n          error\n        };\n      } \n      else {\n        throw new Error(`Unsupported SQL operation: ${sql.substring(0, 20)}...`);\n      }\n    } catch (error: any) {\n      return {\n        rows: [],\n        rowCount: 0,\n        error\n      };\n    }\n  },\n  \n  // Supabase methods\n  from: (table: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from(table);\n  },\n  \n  select: (columns?: string) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').select(columns); // Default to 'users', caller should use from() first\n  },\n  \n  insert: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').insert(data); // Default to 'users', caller should use from() first\n  },\n  \n  update: (data: any) => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').update(data); // Default to 'users', caller should use from() first\n  },\n  \n  delete: () => {\n    if (!supabase) {\n      throw new Error('Supabase client not initialized');\n    }\n    return supabase.from('users').delete(); // Default to 'users', caller should use from() first  \n  }\n};\n\nexport default db;\n\n// Export the supabase client for direct use if needed\nexport { supabase };"],"names":["createClient","supabaseUrl","process","env","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_URL","supabaseAnonKey","NEXT_PUBLIC_SUPABASE_ANON_KEY","SUPABASE_ANON_KEY","console","error","log","supabase","QueryResult","rows","rowCount","DatabaseClientInterface","query","text","params","Promise","from","table","select","columns","insert","data","update","delete","db","sql","Error","sqlLower","toLowerCase","trim","startsWith","selectMatch","match","tableName","hasWhere","includes","queryBuilder","whereRegex","whereMatch","whereClause","length","eq","genericPattern","parseInt","col","paramIdx","Array","isArray","insertMatch","columnsStr","replace","split","insertData","i","updateMatch","setClause","setData","setParts","map","p","paramIndex","forEach","part","key","value","whereConditions","whereParts","paramNum","substring","deleteMatch","valuePlaceholder"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 309, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/cart/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport db from '@/lib/db'; // Use Supabase database connection (same as other APIs)\nimport { getToken } from 'next-auth/jwt';\n\n// Helper function to get user by token\nasync function getUserIdFromRequest(request: NextRequest): Promise<{ userId: number | null, authType: 'google' | 'email' | null }> {\n  // First try: NextAuth JWT token (Google auth)\n  try {\n    const token = await getToken({ req: request, secret: process.env.NEXTAUTH_SECRET });\n    if (token && (token.sub || token.id)) {\n      return await getUserIdFromNextAuthToken(token);\n    }\n  } catch (e) {\n    console.log('NextAuth token not found or invalid, trying Bearer token...');\n  }\n  \n  // Second try: Custom Bearer token (email/password auth)\n  const authHeader = request.headers.get('authorization');\n  if (authHeader && authHeader.startsWith('Bearer ')) {\n    return await getUserIdFromBearerToken(authHeader);\n  }\n  \n  return { userId: null, authType: null };\n}\n\n// Helper for NextAuth tokens\nasync function getUserIdFromNextAuthToken(token: any): Promise<{ userId: number | null, authType: 'google' }> {\n  let userIdValue = token.id || token.sub;\n  \n  if (typeof userIdValue === 'number') {\n    userIdValue = userIdValue.toString();\n  } else if (typeof userIdValue !== 'string') {\n    throw new Error('Invalid userId type from token');\n  }\n  \n  let userIdNum = parseInt(userIdValue as string, 10);\n  \n  // Check if out of range (Google IDs are too large for PostgreSQL INT4)\n  if (isNaN(userIdNum) || userIdNum <= 0 || userIdNum > 2147483647 || userIdNum < -2147483648) {\n    // Try to find user by email first\n    if (token.email) {\n      const userByEmail = await db.query(\n        'SELECT id FROM users WHERE email = $1',\n        [token.email]\n      );\n      \n      if (userByEmail.rows.length > 0) {\n        userIdNum = userByEmail.rows[0].id;\n        return { userId: userIdNum, authType: 'google' };\n      }\n    }\n    \n    // Try google_id column\n    if (userIdValue) {\n      try {\n        const userLookup = await db.query(\n          'SELECT id FROM users WHERE google_id = $1',\n          [userIdValue as string]\n        );\n        \n        if (userLookup.rows.length > 0) {\n          userIdNum = userLookup.rows[0].id;\n          return { userId: userIdNum, authType: 'google' };\n        }\n      } catch (e) {\n        // google_id column might not exist\n      }\n    }\n    \n    throw new Error('User not found');\n  }\n  \n  return { userId: userIdNum, authType: 'google' };\n}\n\n// Helper for Bearer tokens (email/password auth)\n// Helper for Bearer tokens (email/password auth)\nasync function getUserIdFromBearerToken(authHeader: string): Promise<{ userId: number | null, authType: 'email' }> {\n  const token = authHeader.replace('Bearer ', '');\n\n  // Extract user ID from our mock token format: 'mock-jwt-token-for-user-{userId}'\n  const userTokenPattern = /mock-jwt-token-for-user-(\\d+)/;\n  const match = token.match(userTokenPattern);\n\n  if (match && match[1]) {\n    const userId = parseInt(match[1], 10);\n    if (!isNaN(userId) && userId > 0) {\n      // Verify that this user actually exists in the database\n      const { rows } = await db.query('SELECT id FROM users WHERE id = $1', [userId]);\n      if (rows.length > 0) {\n        return { userId: rows[0].id, authType: 'email' };\n      }\n    }\n  }\n\n  // Fallback: If we can't extract user from token, try to find a default user\n  const { rows } = await db.query(\n    \"SELECT id FROM users WHERE email = $1 LIMIT 1\",\n    ['john@example.com']\n  );\n\n  if (rows.length > 0) {\n    return { userId: rows[0].id, authType: 'email' };\n  }\n\n  throw new Error('User not found for Bearer token');\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    // Support both NextAuth and Bearer token authentication\n    const { userId, authType } = await getUserIdFromRequest(request);\n\n    if (userId && authType) {\n      console.log(`Fetching cart for ${authType} user: ${userId}`);\n      \n      // Validate the parsed userId\n      if (userId <= 0) {\n        console.error('Invalid userId from token');\n        return NextResponse.json(\n          { success: false, error: 'Invalid user authentication' },\n          { status: 401 }\n        );\n      }\n      \n      // First, get cart items for this user\n      const cartItemsResult = await db.query(\n        `SELECT id, product_id, quantity FROM cart_items WHERE user_id = $1`,\n        [userId]\n      );\n\n      if (cartItemsResult.error) {\n        throw cartItemsResult.error;\n      }\n\n      // If there are cart items, get the product details for each\n      if (cartItemsResult.rows.length > 0) {\n        // Create a list of promises to fetch product details\n        const productPromises = cartItemsResult.rows.map(async (cartItem) => {\n          // Get product details (excluding originalPrice and discount since they may not exist in the database)\n          const productResult = await db.query(\n            `SELECT id, name, price, image_url FROM products WHERE id = $1`,\n            [cartItem.product_id]\n          );\n          \n          // Add default values for missing fields\n          const productRow = {\n            ...productResult.rows[0],\n            originalPrice: null,\n            discount: 0\n          };\n\n          if (productResult.rows.length > 0) {\n            return {\n              ...cartItem,\n              name: productRow.name,\n              price: productRow.price,\n              image_url: productRow.image_url,\n              originalPrice: productRow.originalPrice,\n              discount: productRow.discount\n            };\n          } else {\n            // Product might have been deleted, return cart item with minimal info\n            return {\n              ...cartItem,\n              name: 'Product not found',\n              price: 0,\n              image_url: null\n            };\n          }\n        });\n\n        const cartItemsWithDetails = await Promise.all(productPromises);\n        return NextResponse.json({\n          success: true,\n          data: cartItemsWithDetails\n        });\n      } else {\n        // No cart items\n        return NextResponse.json({\n          success: true,\n          data: []\n        });\n      }\n    } else {\n      // Unauthenticated user - return empty cart or handle client-side cart\n      return NextResponse.json({\n        success: true,\n        data: []\n      });\n    }\n  } catch (error) {\n    console.error('Error fetching cart items:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Support both NextAuth and Bearer token authentication\n    const { userId, authType } = await getUserIdFromRequest(request);\n    \n    const body = await request.json();\n    const { product_id, quantity = 1 } = body;\n\n    // Validate that product_id is a valid number\n    if (!product_id || typeof product_id !== 'number' || isNaN(product_id) || product_id <= 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Valid product ID is required'\n        },\n        { status: 400 }\n      );\n    }\n\n    if (quantity <= 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Quantity must be greater than 0'\n        },\n        { status: 400 }\n      );\n    }\n\n    // Check if product exists (excluding originalPrice and discount since they may not exist in the database)\n    const productResult = await db.query('SELECT id, name, price, image_url FROM products WHERE id = $1', [product_id]);\n    \n    // Add default values for missing fields\n    productResult.rows = productResult.rows.map(row => ({\n      ...row,\n      originalPrice: null,\n      discount: 0\n    }));\n    if (productResult.rows.length === 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Product not found'\n        },\n        { status: 404 }\n      );\n    }\n\n    const product = productResult.rows[0];\n\n    if (userId && authType) {\n      console.log(`Adding to cart for ${authType} user: ${userId}`);\n      \n      // Validate the parsed userId\n      if (userId <= 0) {\n        console.error('Invalid userId from token');\n        return NextResponse.json(\n          { success: false, error: 'Invalid user authentication' },\n          { status: 401 }\n        );\n      }\n\n      console.log('Adding to cart for user:', userId, 'product:', product_id);\n\n      // First check if the cart item already exists\n      const existingItemResult = await db.query(\n        'SELECT id, quantity FROM cart_items WHERE user_id = $1 AND product_id = $2',\n        [userId, product_id]\n      );\n      \n      let result;\n      if (existingItemResult.rows.length > 0) {\n        // Item exists, update the quantity by adding to existing quantity\n        const newQuantity = existingItemResult.rows[0].quantity + quantity;\n        const updateResult = await db.query(\n          'UPDATE cart_items SET quantity = $1 WHERE user_id = $2 AND product_id = $3 RETURNING id, product_id, quantity',\n          [newQuantity, userId, product_id]\n        );\n\n        if (updateResult.error) {\n          console.error('Error updating cart item:', updateResult.error);\n          return NextResponse.json(\n            { success: false, error: 'Failed to update cart item' },\n            { status: 500 }\n          );\n        }\n\n        if (updateResult.rows.length === 0) {\n          return NextResponse.json(\n            { success: false, error: 'Failed to update cart item' },\n            { status: 500 }\n          );\n        }\n        \n        result = updateResult.rows[0];\n      } else {\n        // Item doesn't exist, insert new cart item\n        const insertResult = await db.query(\n          'INSERT INTO cart_items (user_id, product_id, quantity) VALUES ($1, $2, $3) RETURNING id, product_id, quantity',\n          [userId, product_id, quantity]\n        );\n\n        if (insertResult.error) {\n          // Check if it's a duplicate key error (race condition - another request inserted it)\n          if (insertResult.error.code === '23505' || \n              insertResult.error.message?.toLowerCase().includes('duplicate') ||\n              insertResult.error.message?.toLowerCase().includes('unique')) {\n            // Race condition: item was inserted by another request, update instead\n            const newQuantity = 1 + quantity;  // existing was 1, add the requested quantity\n            const updateResult = await db.query(\n              'UPDATE cart_items SET quantity = $1 WHERE user_id = $2 AND product_id = $3 RETURNING id, product_id, quantity',\n              [newQuantity, userId, product_id]\n            );\n            \n            if (updateResult.error || updateResult.rows.length === 0) {\n              return NextResponse.json(\n                { success: false, error: 'Failed to add item to cart' },\n                { status: 500 }\n              );\n            }\n            result = updateResult.rows[0];\n          } else {\n            console.error('Error inserting cart item:', insertResult.error);\n            return NextResponse.json(\n              { success: false, error: 'Failed to add item to cart' },\n              { status: 500 }\n            );\n          }\n        } else if (insertResult.rows.length === 0) {\n          return NextResponse.json(\n            { success: false, error: 'Failed to add item to cart' },\n            { status: 500 }\n          );\n        } else {\n          result = insertResult.rows[0];\n        }\n      }\n\n      // Check if result exists before accessing its properties\n      if (!result) {\n        return NextResponse.json(\n          { success: false, error: 'Cart operation failed' },\n          { status: 500 }\n        );\n      }\n\n      // Return the updated cart item with product details\n      return NextResponse.json(\n        {\n          success: true,\n          data: {\n            id: result.id,\n            product_id: result.product_id,\n            name: product.name,\n            price: product.price,\n            quantity: result.quantity,\n            image_url: product.image_url\n          }\n        },\n        { status: 200 }\n      );\n    } else {\n      // Unauthenticated user - return cart item for client-side cart\n      return NextResponse.json(\n        {\n          success: true,\n          data: {\n            id: 0, // Will be assigned when user logs in\n            product_id,\n            name: product.name,\n            price: product.price,\n            quantity,\n            image_url: product.image_url,\n            user_id: null // Indicates guest cart\n          }\n        },\n        { status: 200 }\n      );\n    }\n  } catch (error) {\n    console.error('Error adding to cart:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    // Support both NextAuth and Bearer token authentication\n    const { userId, authType } = await getUserIdFromRequest(request);\n    \n    const body = await request.json();\n    const { product_id, quantity } = body;\n\n    // Validate that product_id is a valid number\n    if (!product_id || typeof product_id !== 'number' || isNaN(product_id) || product_id <= 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Valid product ID is required'\n        },\n        { status: 400 }\n      );\n    }\n\n    if (typeof quantity !== 'number' || isNaN(quantity) || quantity < 0) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: 'Valid quantity is required'\n        },\n        { status: 400 }\n      );\n    }\n\n    if (!userId) {\n      return NextResponse.json(\n        { success: false, error: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    // Validate the parsed userId\n    if (userId <= 0) {\n      console.error('Invalid userId from token');\n      return NextResponse.json(\n        { success: false, error: 'Invalid user authentication' },\n        { status: 401 }\n      );\n    }\n\n    if (quantity === 0) {\n      // Remove item when quantity is 0\n      // First, check if the cart item exists\n      const existingItemResult = await db.query(\n        'SELECT id FROM cart_items WHERE user_id = $1 AND product_id = $2',\n        [userId, product_id]\n      );\n      \n      if (existingItemResult.rows.length === 0) {\n        return NextResponse.json(\n          { success: false, error: 'Cart item not found' },\n          { status: 404 }\n        );\n      }\n      \n      const deleteResult = await db.query(\n        'DELETE FROM cart_items WHERE user_id = $1 AND product_id = $2',\n        [userId, product_id]\n      );\n      \n      if (deleteResult.error) {\n        throw deleteResult.error;\n      }\n      \n      return NextResponse.json(\n        {\n          success: true,\n          message: 'Item removed from cart'\n        },\n        { status: 200 }\n      );\n    } else {\n      // Update quantity\n      // First, check if the cart item exists\n      const existingItemResult = await db.query(\n        'SELECT id FROM cart_items WHERE user_id = $1 AND product_id = $2',\n        [userId, product_id]\n      );\n      \n      if (existingItemResult.rows.length === 0) {\n        return NextResponse.json(\n          { success: false, error: 'Cart item not found' },\n          { status: 404 }\n        );\n      }\n\n      const updateResult = await db.query(\n        'UPDATE cart_items SET quantity = $1 WHERE user_id = $2 AND product_id = $3',\n        [quantity, userId, product_id]\n      );\n\n      if (updateResult.error) {\n        throw updateResult.error;\n      }\n\n      // Get the updated cart item\n      const updatedCartItemResult = await db.query(\n        'SELECT id, product_id, quantity FROM cart_items WHERE user_id = $1 AND product_id = $2',\n        [userId, product_id]\n      );\n      \n      // Get product details to return with updated cart item (excluding originalPrice and discount since they may not exist in the database)\n      const productResult = await db.query(\n        'SELECT id, name, price, image_url FROM products WHERE id = $1',\n        [product_id]\n      );\n      \n      // Add default values for missing fields\n      const productRow = {\n        ...productResult.rows[0],\n        originalPrice: null,\n        discount: 0\n      };\n\n      return NextResponse.json(\n        {\n          success: true,\n          data: {\n            id: updatedCartItemResult.rows[0].id,\n            product_id: updatedCartItemResult.rows[0].product_id,\n            quantity: updatedCartItemResult.rows[0].quantity,\n            name: productResult.rows[0]?.name || 'Unknown Product',\n            price: productResult.rows[0]?.price,\n            image_url: productResult.rows[0]?.image_url\n          }\n        },\n        { status: 200 }\n      );\n    }\n  } catch (error) {\n    console.error('Error updating cart item:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  try {\n    const token = await getToken({ req: request, secret: process.env.NEXTAUTH_SECRET });\n\n    if (token && (token.sub || token.id)) {\n      // Authenticated user - clear database cart\n      let userIdValue = token.id || token.sub;\n      \n      // Handle different possible types for userIdValue\n      if (typeof userIdValue === 'number') {\n        userIdValue = userIdValue.toString();\n      } else if (typeof userIdValue === 'string') {\n        // Already a string, continue\n      } else {\n        console.error('Invalid userId type from token:', typeof userIdValue, 'Full token:', token);\n        return NextResponse.json(\n          { success: false, error: 'Invalid user authentication' },\n          { status: 401 }\n        );\n      }\n      \n      // Parse as integer but check for out of range for PostgreSQL INT4 (integer)\n      let userIdNum = parseInt(userIdValue as string, 10);\n      \n      // Check if the number is valid and in range for PostgreSQL INT4 (integer)\n      if (isNaN(userIdNum) || userIdNum <= 0 || userIdNum > 2147483647 || userIdNum < -2147483648) {\n        console.error('Invalid userId or out of range from token:', userIdValue, 'Full token:', token);\n        \n        // For very large IDs (like Google IDs), try to look up the database user ID\n        // Google IDs are typically too large for PostgreSQL INT4, but are stored in google_id column\n        try {\n          // Try to find user by email first (most reliable for Google users)\n          if (token.email) {\n            const userByEmail = await db.query(\n              'SELECT id FROM users WHERE email = $1',\n              [token.email]\n            );\n            \n            if (userByEmail.rows.length > 0) {\n              userIdNum = userByEmail.rows[0].id;\n              console.log('Found user by email:', token.email, '-> ID:', userIdNum);\n            }\n          }\n          \n          // If not found by email, try google_id\n          if (!userIdNum || userIdNum <= 0) {\n            try {\n              const userLookup = await db.query(\n                'SELECT id FROM users WHERE google_id = $1',\n                [userIdValue as string]\n              );\n              \n              if (userLookup.rows.length > 0) {\n                userIdNum = userLookup.rows[0].id;\n                console.log('Mapped Google ID to database user ID:', userIdValue, '->', userIdNum);\n              } else {\n                // This is not a known Google ID, return error\n                console.error('No matching user found for Google ID:', userIdValue);\n                return NextResponse.json(\n                  { success: false, error: 'Invalid user authentication - user ID out of range' },\n                  { status: 401 }\n                );\n              }\n            } catch (lookupError: any) {\n              console.error('Error looking up user by Google ID:', lookupError);\n              // If column doesn't exist, try to create it or use alternative\n              if (lookupError.message && lookupError.message.includes('column \"google_id\" does not exist')) {\n                console.warn('google_id column does not exist, attempting alternative lookup...');\n                // For now, return error - the schema needs to be updated\n                return NextResponse.json(\n                  { success: false, error: 'Database schema needs update. Please run: ALTER TABLE users ADD COLUMN google_id VARCHAR(255) UNIQUE;' },\n                  { status: 500 }\n                );\n              }\n              return NextResponse.json(\n                { success: false, error: 'Invalid user authentication - user ID out of range' },\n                { status: 401 }\n              );\n            }\n          }\n        } catch (lookupError) {\n          console.error('Error looking up user:', lookupError);\n          return NextResponse.json(\n            { success: false, error: 'Invalid user authentication - user ID out of range' },\n            { status: 401 }\n          );\n        }\n      }\n\n      const userId = userIdNum;\n\n      // Validate the parsed userId\n      if (userId <= 0) {\n        console.error('Invalid userId parsed from token:', userIdValue, 'Full token:', token);\n        return NextResponse.json(\n          { success: false, error: 'Invalid user authentication' },\n          { status: 401 }\n        );\n      }\n      \n      await db.query('DELETE FROM cart_items WHERE user_id = $1', [userId]);\n\n      return NextResponse.json(\n        {\n          success: true,\n          message: 'Cart cleared'\n        },\n        { status: 200 }\n      );\n    } else {\n      // Unauthenticated user - return success for client-side cart handling\n      return NextResponse.json(\n        {\n          success: true,\n          message: 'Cart cleared'\n        },\n        { status: 200 }\n      );\n    }\n  } catch (error) {\n    console.error('Error clearing cart:', error);\n    return NextResponse.json(\n      { success: false, error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"],"names":["NextRequest","NextResponse","db","getToken","getUserIdFromRequest","request","Promise","userId","authType","token","req","secret","process","env","NEXTAUTH_SECRET","sub","id","getUserIdFromNextAuthToken","e","console","log","authHeader","headers","get","startsWith","getUserIdFromBearerToken","userIdValue","toString","Error","userIdNum","parseInt","isNaN","email","userByEmail","query","rows","length","userLookup","replace","userTokenPattern","match","GET","error","json","success","status","cartItemsResult","productPromises","map","cartItem","productResult","product_id","productRow","originalPrice","discount","name","price","image_url","cartItemsWithDetails","all","data","POST","body","quantity","row","product","existingItemResult","result","newQuantity","updateResult","insertResult","code","message","toLowerCase","includes","user_id","PUT","deleteResult","updatedCartItemResult","DELETE","lookupError","warn"],"mappings":"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","ignoreList":[],"debugId":null}}]
}