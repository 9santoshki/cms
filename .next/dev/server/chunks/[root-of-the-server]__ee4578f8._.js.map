{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/checkout/create/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport Razorpay from 'razorpay';\nimport { createClient } from '@supabase/supabase-js';\n\n// Initialize Razorpay instance\nconst razorpay = new Razorpay({\n  key_id: process.env.RAZORPAY_KEY_ID!,\n  key_secret: process.env.RAZORPAY_KEY_SECRET!,\n});\n\n// Initialize Supabase client\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY! // Using service role to bypass RLS\n);\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { items, shipping_address } = body;\n\n    if (!items || !Array.isArray(items) || items.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Cart items are required' },\n        { status: 400 }\n      );\n    }\n\n    if (!shipping_address) {\n      return NextResponse.json(\n        { success: false, error: 'Shipping address is required' },\n        { status: 400 }\n      );\n    }\n\n    // Calculate total amount\n    let totalAmount = 0;\n    for (const item of items) {\n      if (typeof item.price === 'number' && typeof item.quantity === 'number') {\n        totalAmount += item.price * item.quantity;\n      }\n    }\n\n    if (totalAmount <= 0) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid cart total' },\n        { status: 400 }\n      );\n    }\n\n    // Create Razorpay order\n    const options = {\n      amount: Math.round(totalAmount * 100), // Amount in paise (lowest currency unit)\n      currency: 'INR',\n      receipt: `receipt_${Date.now()}`,\n    };\n\n    const order = await razorpay.orders.create(options);\n\n    // Here we would typically save the order to our database\n    // For now, we'll just return the order info to be used in the frontend\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        razorpay_order_id: order.id,\n        amount: order.amount,\n        currency: order.currency,\n        total_amount: totalAmount,\n      }\n    });\n  } catch (error: any) {\n    console.error('Error creating checkout session:', error);\n    return NextResponse.json(\n      { success: false, error: error.message || 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"],"names":["NextRequest","NextResponse","Razorpay","createClient","razorpay","key_id","process","env","RAZORPAY_KEY_ID","key_secret","RAZORPAY_KEY_SECRET","supabase","NEXT_PUBLIC_SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","POST","request","body","json","items","shipping_address","Array","isArray","length","success","error","status","totalAmount","item","price","quantity","options","amount","Math","round","currency","receipt","Date","now","order","orders","create","data","razorpay_order_id","id","total_amount","console","message"],"mappings":"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","ignoreList":[],"debugId":null}}]
}