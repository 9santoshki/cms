{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/checkout/create/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport Razorpay from 'razorpay';\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Initialize Razorpay client inside the function to handle missing env vars gracefully\n    const razorpayKey = process.env.RAZORPAY_KEY_ID;\n    const razorpaySecret = process.env.RAZORPAY_KEY_SECRET;\n\n    if (!razorpayKey || !razorpaySecret) {\n      return NextResponse.json(\n        { \n          success: false, \n          error: 'Payment gateway not configured. Please contact the site administrator.' \n        },\n        { status: 500 }\n      );\n    }\n\n    const razorpay = new Razorpay({\n      key_id: razorpayKey,\n      key_secret: razorpaySecret,\n    });\n\n    const body = await request.json();\n    const { items, shipping_address } = body;\n\n    if (!items || !Array.isArray(items) || items.length === 0) {\n      return NextResponse.json(\n        { success: false, error: 'Cart items are required' },\n        { status: 400 }\n      );\n    }\n\n    if (!shipping_address) {\n      return NextResponse.json(\n        { success: false, error: 'Shipping address is required' },\n        { status: 400 }\n      );\n    }\n\n    // Calculate total amount\n    let totalAmount = 0;\n    for (const item of items) {\n      if (typeof item.price === 'number' && typeof item.quantity === 'number') {\n        totalAmount += item.price * item.quantity;\n      }\n    }\n\n    if (totalAmount <= 0) {\n      return NextResponse.json(\n        { success: false, error: 'Invalid cart total' },\n        { status: 400 }\n      );\n    }\n\n    // Create Razorpay order\n    const options = {\n      amount: Math.round(totalAmount * 100), // Amount in paise (lowest currency unit)\n      currency: 'INR',\n      receipt: `receipt_${Date.now()}`,\n    };\n\n    const order = await razorpay.orders.create(options);\n\n    // Here we would typically save the order to our database\n    // For now, we'll just return the order info to be used in the frontend\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        razorpay_order_id: order.id,\n        amount: order.amount,\n        currency: order.currency,\n        total_amount: totalAmount,\n      }\n    });\n  } catch (error: any) {\n    console.error('Error creating checkout session:', error);\n    return NextResponse.json(\n      { success: false, error: error.message || 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}"],"names":["NextRequest","NextResponse","Razorpay","POST","request","razorpayKey","process","env","RAZORPAY_KEY_ID","razorpaySecret","RAZORPAY_KEY_SECRET","json","success","error","status","razorpay","key_id","key_secret","body","items","shipping_address","Array","isArray","length","totalAmount","item","price","quantity","options","amount","Math","round","currency","receipt","Date","now","order","orders","create","data","razorpay_order_id","id","total_amount","console","message"],"mappings":"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","ignoreList":[],"debugId":null}}]
}