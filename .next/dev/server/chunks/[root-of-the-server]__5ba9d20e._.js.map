{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/db/connection.ts"],"sourcesContent":["import { Pool, PoolClient } from 'pg';\n\n// Create a connection pool\nconst pool = new Pool({\n  host: process.env.DB_HOST || 'localhost',\n  port: parseInt(process.env.DB_PORT || '5432'),\n  database: process.env.DB_NAME || 'cmsdb',\n  user: process.env.DB_USER || 'sk',\n  password: process.env.DB_PASSWORD || 'sk',\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 2000,\n});\n\npool.on('error', (err) => {\n  console.error('Unexpected error on idle client', err);\n  process.exit(-1);\n});\n\nexport const query = async (text: string, params?: any[]) => {\n  const start = Date.now();\n  try {\n    const res = await pool.query(text, params);\n    const duration = Date.now() - start;\n    console.log('Executed query', { text, duration, rows: res.rowCount });\n    return res;\n  } catch (error) {\n    console.error('Database query error:', error);\n    throw error;\n  }\n};\n\nexport const getClient = async (): Promise<PoolClient> => {\n  const client = await pool.connect();\n  return client;\n};\n\nexport default pool;\n"],"names":["Pool","PoolClient","pool","host","process","env","DB_HOST","port","parseInt","DB_PORT","database","DB_NAME","user","DB_USER","password","DB_PASSWORD","max","idleTimeoutMillis","connectionTimeoutMillis","on","err","console","error","exit","query","text","params","start","Date","now","res","duration","log","rows","rowCount","getClient","Promise","client","connect"],"mappings":";;;;;;;;AAAA,SAASA,IAAI,EAAEC,UAAU,QAAQ,IAAI;;;;;;AAErC,2BAAA;AACA,MAAMC,IAAI,GAAG,IAAIF,4GAAI,CAAC;IACpBG,IAAI,EAAEC,OAAO,CAACC,GAAG,CAACC,OAAO,IAAI,WAAW;IACxCC,IAAI,EAAEC,QAAQ,CAACJ,OAAO,CAACC,GAAG,CAACI,OAAO,IAAI,MAAM,CAAC;IAC7CC,QAAQ,EAAEN,OAAO,CAACC,GAAG,CAACM,OAAO,IAAI,OAAO;IACxCC,IAAI,EAAER,OAAO,CAACC,GAAG,CAACQ,OAAO,IAAI,IAAI;IACjCC,QAAQ,EAAEV,OAAO,CAACC,GAAG,CAACU,WAAW,IAAI,IAAI;IACzCC,GAAG,EAAE,EAAE;IACPC,iBAAiB,EAAE,KAAK;IACxBC,uBAAuB,EAAE;AAC3B,CAAC,CAAC;AAEFhB,IAAI,CAACiB,EAAE,CAAC,OAAO,GAAGC,GAAG,IAAK;IACxBC,OAAO,CAACC,KAAK,CAAC,iCAAiC,EAAEF,GAAG,CAAC;IACrDhB,OAAO,CAACmB,IAAI,CAAC,CAAC,CAAC,CAAC;AAClB,CAAC,CAAC;AAEK,MAAMC,KAAK,GAAG,MAAAA,CAAOC,IAAI,EAAE,AAAQC,MAAF,AAAgB,CAAP,EAAE,GAAG,EAAE,KAAK;IAC3D,MAAMC,KAAK,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IACxB,IAAI;QACF,MAAMC,GAAG,GAAG,MAAM5B,IAAI,CAACsB,KAAK,CAACC,IAAI,EAAEC,MAAM,CAAC;QAC1C,MAAMK,QAAQ,GAAGH,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGF,KAAK;QACnCN,OAAO,CAACW,GAAG,CAAC,gBAAgB,EAAE;YAAEP,IAAI;YAAEM,QAAQ;YAAEE,IAAI,EAAEH,GAAG,CAACI,QAAAA;QAAS,CAAC,CAAC;QACrE,OAAOJ,GAAG;IACZ,CAAC,CAAC,OAAOR,KAAK,EAAE;QACdD,OAAO,CAACC,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;QAC7C,MAAMA,KAAK;IACb;AACF,CAAC;AAEM,MAAMa,SAAS,GAAG,MAAAA,CAAA,CAAQ,EAAEC,OAAO,CAACnC,UAAU,CAAC,IAAI;IACxD,MAAMoC,MAAM,GAAG,MAAMnC,IAAI,CAACoC,OAAO,CAAC,CAAC;IACnC,OAAOD,MAAM;AACf,CAAC;uCAEcnC,IAAI","ignoreList":[],"debugId":null}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/lib/db/auth.ts"],"sourcesContent":["import { query } from './connection';\nimport { cookies, headers } from 'next/headers';\nimport jwt from 'jsonwebtoken';\nimport crypto from 'crypto';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key-change-in-production';\nconst SESSION_COOKIE_NAME = 'cms-session';\nconst SESSION_DURATION_DAYS = 30; // 30 days for persistent login\n\nexport interface UserProfile {\n  id: string;\n  email: string;\n  name: string;\n  avatar?: string;\n  role: 'customer' | 'moderator' | 'admin';\n  created_at?: string;\n  updated_at?: string;\n}\n\nexport interface SessionData {\n  userId: string;\n  email: string;\n  name: string;\n  avatar?: string;\n  role: string;\n  sessionId?: string; // Database session ID\n}\n\nexport interface DBSession {\n  id: string;\n  user_id: string;\n  session_token: string;\n  refresh_token?: string;\n  user_agent?: string;\n  ip_address?: string;\n  expires_at: string;\n  created_at: string;\n  updated_at: string;\n  last_activity: string;\n}\n\n// Create or update user from Google OAuth\nexport const upsertUserFromGoogle = async (googleUser: {\n  id: string;\n  email: string;\n  name: string;\n  picture?: string;\n}): Promise<UserProfile> => {\n  // Check if user exists\n  const existingUser = await query(\n    'SELECT * FROM users WHERE email = $1',\n    [googleUser.email]\n  );\n\n  let userId: string;\n\n  if (existingUser.rows.length > 0) {\n    // Update existing user\n    userId = existingUser.rows[0].id;\n    await query(\n      `UPDATE users\n       SET name = $1, avatar = $2, google_id = $3, updated_at = NOW()\n       WHERE id = $4`,\n      [googleUser.name, googleUser.picture, googleUser.id, userId]\n    );\n  } else {\n    // Create new user\n    const newUser = await query(\n      `INSERT INTO users (email, name, avatar, google_id, role)\n       VALUES ($1, $2, $3, $4, 'customer')\n       RETURNING id`,\n      [googleUser.email, googleUser.name, googleUser.picture, googleUser.id]\n    );\n    userId = newUser.rows[0].id;\n  }\n\n  // Get the complete user profile\n  const userProfile = await getUserProfile(userId);\n  if (!userProfile) {\n    throw new Error('Failed to create or fetch user profile');\n  }\n\n  return userProfile;\n};\n\n// Get user profile by ID\nexport const getUserProfile = async (userId: string): Promise<UserProfile | null> => {\n  const result = await query(\n    'SELECT id, email, name, avatar, role, created_at, updated_at FROM users WHERE id = $1',\n    [userId]\n  );\n\n  if (result.rows.length === 0) {\n    return null;\n  }\n\n  return result.rows[0];\n};\n\n// Get user profile by email\nexport const getUserByEmail = async (email: string): Promise<UserProfile | null> => {\n  const result = await query(\n    'SELECT id, email, name, avatar, role, created_at, updated_at FROM users WHERE email = $1',\n    [email]\n  );\n\n  if (result.rows.length === 0) {\n    return null;\n  }\n\n  return result.rows[0];\n};\n\n// Create session token\nexport const createSessionToken = (user: UserProfile): string => {\n  const sessionData: SessionData = {\n    userId: user.id,\n    email: user.email,\n    name: user.name,\n    avatar: user.avatar,\n    role: user.role,\n  };\n\n  return jwt.sign(sessionData, JWT_SECRET, { expiresIn: '7d' });\n};\n\n// Verify session token\nexport const verifySessionToken = (token: string): SessionData | null => {\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET) as SessionData;\n    return decoded;\n  } catch (error) {\n    console.error('Invalid token:', error);\n    return null;\n  }\n};\n\n// Set session cookie\nexport const setSessionCookie = async (token: string) => {\n  const cookieStore = await cookies();\n  cookieStore.set(SESSION_COOKIE_NAME, token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n    path: '/',\n  });\n};\n\n// Get session from cookie\nexport const getSessionFromCookie = async (): Promise<SessionData | null> => {\n  const cookieStore = await cookies();\n  const sessionCookie = cookieStore.get(SESSION_COOKIE_NAME);\n\n  if (!sessionCookie) {\n    return null;\n  }\n\n  return verifySessionToken(sessionCookie.value);\n};\n\n// Clear session cookie\nexport const clearSessionCookie = async () => {\n  const cookieStore = await cookies();\n  cookieStore.delete(SESSION_COOKIE_NAME);\n};\n\n// Update user role (admin only)\nexport const updateUserRole = async (\n  userId: string,\n  newRole: 'customer' | 'moderator' | 'admin'\n): Promise<void> => {\n  await query(\n    'UPDATE users SET role = $1, updated_at = NOW() WHERE id = $2',\n    [newRole, userId]\n  );\n};\n\n// Get all user profiles (admin only)\nexport const getAllUserProfiles = async (): Promise<UserProfile[]> => {\n  const result = await query(\n    'SELECT id, email, name, avatar, role, created_at, updated_at FROM users ORDER BY created_at DESC'\n  );\n\n  return result.rows;\n};\n\n// Update user profile\nexport const updateUserProfile = async (\n  userId: string,\n  updates: { name?: string; avatar?: string }\n): Promise<UserProfile | null> => {\n  const fields: string[] = [];\n  const values: any[] = [];\n  let paramCount = 1;\n\n  if (updates.name !== undefined) {\n    fields.push(`name = $${paramCount++}`);\n    values.push(updates.name);\n  }\n\n  if (updates.avatar !== undefined) {\n    fields.push(`avatar = $${paramCount++}`);\n    values.push(updates.avatar);\n  }\n\n  if (fields.length === 0) {\n    return getUserProfile(userId);\n  }\n\n  fields.push(`updated_at = NOW()`);\n  values.push(userId);\n\n  await query(\n    `UPDATE users SET ${fields.join(', ')} WHERE id = $${paramCount}`,\n    values\n  );\n\n  return getUserProfile(userId);\n};\n\n// ============================================================================\n// SESSION MANAGEMENT (Database-backed persistent sessions)\n// ============================================================================\n\n// Generate secure random token\nconst generateSecureToken = (): string => {\n  return crypto.randomBytes(32).toString('hex');\n};\n\n// Get request metadata (user agent, IP)\nconst getRequestMetadata = async () => {\n  try {\n    const headersList = await headers();\n    const userAgent = (await headersList).get('user-agent') || undefined;\n    const forwardedFor = (await headersList).get('x-forwarded-for');\n    const realIp = (await headersList).get('x-real-ip');\n    const ipAddress = forwardedFor?.split(',')[0] || realIp || undefined;\n\n    return { userAgent, ipAddress };\n  } catch (error) {\n    return { userAgent: undefined, ipAddress: undefined };\n  }\n};\n\n// Create a new session in the database\nexport const createSession = async (\n  user: UserProfile,\n  rememberMe: boolean = true\n): Promise<{ sessionToken: string; refreshToken: string; dbSession: DBSession }> => {\n  const sessionToken = generateSecureToken();\n  const refreshToken = generateSecureToken();\n  const { userAgent, ipAddress } = await getRequestMetadata();\n\n  // Calculate expiration based on remember me option\n  const durationDays = rememberMe ? SESSION_DURATION_DAYS : 1; // 30 days or 1 day\n  const expiresAt = new Date(Date.now() + durationDays * 24 * 60 * 60 * 1000);\n\n  const result = await query(\n    `INSERT INTO sessions (user_id, session_token, refresh_token, user_agent, ip_address, expires_at)\n     VALUES ($1, $2, $3, $4, $5, $6)\n     RETURNING *`,\n    [user.id, sessionToken, refreshToken, userAgent, ipAddress, expiresAt]\n  );\n\n  return {\n    sessionToken,\n    refreshToken,\n    dbSession: result.rows[0]\n  };\n};\n\n// Get session from database by token\nexport const getSessionFromDB = async (sessionToken: string): Promise<DBSession | null> => {\n  const result = await query(\n    `SELECT * FROM sessions\n     WHERE session_token = $1\n     AND expires_at > NOW()`,\n    [sessionToken]\n  );\n\n  if (result.rows.length === 0) {\n    return null;\n  }\n\n  return result.rows[0];\n};\n\n// Update session activity timestamp\nexport const updateSessionActivity = async (sessionId: string): Promise<void> => {\n  await query(\n    'UPDATE sessions SET last_activity = NOW() WHERE id = $1',\n    [sessionId]\n  );\n};\n\n// Delete a specific session\nexport const deleteSession = async (sessionToken: string): Promise<void> => {\n  await query(\n    'DELETE FROM sessions WHERE session_token = $1',\n    [sessionToken]\n  );\n};\n\n// Delete all sessions for a user\nexport const deleteUserSessions = async (userId: string): Promise<void> => {\n  await query(\n    'DELETE FROM sessions WHERE user_id = $1',\n    [userId]\n  );\n};\n\n// Delete a specific session by ID\nexport const deleteSessionById = async (sessionId: string): Promise<void> => {\n  await query(\n    'DELETE FROM sessions WHERE id = $1',\n    [sessionId]\n  );\n};\n\n// Clean up expired sessions\nexport const cleanupExpiredSessions = async (): Promise<number> => {\n  const result = await query('SELECT cleanup_expired_sessions()');\n  return result.rows[0].cleanup_expired_sessions;\n};\n\n// Get all active sessions for a user\nexport const getUserSessions = async (userId: string): Promise<DBSession[]> => {\n  const result = await query(\n    `SELECT * FROM sessions\n     WHERE user_id = $1\n     AND expires_at > NOW()\n     ORDER BY last_activity DESC`,\n    [userId]\n  );\n\n  return result.rows;\n};\n\n// Enhanced session token creation with database session ID\nexport const createSessionTokenWithDB = (user: UserProfile, sessionId: string): string => {\n  const sessionData: SessionData = {\n    userId: user.id,\n    email: user.email,\n    name: user.name,\n    avatar: user.avatar,\n    role: user.role,\n    sessionId: sessionId, // Include DB session ID in JWT\n  };\n\n  return jwt.sign(sessionData, JWT_SECRET, { expiresIn: `${SESSION_DURATION_DAYS}d` });\n};\n\n// Enhanced session validation (checks both JWT and database)\nexport const validateSession = async (token: string): Promise<SessionData | null> => {\n  // First verify JWT\n  const jwtData = verifySessionToken(token);\n  if (!jwtData) {\n    return null;\n  }\n\n  // If JWT has session ID, verify against database\n  if (jwtData.sessionId) {\n    const dbSession = await query(\n      'SELECT * FROM sessions WHERE id = $1 AND expires_at > NOW()',\n      [jwtData.sessionId]\n    );\n\n    if (dbSession.rows.length === 0) {\n      // Session was invalidated in database\n      return null;\n    }\n\n    // Update last activity\n    await updateSessionActivity(jwtData.sessionId);\n  }\n\n  return jwtData;\n};\n\n// Enhanced get session from cookie with database validation\nexport const getSessionFromCookieWithDB = async (): Promise<SessionData | null> => {\n  const cookieStore = await cookies();\n\n  // Debug: Log all available cookies\n  const allCookies = cookieStore.getAll();\n  console.log('üîç Available cookies:', allCookies.map(c => c.name));\n\n  const sessionCookie = cookieStore.get(SESSION_COOKIE_NAME);\n\n  if (!sessionCookie) {\n    console.log('‚ùå getSessionFromCookieWithDB: No session cookie found with name:', SESSION_COOKIE_NAME);\n    return null;\n  }\n\n  console.log('‚úÖ getSessionFromCookieWithDB: Found session cookie, validating...');\n  // Validate against database as well\n  return validateSession(sessionCookie.value);\n};\n\n// Enhanced set session cookie with longer duration\nexport const setSessionCookieWithDB = async (token: string, rememberMe: boolean = true) => {\n  const cookieStore = await cookies();\n  const maxAge = rememberMe\n    ? 60 * 60 * 24 * SESSION_DURATION_DAYS  // 30 days\n    : 60 * 60 * 24; // 1 day\n\n  cookieStore.set(SESSION_COOKIE_NAME, token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'lax',\n    maxAge: maxAge,\n    path: '/',\n  });\n\n  console.log('setSessionCookieWithDB: Cookie set successfully, maxAge:', maxAge);\n};\n\n// Enhanced logout that clears both cookie and database session\nexport const logoutSession = async (): Promise<void> => {\n  const session = await getSessionFromCookieWithDB();\n\n  // Clear cookie\n  await clearSessionCookie();\n\n  // Delete from database if session ID exists\n  if (session?.sessionId) {\n    await deleteSessionById(session.sessionId);\n  }\n};\n"],"names":["query","cookies","headers","jwt","crypto","JWT_SECRET","process","env","SESSION_COOKIE_NAME","SESSION_DURATION_DAYS","UserProfile","id","email","name","avatar","role","created_at","updated_at","SessionData","userId","sessionId","DBSession","user_id","session_token","refresh_token","user_agent","ip_address","expires_at","last_activity","upsertUserFromGoogle","googleUser","picture","Promise","existingUser","rows","length","newUser","userProfile","getUserProfile","Error","result","getUserByEmail","createSessionToken","user","sessionData","sign","expiresIn","verifySessionToken","token","decoded","verify","error","console","setSessionCookie","cookieStore","set","httpOnly","secure","NODE_ENV","sameSite","maxAge","path","getSessionFromCookie","sessionCookie","get","value","clearSessionCookie","delete","updateUserRole","newRole","getAllUserProfiles","updateUserProfile","updates","fields","values","paramCount","undefined","push","join","generateSecureToken","randomBytes","toString","getRequestMetadata","headersList","userAgent","forwardedFor","realIp","ipAddress","split","createSession","rememberMe","sessionToken","refreshToken","dbSession","durationDays","expiresAt","Date","now","getSessionFromDB","updateSessionActivity","deleteSession","deleteUserSessions","deleteSessionById","cleanupExpiredSessions","cleanup_expired_sessions","getUserSessions","createSessionTokenWithDB","validateSession","jwtData","getSessionFromCookieWithDB","allCookies","getAll","log","map","c","setSessionCookieWithDB","logoutSession","session"],"mappings":"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","ignoreList":[],"debugId":null}},
    {"offset": {"line": 501, "column": 0}, "map": {"version":3,"sources":["file:///Users/sk/personal/proj/cms/src/app/api/auth/google/callback/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport crypto from 'crypto';\nimport {\n  upsertUserFromGoogle,\n  createSession,\n  createSessionTokenWithDB\n} from '@/lib/db/auth';\nimport { query } from '@/lib/db/connection';\n\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams;\n  const code = searchParams.get('code');\n  const error = searchParams.get('error');\n\n  if (error) {\n    console.error('OAuth error:', error);\n    return NextResponse.redirect(new URL('/?error=oauth_failed', request.url));\n  }\n\n  if (!code) {\n    return NextResponse.redirect(new URL('/?error=no_code', request.url));\n  }\n\n  try {\n    // Exchange code for tokens\n    const tokenResponse = await fetch('https://oauth2.googleapis.com/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: new URLSearchParams({\n        code,\n        client_id: process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID!,\n        client_secret: process.env.GOOGLE_CLIENT_SECRET!,\n        redirect_uri: `${request.nextUrl.origin}/auth/callback`,\n        grant_type: 'authorization_code',\n      }),\n    });\n\n    if (!tokenResponse.ok) {\n      throw new Error('Failed to exchange code for tokens');\n    }\n\n    const tokens = await tokenResponse.json();\n\n    // Get user info from Google\n    const userInfoResponse = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {\n      headers: {\n        Authorization: `Bearer ${tokens.access_token}`,\n      },\n    });\n\n    if (!userInfoResponse.ok) {\n      throw new Error('Failed to get user info from Google');\n    }\n\n    const googleUser = await userInfoResponse.json();\n\n    console.log('üì∏ Google User Data:', {\n      id: googleUser.id,\n      email: googleUser.email,\n      name: googleUser.name,\n      picture: googleUser.picture,\n      pictureLength: googleUser.picture?.length\n    });\n\n    // Create or update user in database\n    const user = await upsertUserFromGoogle({\n      id: googleUser.id,\n      email: googleUser.email,\n      name: googleUser.name,\n      picture: googleUser.picture,\n    });\n\n    console.log('‚úÖ User authenticated:', user.email);\n    console.log('üë§ User from database:', {\n      id: user.id,\n      email: user.email,\n      name: user.name,\n      avatar: user.avatar,\n      avatarLength: user.avatar?.length,\n      role: user.role\n    });\n\n    // Create database-backed session (30 days by default for persistent login)\n    const { dbSession } = await createSession(user, true);\n    console.log('Session created in database:', dbSession.id);\n\n    // Create JWT token with session ID\n    const sessionToken = createSessionTokenWithDB(user, dbSession.id);\n\n    // Decode and log JWT payload to verify avatar is included\n    const jwtPayload = JSON.parse(Buffer.from(sessionToken.split('.')[1], 'base64').toString());\n    console.log('üîê JWT Token Payload:', {\n      userId: jwtPayload.userId,\n      email: jwtPayload.email,\n      name: jwtPayload.name,\n      avatar: jwtPayload.avatar,\n      avatarLength: jwtPayload.avatar?.length,\n      role: jwtPayload.role,\n      sessionId: jwtPayload.sessionId\n    });\n\n    // Generate a temporary token for secure transfer\n    const tempToken = crypto.randomBytes(32).toString('hex');\n    const expiresAt = new Date(Date.now() + 5 * 60 * 1000); // 5 minutes\n\n    // Store session token temporarily\n    await query(\n      'INSERT INTO temp_auth_tokens (temp_token, session_token, expires_at) VALUES ($1, $2, $3)',\n      [tempToken, sessionToken, expiresAt]\n    );\n\n    console.log('‚úÖ Persistent login successful for user:', user.email);\n    console.log('‚úÖ Temporary token created, redirecting to set-session route');\n\n    // Redirect to server-side set-session route (no client-side JavaScript needed!)\n    return NextResponse.redirect(new URL(`/auth/set-session?token=${tempToken}`, request.url));\n  } catch (error) {\n    console.error('Error in OAuth callback:', error);\n    return NextResponse.redirect(new URL('/?error=auth_failed', request.url));\n  }\n}\n"],"names":["NextRequest","NextResponse","crypto","upsertUserFromGoogle","createSession","createSessionTokenWithDB","query","GET","request","searchParams","nextUrl","code","get","error","console","redirect","URL","url","tokenResponse","fetch","method","headers","body","URLSearchParams","client_id","process","env","NEXT_PUBLIC_GOOGLE_CLIENT_ID","client_secret","GOOGLE_CLIENT_SECRET","redirect_uri","origin","grant_type","ok","Error","tokens","json","userInfoResponse","Authorization","access_token","googleUser","log","id","email","name","picture","pictureLength","length","user","avatar","avatarLength","role","dbSession","sessionToken","jwtPayload","JSON","parse","Buffer","from","split","toString","userId","sessionId","tempToken","randomBytes","expiresAt","Date","now"],"mappings":"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","ignoreList":[],"debugId":null}}]
}