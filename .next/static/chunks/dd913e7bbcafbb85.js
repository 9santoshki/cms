(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,97304,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(9165);let o="SET_PRODUCTS",n="SET_LOADING",s="SET_ERROR",i="SET_APPOINTMENTS",l="SET_ORDERS",c="ADD_ORDER",u={products:[],loading:!1,error:null,appointments:[],orders:[]},d=(e,t)=>{switch(t.type){case o:return{...e,products:Array.isArray(t.payload)?t.payload:[]};case n:return{...e,loading:t.payload};case s:return{...e,error:t.payload};case i:return{...e,appointments:Array.isArray(t.payload)?t.payload:[]};case l:return{...e,orders:Array.isArray(t.payload)?t.payload:[]};case c:return{...e,orders:[t.payload,...e.orders]};default:return e}},p=(0,r.createContext)(void 0);e.s(["ProductContext",0,p,"ProductProvider",0,({children:e})=>{let[y,h]=(0,r.useReducer)(d,u),g=e=>{h({type:o,payload:e})},m=e=>{h({type:n,payload:e})},f=e=>{h({type:s,payload:e})},v=async()=>{m(!0),f(null);try{let e=await a.apiClient.getProducts();if(e.success&&e.data){let t=(Array.isArray(e.data)?e.data:e.data?.products||[]).map(e=>({...e,price:"number"==typeof e.price?e.price:parseFloat(e.price),image_url:e.image_url&&(e.image_url.startsWith("http")||e.image_url.startsWith("/"))?e.image_url:void 0,imageClass:(e=>{if(!e)return"modern";let t=e.toLowerCase();if(t.includes("modern")||t.includes("coffee")||t.includes("sofa"))return"modern";if(t.includes("classic")||t.includes("armchair"))return"classic";if(t.includes("vintage")||t.includes("lamp"))return"coastal";if(t.includes("dining")||t.includes("dresser"))return"office";if(t.includes("wall")||t.includes("art"))return"hotel";else if(t.includes("rug"))return"restaurant";else return"modern"})(e.image_url)||e.imageClass||"modern"}));g(t)}else console.warn("No products found:",e.error),g([])}catch(e){console.error("Error fetching products:",e),f(e.message||"Failed to load products. Please try again later.")}finally{m(!1)}},S=(0,r.useCallback)(async()=>{h({type:n,payload:!0}),h({type:s,payload:null});try{let e=await a.apiClient.getOrders();e.success&&e.data?h({type:l,payload:Array.isArray(e.data)?e.data:[]}):h({type:l,payload:[]})}catch(e){console.error("Error fetching orders:",e),h({type:s,payload:e.message||"Failed to load orders."})}finally{h({type:n,payload:!1})}},[]),C=(0,r.useCallback)(async()=>{h({type:n,payload:!0}),h({type:s,payload:null});try{let e=await a.apiClient.getAppointments();e.success&&e.data?h({type:i,payload:Array.isArray(e.data)?e.data:[]}):h({type:i,payload:[]})}catch(e){console.error("Error fetching appointments:",e),h({type:s,payload:e.message||"Failed to load appointments."})}finally{h({type:n,payload:!1})}},[]),w=(0,r.useCallback)(async e=>{h({type:n,payload:!0}),h({type:s,payload:null});try{let t=await a.apiClient.createOrder(e);if(t.success&&t.data)return h({type:c,payload:t.data}),t.data;throw Error(t.error||"Failed to create order")}catch(e){throw console.error("Error creating order:",e),h({type:s,payload:e.message||"Failed to create order."}),e}finally{h({type:n,payload:!1})}},[]),E=(0,r.useCallback)(async e=>{h({type:n,payload:!0}),h({type:s,payload:null});try{let t=await a.apiClient.createAppointment(e);if(t.success&&t.data)return h({type:i,payload:[t.data,...y.appointments]}),t.data;throw Error(t.error||"Failed to create appointment")}catch(e){throw console.error("Error creating appointment:",e),h({type:s,payload:e.message||"Failed to create appointment."}),e}finally{h({type:n,payload:!1})}},[y.appointments]),P=(0,r.useCallback)(async(e,t)=>{h({type:n,payload:!0}),h({type:s,payload:null});try{let r=await a.apiClient.updateProduct(e,t);if(r.success&&r.data)return h({type:o,payload:y.products.map(t=>t.id===e?r.data:t)}),r.data;throw Error(r.error||"Failed to update product")}catch(e){throw console.error("Error updating product:",e),h({type:s,payload:e.message||"Failed to update product."}),e}finally{h({type:n,payload:!1})}},[y.products]),b=(0,r.useCallback)(async e=>{h({type:n,payload:!0}),h({type:s,payload:null});try{let t=await a.apiClient.deleteProduct(e);if(t.success)return h({type:o,payload:y.products.filter(t=>t.id!==e)}),!0;throw Error(t.error||"Failed to delete product")}catch(e){throw console.error("Error deleting product:",e),h({type:s,payload:e.message||"Failed to delete product."}),e}finally{h({type:n,payload:!1})}},[y.products]),A=(0,r.useCallback)(async e=>{h({type:n,payload:!0}),h({type:s,payload:null});try{let t=await a.apiClient.createProduct(e);if(t.success&&t.data)return h({type:o,payload:[t.data,...y.products]}),t.data;throw Error(t.error||"Failed to create product")}catch(e){throw console.error("Error creating product:",e),h({type:s,payload:e.message||"Failed to create product."}),e}finally{h({type:n,payload:!1})}},[y.products]);return(0,t.jsx)(p.Provider,{value:{products:y.products,loading:y.loading,error:y.error,appointments:y.appointments,orders:y.orders,setProducts:g,setLoading:m,setError:f,setAppointments:e=>{h({type:i,payload:e})},setOrders:e=>{h({type:l,payload:e})},fetchProducts:v,fetchOrders:S,fetchAppointments:C,createOrder:w,createAppointment:E,updateProduct:P,deleteProduct:b,createProduct:A},children:e})},"useProduct",0,()=>{let e=(0,r.useContext)(p);if(void 0===e)throw Error("useProduct must be used within a ProductProvider");return e}])},25194,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(80230);let o=(0,r.createContext)(void 0);e.s(["CartContext",0,o,"CartProvider",0,({children:e})=>{let{items:r,addItem:n,updateItem:s,removeItem:i,clearCart:l,getTotalItems:c,getTotalPrice:u}=(0,a.useCartStore)();return(0,t.jsx)(o.Provider,{value:{items:r,loading:!1,error:null,cartCount:c(),cartTotal:u(),addItem:n,updateItem:s,removeItem:i,clearCart:l},children:e})},"useCart",0,()=>{let e=(0,r.useContext)(o);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}])},32341,e=>{"use strict";var t=e.i(43476),r=e.i(71645);e.i(47167);let a=async()=>{let e=new URL("https://accounts.google.com/o/oauth2/v2/auth");e.searchParams.set("client_id","774770475031-c7nqt1nrj05ntj4h9h1a2co56o5peb2o.apps.googleusercontent.com"),e.searchParams.set("redirect_uri","http://localhost:3000/auth/callback"),e.searchParams.set("response_type","code"),e.searchParams.set("scope","openid email profile"),e.searchParams.set("access_type","offline"),e.searchParams.set("prompt","consent"),window.location.href=e.toString()},o=async()=>{try{if(!(await fetch("/api/auth/logout",{method:"POST",credentials:"include"})).ok)throw Error("Logout failed");return{success:!0}}catch(e){throw console.error("Error signing out:",e),e}},n=async()=>{try{let e=await fetch("/api/auth/session",{credentials:"include"});if(!e.ok)return{user:null};return{user:(await e.json()).user||null}}catch(e){return console.error("Error getting session:",e),{user:null}}},s=async()=>{let{user:e}=await n();return e},i={user:null,token:null,loading:!1,error:null};function l(e,t){switch(t.type){case"SET_USER":return{...e,user:t.payload};case"SET_TOKEN":return{...e,token:t.payload};case"SET_LOADING":return{...e,loading:t.payload};case"SET_ERROR":return{...e,error:t.payload};case"LOGOUT":return{...e,user:null,token:null};default:return e}}let c=(0,r.createContext)(void 0);e.s(["AuthContext",0,c,"AuthProvider",0,({children:u})=>{let[d,p]=(0,r.useReducer)(l,i),y=(0,r.useCallback)(e=>p({type:"SET_USER",payload:e}),[]),h=(0,r.useCallback)(e=>p({type:"SET_TOKEN",payload:e}),[]),g=(0,r.useCallback)(e=>p({type:"SET_LOADING",payload:e}),[]),m=(0,r.useCallback)(e=>p({type:"SET_ERROR",payload:e}),[]),f=(0,r.useCallback)(async()=>{p({type:"LOGOUT"});try{await o()}catch(e){}},[]),v=(0,r.useCallback)(async()=>{g(!0),m(null);try{await a()}catch(e){throw m(e?.message||"Google sign-in failed"),e}finally{g(!1)}},[g,m]);return(0,r.useEffect)(()=>{var t;let r,a,o;console.log("AuthContext: Setting up auth state change listener"),(async()=>{console.log("AuthContext: Checking current session on mount...");try{let t=await s();if(console.log("AuthContext: getCurrentUser result:",t),t){console.log("AuthContext: Current user found on mount:",t),y(t);try{let{useCartStore:t}=await e.A(69136);console.log("AuthContext: Loading cart from server..."),await t.getState().loadServerCart(),console.log("AuthContext: ✅ Cart loaded from server successfully")}catch(e){console.error("AuthContext: ❌ Error loading cart:",e)}}else console.log("AuthContext: No current user found on mount")}catch(e){console.error("AuthContext: Error checking current session:",e)}})(),console.log("AuthContext: Subscribing to auth state changes...");let i=(t=async(t,r)=>{if(console.log("AuthContext: Auth state changed event:",t,"Session:",r),"SIGNED_IN"===t){let t=r.user;if(!t)return;console.log("AuthContext: Processing SIGNED_IN event for user:",t),y(t),h(null);try{let{useCartStore:t}=await e.A(69136);console.log("AuthContext: Loading cart after sign in..."),await t.getState().loadServerCart(),console.log("AuthContext: ✅ Cart loaded from server after sign in")}catch(e){console.error("AuthContext: ❌ Error loading cart after sign in:",e)}}if("SIGNED_OUT"===t){console.log("AuthContext: Processing SIGNED_OUT event"),p({type:"LOGOUT"});try{let{useCartStore:t}=await e.A(69136);t.setState({items:[]}),console.log("AuthContext: ✅ Local cart state cleared after sign out (database cart preserved)")}catch(e){console.error("AuthContext: ❌ Error clearing cart after sign out:",e)}}if("USER_UPDATED"===t){console.log("AuthContext: Processing USER_UPDATED event");let e=r.user;if(!e)return;y(e)}},r=null,(a=async()=>{let{user:e}=await n();e&&!r?(r=e,t("SIGNED_IN",{user:e})):!e&&r?(r=null,t("SIGNED_OUT",{user:null})):e&&r&&e.id!==r.id&&(r=e,t("USER_UPDATED",{user:e}))})(),o=setInterval(a,2e3),{unsubscribe:()=>{clearInterval(o)}}),l=async()=>{console.log("AuthContext: Window focused, checking for cart updates...");try{if(await s()){let{useCartStore:t}=await e.A(69136);await t.getState().loadServerCart(),console.log("AuthContext: ✅ Cart reloaded on window focus")}}catch(e){console.error("AuthContext: ❌ Error reloading cart on focus:",e)}};return window.addEventListener("focus",l),()=>{console.log("AuthContext: Cleaning up auth subscription"),window.removeEventListener("focus",l),i.unsubscribe()}},[y,h]),(0,t.jsx)(c.Provider,{value:{...d,setUser:y,setToken:h,setLoading:g,setError:m,signInWithGoogle:v,logout:f},children:u})},"useAuth",0,()=>{let e=(0,r.useContext)(c);if(!e)throw Error("useAuth must be used within AuthProvider");return e}],32341)},80230,e=>{"use strict";let t,r,a,o,n;var s,i=e.i(71645);let l=e=>{let t,r=new Set,a=(e,a)=>{let o="function"==typeof e?e(t):e;if(!Object.is(o,t)){let e=t;t=(null!=a?a:"object"!=typeof o||null===o)?o:Object.assign({},t,o),r.forEach(r=>r(t,e))}},o=()=>t,n={setState:a,getState:o,getInitialState:()=>s,subscribe:e=>(r.add(e),()=>r.delete(e))},s=t=e(a,o,n);return n},c=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>c(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>c(t)(e)}}};async function u(){try{let e=await fetch("/api/auth/session"),t=await e.json();return!0===t.authenticated}catch(e){return!1}}async function d(e,t){try{if(!await u())return;t<=0?await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:0})}):await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,quantity:t})})}catch(e){console.error("Failed to sync cart with server:",e)}}let p=(o=(s=(t=(e,t)=>({items:[],isLoading:!1,addItem:async t=>{e(e=>{let r=e.items.findIndex(e=>e.product_id===t.product_id);if(!(r>=0))return{items:[...e.items,t]};{let a=[...e.items];return a[r]={...a[r],quantity:a[r].quantity+t.quantity},{items:a}}});try{if(await u()){let e=await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:t.product_id,quantity:t.quantity})}),r=await e.json();e.ok||console.error("Failed to save cart item to server:",r)}}catch(e){console.error("Failed to sync cart with server:",e)}},updateItem:async(t,r)=>{e(e=>r<=0?{items:e.items.filter(e=>e.product_id!==t)}:{items:e.items.map(e=>e.product_id===t?{...e,quantity:r}:e)}),await d(t,r)},removeItem:async t=>{e(e=>({items:e.items.filter(e=>e.product_id!==t)})),await d(t,0)},clearCart:async()=>{e({items:[]});try{await u()&&await fetch("/api/cart",{method:"DELETE"})}catch(e){console.error("Failed to clear server cart:",e)}},loadServerCart:async()=>{try{e({isLoading:!0});let r=await fetch("/api/cart"),a=await r.json();if(a.success&&a.data){let r=a.data,o=t().items,n=new Map(r.map(e=>[e.product_id,e])),s=[];for(let e of(r.forEach(e=>{let t=o.find(t=>t.product_id===e.product_id);t&&t.quantity>e.quantity?(s.push({...e,quantity:t.quantity}),e.product_id&&t.quantity&&d(e.product_id,t.quantity)):s.push(e)}),o))n.has(e.product_id)||(s.push(e),fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e.product_id,quantity:e.quantity})}).catch(e=>console.error("Failed to sync local item:",e)));e({items:s,isLoading:!1})}else e({isLoading:!1})}catch(t){console.error("Failed to load server cart:",t),e({isLoading:!1})}},syncWithServer:async()=>{try{if(!await u())return;for(let e of t().items)await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e.product_id,quantity:e.quantity})})}catch(e){console.error("Failed to sync cart with server:",e)}},getTotalItems:()=>t().items.reduce((e,t)=>e+t.quantity,0),getTotalPrice:()=>t().items.reduce((e,t)=>e+t.price*t.quantity,0)}),r=(e,r,a)=>{let o=a.subscribe;return a.subscribe=(e,t,r)=>{let n=e;if(t){let o=(null==r?void 0:r.equalityFn)||Object.is,s=e(a.getState());n=r=>{let a=e(r);if(!o(s,a)){let e=s;t(s=a,e)}},(null==r?void 0:r.fireImmediately)&&t(s,s)}return o(n)},t(e,r,a)},a={name:"cart-storage",partialize:e=>({items:e.items})},(e,t,o)=>{let n,s={storage:function(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;let a=e=>null===e?null:JSON.parse(e,void 0),o=null!=(t=r.getItem(e))?t:null;return o instanceof Promise?o.then(a):a(o)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...a},i=!1,l=new Set,u=new Set,d=s.storage;if(!d)return r((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),e(...t)},t,o);let p=()=>{let e=s.partialize({...t()});return d.setItem(s.name,{state:e,version:s.version})},y=o.setState;o.setState=(e,t)=>(y(e,t),p());let h=r((...t)=>(e(...t),p()),t,o);o.getInitialState=()=>h;let g=()=>{var r,a;if(!d)return;i=!1,l.forEach(e=>{var r;return e(null!=(r=t())?r:h)});let o=(null==(a=s.onRehydrateStorage)?void 0:a.call(s,null!=(r=t())?r:h))||void 0;return c(d.getItem.bind(d))(s.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===s.version)return[!1,e.state];else{if(s.migrate){let t=s.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(r=>{var a;let[o,i]=r;if(e(n=s.merge(i,null!=(a=t())?a:h),!0),o)return p()}).then(()=>{null==o||o(n,void 0),n=t(),i=!0,u.forEach(e=>e(n))}).catch(e=>{null==o||o(void 0,e)})};return o.persist={setOptions:e=>{s={...s,...e},e.storage&&(d=e.storage)},clearStorage:()=>{null==d||d.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>g(),hasHydrated:()=>i,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(u.add(e),()=>{u.delete(e)})},s.skipHydration||g(),n||h}))?l(s):l,Object.assign(n=e=>(function(e,t=e=>e){let r=i.default.useSyncExternalStore(e.subscribe,i.default.useCallback(()=>t(e.getState()),[e,t]),i.default.useCallback(()=>t(e.getInitialState()),[e,t]));return i.default.useDebugValue(r),r})(o,e),o),n);e.s(["useCartStore",0,p],80230)},9165,e=>{"use strict";let t=new class{baseUrl;token;constructor(){this.baseUrl="",this.token=localStorage.getItem("token")}setToken(e){this.token=e,e?localStorage.setItem("token",e):localStorage.removeItem("token")}async request(e,t={}){let r=`${this.baseUrl}/api${e}`,a={"Content-Type":"application/json",...this.token&&{Authorization:`Bearer ${this.token}`},...t.headers},o={...t,headers:a,credentials:"include"};try{let e=await fetch(r,o);return await e.json()}catch(e){return console.error(`API request error to ${r}:`,e),{success:!1,error:"Network error or server unavailable"}}}async getProducts(){return this.request("/products")}async getProduct(e){return this.request(`/products/${e}`)}async getProductBySlug(e){return this.request(`/products/${e}`)}async createProduct(e){return this.request("/products",{method:"POST",body:JSON.stringify(e)})}async updateProduct(e,t){return this.request(`/products/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteProduct(e){return this.request(`/products/${e}`,{method:"DELETE"})}async searchProducts(e){let t=new URLSearchParams;e.q&&t.append("q",e.q),e.search&&t.append("search",e.search),e.category&&t.append("category",e.category),void 0!==e.minPrice&&t.append("minPrice",e.minPrice.toString()),void 0!==e.maxPrice&&t.append("maxPrice",e.maxPrice.toString()),e.page&&t.append("page",e.page.toString()),e.limit&&t.append("limit",e.limit.toString());let r=t.toString(),a=r?`/search/products?${r}`:"/search/products";return this.request(a)}async getCartItems(){return this.request("/cart")}async addToCart(e,t=1){let r={"Content-Type":"application/json"};return this.token&&(r.Authorization=`Bearer ${this.token}`),this.request("/cart",{method:"POST",headers:r,body:JSON.stringify({product_id:e,quantity:t})})}async updateCartItem(e,t){return this.request("/cart",{method:"PUT",body:JSON.stringify({product_id:e,quantity:t})})}async removeFromCart(e){return this.request("/cart",{method:"PUT",body:JSON.stringify({product_id:e,quantity:0})})}async clearCart(){return this.request("/cart",{method:"DELETE"})}async getOrders(){return this.request("/orders")}async createOrder(e){return this.request("/orders",{method:"POST",body:JSON.stringify(e)})}async createCheckoutSession(e){return this.request("/checkout/create",{method:"POST",body:JSON.stringify(e)})}async verifyPayment(e){return this.request("/checkout/verify",{method:"POST",body:JSON.stringify(e)})}async getAppointments(e){let t=new URLSearchParams;e?.status&&t.append("status",e.status),e?.date&&t.append("date",e.date),e?.page&&t.append("page",e.page.toString()),e?.limit&&t.append("limit",e.limit.toString());let r=t.toString(),a=r?`/appointments?${r}`:"/appointments";return this.request(a)}async createAppointment(e){return this.request("/appointments",{method:"POST",body:JSON.stringify(e)})}async getAppointment(e){return this.request(`/appointments/${e}`)}async updateAppointment(e,t){return this.request(`/appointments/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteAppointment(e){return this.request(`/appointments/${e}`,{method:"DELETE"})}};e.s(["apiClient",0,t])},86690,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let a="SET_LOADING",o="SET_ERROR",n="CLEAR_ERROR",s={loading:{products:!1,cart:!1,orders:!1,appointments:!1,auth:!1,user:!1},error:{products:null,cart:null,orders:null,appointments:null,auth:null,user:null}},i=(e,t)=>{switch(t.type){case a:return{...e,loading:{...e.loading,[t.payload.type]:t.payload.value}};case o:return{...e,error:{...e.error,[t.payload.type]:t.payload.value}};case n:return{...e,error:{...e.error,[t.payload.type]:null}};default:return e}},l=(0,r.createContext)(void 0);e.s(["UIContext",0,l,"UIProvider",0,({children:e})=>{let[c,u]=(0,r.useReducer)(i,s);return(0,t.jsx)(l.Provider,{value:{loading:c.loading,error:c.error,setLoading:(e,t)=>{u({type:a,payload:{type:e,value:t}})},setError:(e,t)=>{u({type:o,payload:{type:e,value:t}})},clearError:e=>{u({type:n,payload:{type:e}})}},children:e})},"useUI",0,()=>{let e=(0,r.useContext)(l);if(void 0===e)throw Error("useUI must be used within a UIProvider");return e}])},48406,e=>{"use strict";var t=e.i(43476),r=e.i(32341),a=e.i(25194),o=e.i(97304),n=e.i(86690);e.s(["AppProvider",0,({children:e})=>(0,t.jsx)(n.UIProvider,{children:(0,t.jsx)(r.AuthProvider,{children:(0,t.jsx)(o.ProductProvider,{children:(0,t.jsx)(a.CartProvider,{children:e})})})})])},69136,e=>{e.v(e=>Promise.resolve().then(()=>e(80230)))}]);