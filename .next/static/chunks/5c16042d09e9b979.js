(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,45828,e=>{"use strict";var r=e.i(11795);let t=async()=>{let e=(0,r.createClient)(),t=`${window.location.origin}/auth/callback`,{data:a,error:o}=await e.auth.signInWithOAuth({provider:"google",options:{redirectTo:t,queryParams:{access_type:"offline",prompt:"consent"}}});if(o)throw console.error("Error signing in with Google:",o.message),o;return a},a=async()=>{let e=(0,r.createClient)(),{error:t}=await e.auth.signOut();if(t)throw console.error("Error signing out:",t.message),t;return{success:!0}},o=async()=>{let e=(0,r.createClient)(),{data:{session:t},error:a}=await e.auth.getSession();return a?(console.error("Error getting session:",a.message),null):t},s=async()=>{let e=(0,r.createClient)(),{data:{user:t}}=await e.auth.getUser();return t},i=async()=>{let e=(0,r.createClient)(),{data:{user:t},error:a}=await e.auth.getUser();if(a||!t)return console.error("Error getting user:",a),null;let{data:o,error:s}=await e.from("profiles").select("id, role").eq("id",t.id).single();if(s){console.warn("Profile not found, creating new profile for user:",t.id);let{error:r}=await e.from("profiles").insert([{id:t.id,role:"customer"}]);if(r)return console.error("Error creating user profile:",r),null;let{data:a,error:o}=await e.from("profiles").select("id, role").eq("id",t.id).single();return o?(console.error("Error fetching newly created user profile:",o),null):a}return o},l=async(e,t)=>{let a=(0,r.createClient)(),{error:o}=await a.from("profiles").update({role:t}).eq("id",e);if(o)throw console.error("Error updating user role:",o),o},n=async()=>{let e=(0,r.createClient)(),{data:t,error:a}=await e.from("profiles").select("id, role, created_at, updated_at").order("created_at",{ascending:!1});if(a)throw console.error("Error fetching user profiles:",a),a;return t};e.s(["getAllUserProfiles",0,n,"getCurrentSession",0,o,"getCurrentUser",0,s,"getUserProfile",0,i,"onAuthStateChange",0,e=>{let{data:{subscription:t}}=(0,r.createClient)().auth.onAuthStateChange(e);return()=>{t.unsubscribe()}},"signInWithGoogle",0,t,"signOut",0,a,"updateUserRole",0,l])},9165,e=>{"use strict";let r=new class{baseUrl;token;constructor(){this.baseUrl="",this.token=localStorage.getItem("token")}setToken(e){this.token=e,e?localStorage.setItem("token",e):localStorage.removeItem("token")}async request(e,r={}){let t=`${this.baseUrl}/api${e}`,a={"Content-Type":"application/json",...this.token&&{Authorization:`Bearer ${this.token}`},...r.headers},o={...r,headers:a,credentials:"include"};try{let e=await fetch(t,o);return await e.json()}catch(e){return console.error(`API request error to ${t}:`,e),{success:!1,error:"Network error or server unavailable"}}}async getProducts(){return this.request("/products")}async getProduct(e){return this.request(`/products/${e}`)}async getProductBySlug(e){return this.request(`/products/${e}`)}async createProduct(e){return this.request("/products",{method:"POST",body:JSON.stringify(e)})}async updateProduct(e,r){return this.request(`/products/${e}`,{method:"PUT",body:JSON.stringify(r)})}async searchProducts(e){let r=new URLSearchParams;e.q&&r.append("q",e.q),e.search&&r.append("search",e.search),e.category&&r.append("category",e.category),void 0!==e.minPrice&&r.append("minPrice",e.minPrice.toString()),void 0!==e.maxPrice&&r.append("maxPrice",e.maxPrice.toString()),e.page&&r.append("page",e.page.toString()),e.limit&&r.append("limit",e.limit.toString());let t=r.toString(),a=t?`/search/products?${t}`:"/search/products";return this.request(a)}async getCartItems(){return this.request("/cart")}async addToCart(e,r=1){let t={"Content-Type":"application/json"};return this.token&&(t.Authorization=`Bearer ${this.token}`),this.request("/cart",{method:"POST",headers:t,body:JSON.stringify({product_id:e,quantity:r})})}async updateCartItem(e,r){return this.request("/cart",{method:"PUT",body:JSON.stringify({product_id:e,quantity:r})})}async removeFromCart(e){return this.request("/cart",{method:"PUT",body:JSON.stringify({product_id:e,quantity:0})})}async clearCart(){return this.request("/cart",{method:"DELETE"})}async getOrders(){return this.request("/orders")}async createOrder(e){return this.request("/orders",{method:"POST",body:JSON.stringify(e)})}async createCheckoutSession(e){return this.request("/checkout/create",{method:"POST",body:JSON.stringify(e)})}async verifyPayment(e){return this.request("/checkout/verify",{method:"POST",body:JSON.stringify(e)})}async getAppointments(e){let r=new URLSearchParams;e?.status&&r.append("status",e.status),e?.date&&r.append("date",e.date),e?.page&&r.append("page",e.page.toString()),e?.limit&&r.append("limit",e.limit.toString());let t=r.toString(),a=t?`/appointments?${t}`:"/appointments";return this.request(a)}async createAppointment(e){return this.request("/appointments",{method:"POST",body:JSON.stringify(e)})}async getAppointment(e){return this.request(`/appointments/${e}`)}async updateAppointment(e,r){return this.request(`/appointments/${e}`,{method:"PUT",body:JSON.stringify(r)})}async deleteAppointment(e){return this.request(`/appointments/${e}`,{method:"DELETE"})}};e.s(["apiClient",0,r])},63371,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(9165),o=e.i(45828);let s={user:null,token:null,products:[],cartItems:[],orders:[],appointments:[],loading:{products:!1,cart:!1,orders:!1,appointments:!1,auth:!1,user:!1},error:{products:null,cart:null,orders:null,appointments:null,auth:null,user:null}},i="SET_USER",l="SET_TOKEN",n="SET_PRODUCTS",c="SET_CART_ITEMS",u="SET_ORDERS",d="SET_APPOINTMENTS",p="SET_LOADING",m="SET_ERROR",g="ADD_TO_CART",y="REMOVE_FROM_CART",f="UPDATE_CART_ITEM",h="CLEAR_CART",S="ADD_ORDER",w=(e,r)=>{switch(r.type){case i:return{...e,user:r.payload};case l:return{...e,token:r.payload};case n:return{...e,products:r.payload};case c:return{...e,cartItems:r.payload};case u:return{...e,orders:r.payload};case d:return{...e,appointments:r.payload};case p:return{...e,loading:{...e.loading,[r.payload.type]:r.payload.value}};case m:return{...e,error:{...e.error,[r.payload.type]:r.payload.value}};case g:let t;return t=e.cartItems.find(e=>e.product_id===r.payload.product_id)?e.cartItems.map(e=>e.product_id===r.payload.product_id?r.payload:e):[...e.cartItems,r.payload],{...e,cartItems:t};case f:return{...e,cartItems:e.cartItems.map(e=>e.product_id===r.payload.product_id?{...e,quantity:r.payload.quantity}:e)};case y:return{...e,cartItems:e.cartItems.filter(e=>e.product_id!==r.payload)};case h:return{...e,cartItems:[]};case S:return{...e,orders:[r.payload,...e.orders]};default:return e}},C=(0,t.createContext)(void 0);e.s(["AppContext",0,C,"AppProvider",0,({children:E})=>{let[I,_]=(0,t.useReducer)(w,s),P=(0,t.useRef)(null);console.log("ðŸ”„ AppContext initializing..."),(0,t.useEffect)(()=>{let e=!0;(async()=>{try{let r=await (0,o.getCurrentUser)();if(e&&r){let t=await (0,o.getUserProfile)();if(t){let a={id:t.id,name:r.user_metadata?.full_name||r.user_metadata?.name||r.email?.split("@")[0]||"User",email:r.email,avatar:r.user_metadata?.avatar||r.user_metadata?.picture||null,role:t.role,created_at:r.created_at};e&&(_({type:i,payload:a}),localStorage.setItem("user",JSON.stringify(a)),console.log("âœ… User restored from Supabase session:",a))}else{let t={id:r.id,name:r.user_metadata?.full_name||r.user_metadata?.name||r.email?.split("@")[0]||"User",email:r.email,avatar:r.user_metadata?.avatar||r.user_metadata?.picture||null,role:"customer",created_at:r.created_at};e&&(_({type:i,payload:t}),localStorage.setItem("user",JSON.stringify(t)),console.log("âœ… User restored from Supabase session (fallback):",t))}}else e&&(localStorage.removeItem("user"),console.log("âŒ No user in Supabase session, cleared user data"))}catch(r){console.error("Error initializing auth with Supabase:",r),e&&(localStorage.removeItem("user"),_({type:i,payload:null}))}})();let r=(0,o.onAuthStateChange)(async(r,t)=>{if(console.log("ðŸ” Auth state changed:",r),e&&"SIGNED_IN"===r&&t?.user){let e=await (0,o.getUserProfile)();if(e){let r={id:e.id,name:t.user.user_metadata?.full_name||t.user.user_metadata?.name||t.user.email?.split("@")[0]||"User",email:t.user.email,avatar:t.user.user_metadata?.avatar||t.user.user_metadata?.picture||null,role:e.role,created_at:t.user.created_at};_({type:i,payload:r}),localStorage.setItem("user",JSON.stringify(r)),console.log("âœ… User set after sign in:",r)}else{let e={id:t.user.id,name:t.user.user_metadata?.full_name||t.user.user_metadata?.name||t.user.email?.split("@")[0]||"User",email:t.user.email,avatar:t.user.user_metadata?.avatar||t.user.user_metadata?.picture||null,role:"customer",created_at:t.user.created_at};_({type:i,payload:e}),localStorage.setItem("user",JSON.stringify(e)),console.log("âœ… User set after sign in (fallback):",e)}}else e&&"SIGNED_OUT"===r&&(localStorage.removeItem("user"),localStorage.removeItem("cartItems"),_({type:i,payload:null}),_({type:c,payload:[]}),console.log("âœ… User cleared after sign out"))});return()=>{e=!1,r&&r()}},[]);let v=async()=>{if(!I.user){_({type:c,payload:[]}),e.A(69136).then(e=>{e.useCartStore.getState().clearCart()});return}T("cart",!0),b("cart",null);try{let r=await a.apiClient.getCartItems();r.success&&r.data?(_({type:c,payload:r.data}),e.A(69136).then(e=>{e.useCartStore.getState().clearCart(),r.data.forEach(r=>{e.useCartStore.getState().addItem(r)})})):(console.warn("No cart items found for user:",r.error),_({type:c,payload:[]}),e.A(69136).then(e=>{e.useCartStore.getState().clearCart()}))}catch(r){console.error("Error fetching cart items:",r),b("cart",r.message||"Failed to load cart items. Please try again later."),_({type:c,payload:[]}),e.A(69136).then(e=>{e.useCartStore.getState().clearCart()})}finally{T("cart",!1)}};(0,t.useEffect)(()=>{I.user?v():_({type:c,payload:[]})},[I.user]),(0,t.useEffect)(()=>{e.A(69136).then(e=>{let{items:r}=e.useCartStore.getState();0===r.length&&I.cartItems.length>0?I.cartItems.forEach(r=>{e.useCartStore.getState().addItem(r)}):r.length>0&&0===I.cartItems.length&&_({type:c,payload:r})})},[I.cartItems]),(0,t.useEffect)(()=>{I.user||localStorage.setItem("cartItems",JSON.stringify(I.cartItems))},[I.cartItems,I.user]);let A=e=>{_({type:i,payload:e}),e?localStorage.setItem("user",JSON.stringify(e)):localStorage.removeItem("user")},O=e=>{_({type:l,payload:e}),e?localStorage.setItem("token",e):localStorage.removeItem("token")},T=(e,r)=>{_({type:p,payload:{type:e,value:r}})},b=(e,r)=>{_({type:m,payload:{type:e,value:r}})},q=async()=>{if(!I.loading.products){T("products",!0),b("products",null);try{let e=await a.apiClient.getProducts();if(e.success&&e.data){let r=(Array.isArray(e.data)?e.data:e.data?.products||[]).map(e=>({...e,price:"number"==typeof e.price?e.price:parseFloat(e.price),image_url:e.image_url&&(e.image_url.startsWith("http")||e.image_url.startsWith("/"))?e.image_url:void 0,imageClass:(e=>{if(!e)return"modern";let r=e.toLowerCase();if(r.includes("modern")||r.includes("coffee")||r.includes("sofa"))return"modern";if(r.includes("classic")||r.includes("armchair"))return"classic";if(r.includes("vintage")||r.includes("lamp"))return"coastal";if(r.includes("dining")||r.includes("dresser"))return"office";if(r.includes("wall")||r.includes("art"))return"hotel";else if(r.includes("rug"))return"restaurant";else return"modern"})(e.image_url)||e.imageClass||"modern"}));_({type:n,payload:r})}else throw Error(e.error||"Failed to load products")}catch(e){console.error("Error fetching products:",e),b("products",e.message||"Failed to load products. Please try again later.")}finally{T("products",!1)}}},F=new Set,U=async(r,t=1)=>{if(!F.has(r.id))if(I.user){F.add(r.id),T("cart",!0),b("cart",null);try{let o=await a.apiClient.addToCart(r.id,t);if(o.success&&o.data)_({type:g,payload:o.data}),e.A(69136).then(e=>{e.useCartStore.getState().addItem(o.data)});else throw Error(o.error||"Failed to add item to cart")}catch(e){console.error("Error adding to cart:",e),b("cart",e.message||"Failed to add item to cart. Please try again.")}finally{F.delete(r.id),T("cart",!1)}}else{let a={id:Date.now(),product_id:r.id,quantity:t,name:r.name,price:r.price,image_url:r.image_url};e.A(69136).then(e=>{e.useCartStore.getState().addItem(a)})}},k=async(r,t)=>{if(!r||"number"!=typeof r||r<=0)return void console.error("Invalid product ID provided to updateCartItem:",r);if(I.user){T("cart",!0),b("cart",null);try{let o=await a.apiClient.updateCartItem(r,t);if(o.success&&o.data)_({type:g,payload:o.data}),e.A(69136).then(e=>{e.useCartStore.getState().updateItem(product_id,t)});else if(t<=0&&o.success)_({type:y,payload:product_id}),e.A(69136).then(e=>{e.useCartStore.getState().removeItem(product_id)});else throw Error(o.error||"Failed to update cart item")}catch(e){console.error("Error updating cart item:",e),b("cart",e.message||"Failed to update cart item. Please try again.")}finally{T("cart",!1)}}else{t<=0?(_({type:y,payload:r}),e.A(69136).then(e=>{e.useCartStore.getState().removeItem(r)})):(_({type:f,payload:{product_id:r,quantity:t}}),e.A(69136).then(e=>{e.useCartStore.getState().updateItem(r,t)}));let a=JSON.parse(localStorage.getItem("cartItems")||"[]"),o=a.findIndex(e=>e.product_id===r);if(-1!==o)t<=0?a.splice(o,1):a[o].quantity=t;else if(t>0){let e=I.products.find(e=>e.id===r);e&&a.push({id:e.id,product_id:e.id,name:e.name,price:e.price,quantity:t,image_url:e.image_url,user_id:null})}localStorage.setItem("cartItems",JSON.stringify(a))}},N=async r=>{if(!r||"number"!=typeof r||r<=0)return void console.error("Invalid product ID provided to removeFromCart:",r);if(I.user){T("cart",!0),b("cart",null);try{let t=await a.apiClient.removeFromCart(r);if(t.success)_({type:y,payload:r}),e.A(69136).then(e=>{e.useCartStore.getState().removeItem(r)});else throw Error(t.error||"Failed to remove item from cart")}catch(e){console.error("Error removing from cart:",e),b("cart",e.message||"Failed to remove item from cart. Please try again.")}finally{T("cart",!1)}}else{_({type:y,payload:r}),e.A(69136).then(e=>{e.useCartStore.getState().removeItem(r)});let t=JSON.parse(localStorage.getItem("cartItems")||"[]").filter(e=>e.product_id!==r);localStorage.setItem("cartItems",JSON.stringify(t))}},R=async()=>{if(I.user){T("cart",!0),b("cart",null);try{let r=await a.apiClient.clearCart();if(r.success)_({type:h}),e.A(69136).then(e=>{e.useCartStore.getState().clearCart()});else throw Error(r.error||"Failed to clear cart")}catch(e){console.error("Error clearing cart:",e),b("cart",e.message||"Failed to clear cart. Please try again.")}finally{T("cart",!1)}}else _({type:h}),e.A(69136).then(e=>{e.useCartStore.getState().clearCart()}),localStorage.removeItem("cartItems")},J=async()=>{if(I.user){T("orders",!0),b("orders",null);try{let e=await a.apiClient.getOrders();if(e.success&&e.data)_({type:u,payload:e.data});else throw Error(e.error||"Failed to load orders")}catch(e){console.error("Error fetching orders:",e),b("orders",e.message||"Failed to load orders. Please try again later.")}finally{T("orders",!1)}}},x=async e=>{if(I.user){T("orders",!0),b("orders",null);try{let r=await a.apiClient.createOrder(e);if(r.success&&r.data)return _({type:S,payload:r.data}),_({type:h}),r.data;throw Error(r.error||"Failed to create order")}catch(e){throw console.error("Error creating order:",e),e.message&&e.message.includes("Validation Error")?b("orders","Please check your order details and try again."):b("orders",e.message||"Failed to create order. Please try again."),e}finally{T("orders",!1)}}},D=async()=>{if(I.user){T("user",!0),b("user",null);try{let e=await fetch("/api/profile",{headers:{Authorization:`Bearer ${I.token}`}}),r=await e.json();if(r.success&&r.data)return A(r.data),r.data;if(I.user)return I.user;throw Error(r.error||"Failed to fetch user profile")}catch(e){if(console.error("Error fetching user profile:",e),I.user)return I.user;throw b("user",e.message||"Failed to fetch user profile. Please try again later."),e}finally{T("user",!1)}}},$=async e=>{if(I.user){T("user",!0),b("user",null);try{let r=await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${I.token}`},body:JSON.stringify(e)}),t=await r.json();if(t.success&&t.data)return A(t.data),t.data;throw Error(t.error||"Failed to update profile")}catch(e){throw console.error("Error updating profile:",e),b("user",e.message||"Failed to update profile. Please try again."),e}finally{T("user",!1)}}},j=async e=>{throw Error("Email/password login is not supported. Please use Google OAuth.")},L=async e=>{throw Error("Email/password registration is not supported. Please use Google OAuth.")},B=async()=>{try{P.current=[...I.cartItems],localStorage.removeItem("cartItems"),A(null),O(null),localStorage.removeItem("user"),localStorage.removeItem("token"),_({type:h}),_({type:u,payload:[]});try{let{createClient:r}=await e.A(28400),t=r(),{error:a}=await t.auth.signOut();a&&console.error("Supabase sign out error:",a)}catch(e){console.error("Error with main Supabase sign out:",e)}try{let{signOut:r}=await e.A(18385);await r()}catch(e){console.warn("Additional signOut failed (this is ok):",e)}try{let{apiClient:r}=await e.A(64486);r.setToken(null)}catch(e){console.warn("Error resetting API client token:",e)}await new Promise(e=>setTimeout(e,300))}catch(e){console.error("Error during logout:",e)}},G=async e=>{if(I.user){T("products",!0),b("products",null);try{let r=await a.apiClient.createProduct(e);if(r.success&&r.data)return _({type:n,payload:[...I.products,r.data]}),r.data;throw Error(r.error||"Failed to create product")}catch(e){throw console.error("Error creating product:",e),b("products",e.message||"Failed to create product. Please try again."),e}finally{T("products",!1)}}},W=async(e,r)=>{if(I.user){T("products",!0),b("products",null);try{let t=await a.apiClient.updateProduct(e,r);if(t.success&&t.data){let r=I.products.map(r=>r.id===e?t.data:r);return _({type:n,payload:r}),t.data}throw Error(t.error||"Failed to update product")}catch(e){throw console.error("Error updating product:",e),b("products",e.message||"Failed to update product. Please try again."),e}finally{T("products",!1)}}},z=async e=>{T("products",!0),b("products",null);try{let r=await a.apiClient.getProductBySlug(e);if(r.success&&r.data){let t={...r.data,slug:r.data.slug||e},a=[...I.products],o=a.findIndex(e=>e.id===t.id);return -1!==o?a[o]=t:a.push(t),_({type:n,payload:a}),t}throw Error(r.error||"Failed to fetch product")}catch(e){throw console.error("Error fetching product by slug:",e),b("products",e.message||"Failed to fetch product. Please try again."),e}finally{T("products",!1)}},M=async e=>{T("products",!0),b("products",null);try{let r=await a.apiClient.searchProducts(e);if(r.success&&r.data){let e=(Array.isArray(r.data)?r.data:r.data?.products||[]).map(e=>({...e,price:"number"==typeof e.price?e.price:parseFloat(e.price),image_url:e.image_url&&(e.image_url.startsWith("http")||e.image_url.startsWith("/"))?e.image_url:void 0,imageClass:(e=>{if(!e)return"modern";let r=e.toLowerCase();if(r.includes("modern")||r.includes("coffee")||r.includes("sofa"))return"modern";if(r.includes("classic")||r.includes("armchair"))return"classic";if(r.includes("vintage")||r.includes("lamp"))return"coastal";if(r.includes("dining")||r.includes("dresser"))return"office";if(r.includes("wall")||r.includes("art"))return"hotel";else if(r.includes("rug"))return"restaurant";else return"modern"})(e.image_url)||e.imageClass||"modern"}));if(_({type:n,payload:e}),r.data.pagination)return{products:e,pagination:r.data.pagination,filters:r.data.filters};return e}throw Error(r.error||"Failed to search products")}catch(e){throw console.error("Error searching products:",e),b("products",e.message||"Failed to search products. Please try again."),e}finally{T("products",!1)}},K=async()=>{if(!I.user)return!1;try{if((await a.apiClient.getOrders()).success)return!0;throw Error("Token verification failed")}catch(e){return console.error("Token verification failed:",e),B(),!1}},V=async e=>{if(I.user){T("appointments",!0),b("appointments",null);try{let r=await a.apiClient.getAppointments(e);if(r.success&&r.data)return _({type:d,payload:r.data.appointments}),r.data;throw Error(r.error||"Failed to fetch appointments")}catch(e){throw console.error("Error fetching appointments:",e),b("appointments",e.message||"Failed to fetch appointments. Please try again."),e}finally{T("appointments",!1)}}},H=async e=>{if(I.user)try{let r=await a.apiClient.createAppointment(e);if(r.success&&r.data)return await V(),r.data;throw Error(r.error||"Failed to create appointment")}catch(e){throw console.error("Error creating appointment:",e),e}},Q=async(e,r)=>{if(I.user)try{let t=await a.apiClient.updateAppointment(e,r);if(t.success&&t.data)return await V(),t.data;throw Error(t.error||"Failed to update appointment")}catch(e){throw console.error("Error updating appointment:",e),e}},X={...I,setUser:A,setToken:O,setLoading:T,setError:b,fetchProducts:q,fetchCartItems:v,addToCart:U,updateCartItem:k,removeFromCart:N,clearCart:R,fetchOrders:J,createOrder:x,fetchAppointments:V,createAppointment:H,updateAppointment:Q,login:j,register:L,logout:B,verifyToken:K,fetchUserProfile:D,updateUserProfile:$,createProduct:G,updateProduct:W,fetchProductBySlug:z,searchProducts:M,addToCartWithAuth:(e,r=1)=>I.user?{success:!0,requiresLogin:!1,product:e,quantity:r,action:()=>U(e,r)}:{success:!1,requiresLogin:!0,product:e,quantity:r},clearPendingCartAction:()=>{localStorage.removeItem("pendingCartAction")}};return(0,r.jsx)(C.Provider,{value:X,children:E})},"useAppContext",0,()=>{let e=(0,t.useContext)(C);if(!e)throw Error("useAppContext must be used within an AppProvider");return e}])},37856,e=>{"use strict";var r=e.i(43476),t=e.i(71645);let a=(0,t.createContext)(void 0);function o({supabaseClient:e,children:o}){let[s,i]=(0,t.useState)(null),[l,n]=(0,t.useState)(null),[c,u]=(0,t.useState)(null),[d,p]=(0,t.useState)(!0);return(0,t.useEffect)(()=>{(async()=>{p(!0);let{data:{session:r}}=await e.auth.getSession();if(i(r),n(r?.user||null),r?.user){let{data:t,error:a}=await e.from("profiles").select("id, role").eq("id",r.user.id).single();if(a){console.warn("User profile not found, creating new profile for user:",r.user.id);let{error:t}=await e.from("profiles").insert([{id:r.user.id,role:"customer"}]);if(t)console.error("Error creating user profile:",t),u(null);else{let{data:t,error:a}=await e.from("profiles").select("id, role").eq("id",r.user.id).single();a?(console.error("Error fetching newly created user profile:",a),u(null)):u(t)}}else u(t)}else u(null);p(!1);let{data:{subscription:t}}=await e.auth.onAuthStateChange(async(r,t)=>{if(i(t),n(t?.user||null),t?.user){let{data:r,error:a}=await e.from("profiles").select("id, role").eq("id",t.user.id).single();if(a){console.warn("User profile not found during auth state change, creating new profile for user:",t.user.id);let{error:r}=await e.from("profiles").insert([{id:t.user.id,role:"customer"}]);if(r)console.error("Error creating user profile:",r),u(null);else{let{data:r,error:a}=await e.from("profiles").select("id, role").eq("id",t.user.id).single();a?(console.error("Error fetching newly created user profile:",a),u(null)):u(r)}}else u(r)}else u(null)});return()=>{t.unsubscribe()}})()},[e]),(0,r.jsx)(a.Provider,{value:{session:s,user:l,profile:c,loading:d},children:o})}var s=e.i(11795);function i({children:e}){let t=(0,s.createClient)();return(0,r.jsx)(o,{supabaseClient:t,children:e})}e.s(["NextAuthProvider",()=>i],37856)},69136,e=>{e.v(r=>Promise.all(["static/chunks/ca0e36c9675c4fa4.js"].map(r=>e.l(r))).then(()=>r(80230)))},28400,e=>{e.v(e=>Promise.resolve().then(()=>e(11795)))},18385,e=>{e.v(e=>Promise.resolve().then(()=>e(45828)))},64486,e=>{e.v(e=>Promise.resolve().then(()=>e(9165)))}]);