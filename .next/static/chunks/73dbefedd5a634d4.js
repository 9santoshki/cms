(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54201,(r,e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"warnOnce",{enumerable:!0,get:function(){return a}});let a=r=>{}},33637,r=>{"use strict";var e=r.i(24431),t=r.i(33225);let a=new class{baseUrl;token;constructor(){this.baseUrl="",this.token=localStorage.getItem("token")}setToken(r){this.token=r,r?localStorage.setItem("token",r):localStorage.removeItem("token")}async request(r,e={}){let t=`${this.baseUrl}/api${r}`,a={"Content-Type":"application/json",...this.token&&{Authorization:`Bearer ${this.token}`},...e.headers},o={...e,headers:a};try{let r=await fetch(t,o);return await r.json()}catch(r){return console.error(`API request error to ${t}:`,r),{success:!1,error:"Network error or server unavailable"}}}async login(r){return this.request("/auth/login",{method:"POST",body:JSON.stringify(r)})}async register(r){return this.request("/auth/register",{method:"POST",body:JSON.stringify(r)})}async getProducts(){return this.request("/products")}async getProduct(r){return this.request(`/products/${r}`)}async getCartItems(){return this.request("/cart")}async addToCart(r,e=1){return this.request("/cart",{method:"POST",body:JSON.stringify({product_id:r,quantity:e})})}async updateCartItem(r,e){return this.request("/cart",{method:"PUT",body:JSON.stringify({product_id:r,quantity:e})})}async removeFromCart(r){return this.request(`/cart/${r}`,{method:"DELETE"})}async clearCart(){return this.request("/cart",{method:"DELETE"})}async getOrders(){return this.request("/orders")}async createOrder(r){return this.request("/orders",{method:"POST",body:JSON.stringify(r)})}},o={user:null,token:null,products:[],cartItems:[],orders:[],loading:{products:!1,cart:!1,orders:!1,auth:!1},error:{products:null,cart:null,orders:null,auth:null}},s="SET_USER",l="SET_TOKEN",c="SET_PRODUCTS",n="SET_CART_ITEMS",i="SET_ORDERS",d="SET_LOADING",u="SET_ERROR",y="ADD_TO_CART",p="REMOVE_FROM_CART",m="UPDATE_CART_ITEM",g="CLEAR_CART",h="ADD_ORDER",f=(r,e)=>{switch(e.type){case s:return{...r,user:e.payload};case l:return{...r,token:e.payload};case c:return{...r,products:e.payload};case n:return{...r,cartItems:e.payload};case i:return{...r,orders:e.payload};case d:return{...r,loading:{...r.loading,products:!1}};case u:return{...r,error:{...r.error,[e.payload.type]:e.payload.value}};case y:let t;return t=r.cartItems.find(r=>r.id===e.payload.id)?r.cartItems.map(r=>r.id===e.payload.id?{...r,quantity:r.quantity+e.payload.quantity}:r):[...r.cartItems,e.payload],{...r,cartItems:t};case m:return{...r,cartItems:r.cartItems.map(r=>r.id===e.payload.id?{...r,quantity:e.payload.quantity}:r)};case p:return{...r,cartItems:r.cartItems.filter(r=>r.id!==e.payload)};case g:return{...r,cartItems:[]};case h:return{...r,orders:[e.payload,...r.orders]};default:return r}},E=(0,t.createContext)(void 0);r.s(["AppProvider",0,({children:r})=>{let[S,I]=(0,t.useReducer)(f,o);(0,t.useEffect)(()=>{let r=localStorage.getItem("token"),e=localStorage.getItem("user");if(r&&I({type:l,payload:r}),e)try{let r=JSON.parse(e);I({type:s,payload:r})}catch(r){console.error("Error parsing user from localStorage:",r),localStorage.removeItem("user")}},[]),(0,t.useEffect)(()=>{let r=localStorage.getItem("cartItems");if(r)try{let e=JSON.parse(r);I({type:n,payload:e})}catch(r){console.error("Error parsing cart from localStorage:",r),localStorage.removeItem("cartItems")}},[]),(0,t.useEffect)(()=>{localStorage.setItem("cartItems",JSON.stringify(S.cartItems))},[S.cartItems]);let T=r=>{I({type:s,payload:r}),r?localStorage.setItem("user",JSON.stringify(r)):localStorage.removeItem("user")},k=r=>{I({type:l,payload:r}),r?localStorage.setItem("token",r):localStorage.removeItem("token")},w=(r,e)=>{I({type:d,payload:{type:r,value:e}})},O=(r,e)=>{I({type:u,payload:{type:r,value:e}})},P=async()=>{if(!S.loading.products){w("products",!0),O("products",null);try{let r=await a.getProducts();if(r.success&&r.data){let e=r.data.map(r=>({...r,price:"number"==typeof r.price?r.price:parseFloat(r.price),imageClass:r.image_url||"modern"}));I({type:c,payload:e})}else throw Error(r.error||"Failed to load products")}catch(r){console.error("Error fetching products:",r),O("products",r.message||"Failed to load products. Please try again later.")}finally{w("products",!1)}}},C=async()=>{if(S.token){w("cart",!0),O("cart",null);try{let r=await a.getCartItems();if(r.success&&r.data)I({type:n,payload:r.data});else throw Error(r.error||"Failed to load cart items")}catch(r){console.error("Error fetching cart items:",r),O("cart",r.message||"Failed to load cart items. Please try again later.")}finally{w("cart",!1)}}},v=async(r,e=1)=>{if(S.token){w("cart",!0),O("cart",null);try{let t=await a.addToCart(r.id,e);if(t.success&&t.data)I({type:y,payload:t.data});else throw Error(t.error||"Failed to add item to cart")}catch(r){console.error("Error adding to cart:",r),O("cart",r.message||"Failed to add item to cart. Please try again.")}finally{w("cart",!1)}}else I({type:y,payload:{...r,quantity:e}})},R=async(r,e)=>{if(S.token){w("cart",!0),O("cart",null);try{let t=await a.updateCartItem(r,e);if(t.success&&t.data)I({type:m,payload:t.data});else if(e<=0&&t.success)I({type:p,payload:r});else throw Error(t.error||"Failed to update cart item")}catch(r){console.error("Error updating cart item:",r),O("cart",r.message||"Failed to update cart item. Please try again.")}finally{w("cart",!1)}}else e<=0?I({type:p,payload:r}):I({type:m,payload:{id:r,quantity:e}})},F=async r=>{if(S.token){w("cart",!0),O("cart",null);try{let e=await a.removeFromCart(r);if(e.success)I({type:p,payload:r});else throw Error(e.error||"Failed to remove item from cart")}catch(r){console.error("Error removing from cart:",r),O("cart",r.message||"Failed to remove item from cart. Please try again.")}finally{w("cart",!1)}}else I({type:p,payload:r})},_=async()=>{if(S.token){w("cart",!0),O("cart",null);try{let r=await a.clearCart();if(r.success)I({type:g});else throw Error(r.error||"Failed to clear cart")}catch(r){console.error("Error clearing cart:",r),O("cart",r.message||"Failed to clear cart. Please try again.")}finally{w("cart",!1)}}else I({type:g})},q=async()=>{if(S.token){w("orders",!0),O("orders",null);try{let r=await a.getOrders();if(r.success&&r.data)I({type:i,payload:r.data});else throw Error(r.error||"Failed to load orders")}catch(r){console.error("Error fetching orders:",r),O("orders",r.message||"Failed to load orders. Please try again later.")}finally{w("orders",!1)}}},A=async r=>{if(S.token){w("orders",!0),O("orders",null);try{let e=await a.createOrder(r);if(e.success&&e.data)return I({type:h,payload:e.data}),I({type:g}),e.data;throw Error(e.error||"Failed to create order")}catch(r){throw console.error("Error creating order:",r),r.message&&r.message.includes("Validation Error")?O("orders","Please check your order details and try again."):O("orders",r.message||"Failed to create order. Please try again."),r}finally{w("orders",!1)}}},b=async r=>{w("auth",!0),O("auth",null);try{let e=await a.login(r);if(e.success&&e.data)return a.setToken(e.data.token),k(e.data.token),T(e.data.user),e.data;throw Error(e.error||"Login failed. Please check your credentials.")}catch(r){throw console.error("Login error:",r),r.message?O("auth",r.message):O("auth","Login failed. Please check your credentials."),r}finally{w("auth",!1)}},N=async r=>{w("auth",!0),O("auth",null);try{let e=await a.register(r);if(e.success&&e.data)return a.setToken(e.data.token),k(e.data.token),T(e.data.user),e.data;throw Error(e.error||"Registration failed. Please try again.")}catch(r){throw console.error("Registration error:",r),r.message?O("auth",r.message):O("auth","Registration failed. Please try again."),r}finally{w("auth",!1)}},D=()=>{k(null),T(null),I({type:g}),I({type:i,payload:[]})},J=async()=>{if(!S.token)return!1;try{if((await a.getOrders()).success)return!0;throw Error("Token verification failed")}catch(r){return console.error("Token verification failed:",r),D(),!1}},U={...S,setUser:T,setToken:k,setLoading:w,setError:O,fetchProducts:P,fetchCartItems:C,addToCart:v,updateCartItem:R,removeFromCart:F,clearCart:_,fetchOrders:q,createOrder:A,login:b,register:N,logout:D,verifyToken:J};return(0,e.jsx)(E.Provider,{value:U,children:r})},"useAppContext",0,()=>{let r=(0,t.useContext)(E);if(!r)throw Error("useAppContext must be used within an AppProvider");return r}],33637)}]);