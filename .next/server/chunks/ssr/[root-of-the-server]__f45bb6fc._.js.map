{"version":3,"sources":["turbopack:///[project]/src/app/dashboard/products/[id]/page.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/src/app/dashboard/products/[id]/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/dashboard/products/[id]/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/dashboard/products/[id]/page.tsx\",\n    \"default\",\n);\n","'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/context/AuthContext';\nimport DashboardLayout from '@/components/DashboardLayout';\nimport ProductImageManager from '@/components/ProductImageManager';\n\ninterface ProductImage {\n  id: string;\n  url: string;\n  cloudflare_image_id: string;\n  is_primary: boolean;\n  display_order: number;\n}\n\ninterface Product {\n  id: string;\n  name: string;\n  description: string;\n  price: number;\n  original_price?: number;\n  sale_price?: number;\n  category?: string;\n  stock_quantity?: number;\n  images: ProductImage[];\n  primary_image?: string;\n}\n\nexport default function EditProductPage({ params }: { params: Promise<{ id: string }> }) {\n  const router = useRouter();\n  const { user } = useAuth();\n  const [product, setProduct] = useState<Product | null>(null);\n  const [loadingProduct, setLoadingProduct] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n  const [productId, setProductId] = useState<string | null>(null);\n\n  const [formData, setFormData] = useState({\n    name: '',\n    description: '',\n    price: '',\n    original_price: '',\n    sale_price: '',\n    category: '',\n    stock_quantity: '',\n  });\n\n  useEffect(() => {\n    params.then((p) => setProductId(p.id));\n  }, []);\n\n  useEffect(() => {\n    if (!user) {\n      router.push('/auth?redirect=/dashboard/products');\n      return;\n    }\n\n    if (user.role !== 'admin') {\n      router.push('/dashboard');\n      return;\n    }\n\n    if (productId) {\n      loadProduct();\n    }\n  }, [user, productId]);\n\n  const loadProduct = async () => {\n    if (!productId) return;\n\n    // If productId is \"new\", we're creating a new product, not loading one\n    if (productId === 'new') {\n      setLoadingProduct(false);\n      return;\n    }\n\n    try {\n      setLoadingProduct(true);\n      const response = await fetch(`/api/products/${productId}`);\n      const data = await response.json();\n\n      if (data.success) {\n        setProduct(data.data);\n        setFormData({\n          name: data.data.name,\n          description: data.data.description,\n          price: data.data.price.toString(),\n          original_price: data.data.original_price?.toString() || '',\n          sale_price: data.data.sale_price?.toString() || '',\n          category: data.data.category || '',\n          stock_quantity: data.data.stock_quantity?.toString() || '0',\n        });\n      } else {\n        setError(data.error || 'Failed to load product');\n      }\n    } catch (err: any) {\n      console.error('Error loading product:', err);\n      setError(err.message || 'Failed to load product');\n    } finally {\n      setLoadingProduct(false);\n    }\n  };\n\n  const handleInputChange = (\n    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>\n  ) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!productId) return;\n\n    setSaving(true);\n    setError(null);\n    setSuccessMessage(null);\n\n    try {\n      const isNewProduct = productId === 'new';\n      const url = isNewProduct ? '/api/products' : `/api/products/${productId}`;\n      const method = isNewProduct ? 'POST' : 'PUT';\n\n      const response = await fetch(url, {\n        method,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          name: formData.name,\n          description: formData.description,\n          price: parseFloat(formData.price),\n          original_price: formData.original_price ? parseFloat(formData.original_price) : null,\n          sale_price: formData.sale_price ? parseFloat(formData.sale_price) : null,\n          category: formData.category,\n          stock_quantity: parseInt(formData.stock_quantity) || 0,\n        }),\n      });\n\n      const data = await response.json();\n\n      if (data.success) {\n        if (isNewProduct) {\n          // Redirect to the edit page with the new product ID\n          setSuccessMessage('Product created successfully! Redirecting...');\n          setTimeout(() => {\n            router.push(`/dashboard/products/${data.data.id}`);\n          }, 1000);\n        } else {\n          setSuccessMessage('Product updated successfully!');\n          loadProduct();\n          setTimeout(() => setSuccessMessage(null), 3000);\n        }\n      } else {\n        setError(data.error || `Failed to ${isNewProduct ? 'create' : 'update'} product`);\n      }\n    } catch (err: any) {\n      console.error('Error saving product:', err);\n      setError(err.message || 'Failed to save product');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!productId) return;\n\n    if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`/api/products/${productId}`, {\n        method: 'DELETE',\n      });\n\n      const data = await response.json();\n\n      if (data.success) {\n        setSuccessMessage('Product deleted successfully');\n        setTimeout(() => {\n          router.push('/dashboard/products');\n        }, 1000);\n      } else {\n        setError(data.error || 'Failed to delete product');\n      }\n    } catch (err: any) {\n      console.error('Error deleting product:', err);\n      setError(err.message || 'Failed to delete product');\n    }\n  };\n\n  if (!user || loadingProduct) {\n    return (\n      <div style={{\n        minHeight: '100vh',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        background: 'linear-gradient(135deg, #f8f4f0 0%, #efe9e3 100%)'\n      }}>\n        <div style={{ textAlign: 'center' }}>\n          <div style={{\n            width: '48px',\n            height: '48px',\n            border: '3px solid #f0f0f0',\n            borderTop: '3px solid #c19a6b',\n            borderRadius: '50%',\n            animation: 'spin 1s linear infinite',\n            margin: '0 auto'\n          }}></div>\n          <style jsx>{`\n            @keyframes spin {\n              0% { transform: rotate(0deg); }\n              100% { transform: rotate(360deg); }\n            }\n          `}</style>\n          <p style={{ marginTop: '16px', color: '#666', fontSize: '14px' }}>Loading product...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error && !product) {\n    return (\n      <DashboardLayout title=\"Error\" description=\"Failed to load product\">\n        <div style={{\n          background: 'white',\n          borderRadius: '12px',\n          padding: '64px 32px',\n          textAlign: 'center',\n          boxShadow: '0 4px 12px rgba(193, 154, 107, 0.08)',\n          border: '1px solid #e8d5c4'\n        }}>\n          <i className=\"fas fa-exclamation-circle\" style={{ fontSize: '64px', color: '#ef4444', marginBottom: '16px' }}></i>\n          <h3 style={{ fontSize: '20px', fontWeight: '600', color: '#333', marginBottom: '8px' }}>\n            Error Loading Product\n          </h3>\n          <p style={{ color: '#666', fontSize: '14px', marginBottom: '24px' }}>\n            {error}\n          </p>\n          <button\n            onClick={() => router.push('/dashboard/products')}\n            style={{\n              padding: '10px 24px',\n              background: 'linear-gradient(135deg, #c19a6b, #a67c52)',\n              color: 'white',\n              border: 'none',\n              borderRadius: '8px',\n              fontSize: '14px',\n              fontWeight: '600',\n              cursor: 'pointer'\n            }}\n          >\n            Back to Products\n          </button>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <>\n      <style jsx>{`\n        @media (max-width: 768px) {\n          .product-form-grid {\n            grid-template-columns: 1fr !important;\n          }\n          .action-bar {\n            flex-direction: column !important;\n            gap: 12px !important;\n          }\n          .action-bar button {\n            width: 100% !important;\n          }\n        }\n      `}</style>\n      <DashboardLayout\n        title={productId === 'new' ? 'Create New Product' : `Edit Product${product ? `: ${product.name}` : ''}`}\n        description={productId === 'new' ? 'Add a new product to your catalog' : 'Update product details, manage images, and configure settings.'}\n      >\n      {/* Action Bar */}\n      <div className=\"action-bar\" style={{\n        background: 'white',\n        borderRadius: '12px',\n        padding: '16px 20px',\n        marginBottom: '24px',\n        boxShadow: '0 4px 12px rgba(193, 154, 107, 0.08)',\n        border: '1px solid #e8d5c4',\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center'\n      }}>\n        <button\n          onClick={() => router.push('/dashboard/products')}\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: '8px',\n            padding: '8px 16px',\n            background: 'transparent',\n            color: '#666',\n            border: 'none',\n            borderRadius: '8px',\n            fontSize: '14px',\n            fontWeight: '600',\n            cursor: 'pointer',\n            transition: 'all 0.2s ease'\n          }}\n          onMouseEnter={(e) => {\n            e.currentTarget.style.background = 'rgba(193, 154, 107, 0.05)';\n            e.currentTarget.style.color = '#c19a6b';\n          }}\n          onMouseLeave={(e) => {\n            e.currentTarget.style.background = 'transparent';\n            e.currentTarget.style.color = '#666';\n          }}\n        >\n          <i className=\"fas fa-arrow-left\"></i>\n          Back to Products\n        </button>\n\n        {productId !== 'new' && (\n          <button\n            onClick={handleDelete}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: '8px',\n              padding: '8px 16px',\n              background: 'transparent',\n              color: '#ef4444',\n              border: '1px solid #fecaca',\n              borderRadius: '8px',\n              fontSize: '14px',\n              fontWeight: '600',\n              cursor: 'pointer',\n              transition: 'all 0.2s ease'\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.background = '#ef4444';\n              e.currentTarget.style.color = 'white';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.background = 'transparent';\n              e.currentTarget.style.color = '#ef4444';\n          }}\n        >\n          <i className=\"fas fa-trash\"></i>\n          Delete Product\n        </button>\n        )}\n      </div>\n\n      {/* Messages */}\n      {successMessage && (\n        <div style={{\n          background: 'rgba(34, 197, 94, 0.1)',\n          border: '1px solid rgba(34, 197, 94, 0.3)',\n          borderRadius: '12px',\n          padding: '16px 20px',\n          marginBottom: '24px',\n          display: 'flex',\n          alignItems: 'center',\n          gap: '12px'\n        }}>\n          <i className=\"fas fa-check-circle\" style={{ fontSize: '20px', color: '#16a34a' }}></i>\n          <p style={{ color: '#16a34a', fontSize: '14px', fontWeight: '600', margin: 0 }}>\n            {successMessage}\n          </p>\n        </div>\n      )}\n\n      {error && product && (\n        <div style={{\n          background: 'rgba(239, 68, 68, 0.1)',\n          border: '1px solid rgba(239, 68, 68, 0.3)',\n          borderRadius: '12px',\n          padding: '16px 20px',\n          marginBottom: '24px',\n          display: 'flex',\n          alignItems: 'center',\n          gap: '12px'\n        }}>\n          <i className=\"fas fa-exclamation-circle\" style={{ fontSize: '20px', color: '#ef4444' }}></i>\n          <p style={{ color: '#ef4444', fontSize: '14px', fontWeight: '600', margin: 0 }}>\n            {error}\n          </p>\n        </div>\n      )}\n\n      {/* Product Details Form */}\n      <div style={{\n        background: 'white',\n        borderRadius: '12px',\n        padding: '24px',\n        marginBottom: '24px',\n        boxShadow: '0 4px 12px rgba(193, 154, 107, 0.08)',\n        border: '1px solid #e8d5c4'\n      }}>\n        <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '24px' }}>\n          <i className=\"fas fa-edit\" style={{ fontSize: '20px', color: '#c19a6b' }}></i>\n          <h3 style={{ fontSize: '18px', fontWeight: '600', color: '#333', margin: 0 }}>\n            Product Details\n          </h3>\n        </div>\n\n        <form onSubmit={handleSubmit}>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>\n            {/* Product Name */}\n            <div>\n              <label style={{\n                display: 'block',\n                fontSize: '13px',\n                fontWeight: '600',\n                color: '#666',\n                marginBottom: '8px'\n              }}>\n                Product Name *\n              </label>\n              <input\n                type=\"text\"\n                name=\"name\"\n                value={formData.name}\n                onChange={handleInputChange}\n                required\n                style={{\n                  width: '100%',\n                  padding: '10px 14px',\n                  border: '1px solid #e8d5c4',\n                  borderRadius: '8px',\n                  fontSize: '14px',\n                  outline: 'none'\n                }}\n              />\n            </div>\n\n            {/* Description */}\n            <div>\n              <label style={{\n                display: 'block',\n                fontSize: '13px',\n                fontWeight: '600',\n                color: '#666',\n                marginBottom: '8px'\n              }}>\n                Description *\n              </label>\n              <textarea\n                name=\"description\"\n                value={formData.description}\n                onChange={handleInputChange}\n                required\n                rows={4}\n                style={{\n                  width: '100%',\n                  padding: '10px 14px',\n                  border: '1px solid #e8d5c4',\n                  borderRadius: '8px',\n                  fontSize: '14px',\n                  outline: 'none',\n                  fontFamily: 'inherit',\n                  resize: 'vertical'\n                }}\n              />\n            </div>\n\n            {/* Pricing Section */}\n            <div style={{\n              background: 'rgba(193, 154, 107, 0.05)',\n              borderRadius: '8px',\n              padding: '16px',\n              border: '1px solid #e8d5c4'\n            }}>\n              <h4 style={{ fontSize: '14px', fontWeight: '600', color: '#333', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>\n                <i className=\"fas fa-tags\" style={{ color: '#c19a6b' }}></i>\n                Pricing\n              </h4>\n              <div className=\"product-form-grid\" style={{\n                display: 'grid',\n                gridTemplateColumns: '1fr 1fr 1fr',\n                gap: '20px'\n              }}>\n                <div>\n                  <label style={{\n                    display: 'block',\n                    fontSize: '13px',\n                    fontWeight: '600',\n                    color: '#666',\n                    marginBottom: '8px'\n                  }}>\n                    Current Price (₹) *\n                  </label>\n                  <input\n                    type=\"number\"\n                    name=\"price\"\n                    value={formData.price}\n                    onChange={handleInputChange}\n                    required\n                    min=\"0\"\n                    step=\"0.01\"\n                    style={{\n                      width: '100%',\n                      padding: '10px 14px',\n                      border: '1px solid #e8d5c4',\n                      borderRadius: '8px',\n                      fontSize: '14px',\n                      outline: 'none'\n                    }}\n                  />\n                  <p style={{ fontSize: '11px', color: '#999', marginTop: '4px' }}>The primary price used</p>\n                </div>\n\n                <div>\n                  <label style={{\n                    display: 'block',\n                    fontSize: '13px',\n                    fontWeight: '600',\n                    color: '#666',\n                    marginBottom: '8px'\n                  }}>\n                    Original Price (₹)\n                  </label>\n                  <input\n                    type=\"number\"\n                    name=\"original_price\"\n                    value={formData.original_price}\n                    onChange={handleInputChange}\n                    min=\"0\"\n                    step=\"0.01\"\n                    placeholder=\"Full retail price\"\n                    style={{\n                      width: '100%',\n                      padding: '10px 14px',\n                      border: '1px solid #e8d5c4',\n                      borderRadius: '8px',\n                      fontSize: '14px',\n                      outline: 'none'\n                    }}\n                  />\n                  <p style={{ fontSize: '11px', color: '#999', marginTop: '4px' }}>Shown as strikethrough price</p>\n                </div>\n\n                <div>\n                  <label style={{\n                    display: 'block',\n                    fontSize: '13px',\n                    fontWeight: '600',\n                    color: '#666',\n                    marginBottom: '8px'\n                  }}>\n                    Sale Price (₹)\n                  </label>\n                  <input\n                    type=\"number\"\n                    name=\"sale_price\"\n                    value={formData.sale_price}\n                    onChange={handleInputChange}\n                    min=\"0\"\n                    step=\"0.01\"\n                    placeholder=\"Discounted price\"\n                    style={{\n                      width: '100%',\n                      padding: '10px 14px',\n                      border: '1px solid #e8d5c4',\n                      borderRadius: '8px',\n                      fontSize: '14px',\n                      outline: 'none'\n                    }}\n                  />\n                  <p style={{ fontSize: '11px', color: '#999', marginTop: '4px' }}>Displayed price (falls back to Current Price)</p>\n                </div>\n              </div>\n              {formData.original_price && formData.sale_price && parseFloat(formData.original_price) > parseFloat(formData.sale_price) && (\n                <div style={{\n                  marginTop: '12px',\n                  padding: '8px 12px',\n                  background: 'rgba(231, 76, 60, 0.1)',\n                  borderRadius: '6px',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '8px'\n                }}>\n                  <i className=\"fas fa-percent\" style={{ color: '#e74c3c' }}></i>\n                  <span style={{ fontSize: '13px', color: '#e74c3c', fontWeight: '600' }}>\n                    Discount: {Math.round(((parseFloat(formData.original_price) - parseFloat(formData.sale_price)) / parseFloat(formData.original_price)) * 100)}% OFF\n                  </span>\n                </div>\n              )}\n            </div>\n\n            {/* Stock and Category */}\n            <div className=\"product-form-grid\" style={{\n              display: 'grid',\n              gridTemplateColumns: '1fr 1fr',\n              gap: '20px'\n            }}>\n              <div>\n                <label style={{\n                  display: 'block',\n                  fontSize: '13px',\n                  fontWeight: '600',\n                  color: '#666',\n                  marginBottom: '8px'\n                }}>\n                  Stock Quantity\n                </label>\n                <input\n                  type=\"number\"\n                  name=\"stock_quantity\"\n                  value={formData.stock_quantity}\n                  onChange={handleInputChange}\n                  min=\"0\"\n                  style={{\n                    width: '100%',\n                    padding: '10px 14px',\n                    border: '1px solid #e8d5c4',\n                    borderRadius: '8px',\n                    fontSize: '14px',\n                    outline: 'none'\n                  }}\n                />\n              </div>\n\n              <div>\n                <label style={{\n                  display: 'block',\n                  fontSize: '13px',\n                  fontWeight: '600',\n                  color: '#666',\n                  marginBottom: '8px'\n                }}>\n                  Category\n                </label>\n                <select\n                  name=\"category\"\n                  value={formData.category}\n                  onChange={handleInputChange}\n                  style={{\n                    width: '100%',\n                    padding: '10px 14px',\n                    border: '1px solid #e8d5c4',\n                    borderRadius: '8px',\n                    fontSize: '14px',\n                    outline: 'none',\n                    cursor: 'pointer',\n                    background: 'white'\n                  }}\n                >\n                  <option value=\"\">Select category</option>\n                  <option value=\"Living Room\">Living Room</option>\n                  <option value=\"Dining Room\">Dining Room</option>\n                  <option value=\"Bedroom\">Bedroom</option>\n                  <option value=\"Office\">Office</option>\n                </select>\n              </div>\n            </div>\n\n            {/* Submit Button */}\n            <div style={{ display: 'flex', justifyContent: 'flex-end', paddingTop: '12px' }}>\n              <button\n                type=\"submit\"\n                disabled={saving}\n                style={{\n                  padding: '10px 32px',\n                  background: saving ? '#999' : 'linear-gradient(135deg, #c19a6b, #a67c52)',\n                  color: 'white',\n                  border: 'none',\n                  borderRadius: '8px',\n                  fontSize: '14px',\n                  fontWeight: '600',\n                  cursor: saving ? 'not-allowed' : 'pointer',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: '8px',\n                  transition: 'all 0.2s ease',\n                  boxShadow: '0 2px 8px rgba(193, 154, 107, 0.2)'\n                }}\n              >\n                {saving ? (\n                  <>\n                    <div style={{\n                      width: '16px',\n                      height: '16px',\n                      border: '2px solid #ffffff',\n                      borderTop: '2px solid transparent',\n                      borderRadius: '50%',\n                      animation: 'spin 0.8s linear infinite'\n                    }}></div>\n                    {productId === 'new' ? 'Creating...' : 'Saving...'}\n                  </>\n                ) : (\n                  <>\n                    <i className={productId === 'new' ? 'fas fa-plus' : 'fas fa-save'}></i>\n                    {productId === 'new' ? 'Create Product' : 'Save Changes'}\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n\n      {/* Product Images */}\n      {product && (\n        <div style={{\n          background: 'white',\n          borderRadius: '12px',\n          padding: '24px',\n          boxShadow: '0 4px 12px rgba(193, 154, 107, 0.08)',\n          border: '1px solid #e8d5c4'\n        }}>\n          <ProductImageManager\n            productId={product.id}\n            images={product.images}\n            onImagesChange={loadProduct}\n          />\n        </div>\n      )}\n    </DashboardLayout>\n    </>\n  );\n}\n"],"names":["React","useState","useEffect","useRouter","useAuth","DashboardLayout","ProductImageManager","ProductImage","id","url","cloudflare_image_id","is_primary","display_order","Product","name","description","price","original_price","sale_price","category","stock_quantity","images","primary_image","EditProductPage","params","Promise","router","user","product","setProduct","loadingProduct","setLoadingProduct","saving","setSaving","error","setError","successMessage","setSuccessMessage","productId","setProductId","formData","setFormData","then","p","push","role","loadProduct","response","fetch","data","json","success","toString","err","console","message","handleInputChange","e","ChangeEvent","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","target","value","handleSubmit","FormEvent","preventDefault","isNewProduct","method","headers","body","JSON","stringify","parseFloat","parseInt","setTimeout","handleDelete","confirm","minHeight","display","alignItems","justifyContent","background","textAlign","width","height","border","borderTop","borderRadius","animation","margin","marginTop","color","fontSize","padding","boxShadow","marginBottom","fontWeight","cursor","gap","transition","currentTarget","style","flexDirection","outline","fontFamily","resize","gridTemplateColumns","Math","round","paddingTop"],"mappings":"4ZAEe,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,0SAA4S,EACzU,yEACA,8DAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,sRAAwR,EACrT,qDACA","ignoreList":[0]}