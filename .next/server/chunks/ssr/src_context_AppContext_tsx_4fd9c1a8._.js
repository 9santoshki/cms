module.exports=[44394,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(19032),e=a.i(21868);let f={user:null,token:null,products:[],cartItems:[],orders:[],appointments:[],loading:{products:!1,cart:!1,orders:!1,appointments:!1,auth:!1,user:!1},error:{products:null,cart:null,orders:null,appointments:null,auth:null,user:null}},g="SET_USER",h="SET_TOKEN",i="SET_PRODUCTS",j="SET_CART_ITEMS",k="SET_ORDERS",l="SET_APPOINTMENTS",m="SET_LOADING",n="SET_ERROR",o="ADD_TO_CART",p="REMOVE_FROM_CART",q="UPDATE_CART_ITEM",r="CLEAR_CART",s="ADD_ORDER",t=(a,b)=>{switch(b.type){case g:return{...a,user:b.payload};case h:return{...a,token:b.payload};case i:return{...a,products:b.payload};case j:return{...a,cartItems:b.payload};case k:return{...a,orders:b.payload};case l:return{...a,appointments:b.payload};case m:return{...a,loading:{...a.loading,[b.payload.type]:b.payload.value}};case n:return{...a,error:{...a.error,[b.payload.type]:b.payload.value}};case o:let c;return c=a.cartItems.find(a=>a.product_id===b.payload.product_id)?a.cartItems.map(a=>a.product_id===b.payload.product_id?b.payload:a):[...a.cartItems,b.payload],{...a,cartItems:c};case q:return{...a,cartItems:a.cartItems.map(a=>a.product_id===b.payload.product_id?{...a,quantity:b.payload.quantity}:a)};case p:return{...a,cartItems:a.cartItems.filter(a=>a.product_id!==b.payload)};case r:return{...a,cartItems:[]};case s:return{...a,orders:[b.payload,...a.orders]};default:return a}},u=(0,c.createContext)(void 0);a.s(["AppContext",0,u,"AppProvider",0,({children:v})=>{let[w,x]=(0,c.useReducer)(t,f),y=(0,c.useRef)(null);console.log("ðŸ”„ AppContext initializing..."),(0,c.useEffect)(()=>{let a=!0;(async()=>{try{let b=await (0,e.getCurrentUser)();if(a&&b){let c=await (0,e.getUserProfile)();if(c){let d={id:c.id,name:b.user_metadata?.full_name||b.user_metadata?.name||b.email?.split("@")[0]||"User",email:b.email,avatar:b.user_metadata?.avatar||b.user_metadata?.picture||null,role:c.role,created_at:b.created_at};a&&(x({type:g,payload:d}),localStorage.setItem("user",JSON.stringify(d)),console.log("âœ… User restored from Supabase session:",d))}else{let c={id:b.id,name:b.user_metadata?.full_name||b.user_metadata?.name||b.email?.split("@")[0]||"User",email:b.email,avatar:b.user_metadata?.avatar||b.user_metadata?.picture||null,role:"customer",created_at:b.created_at};a&&(x({type:g,payload:c}),localStorage.setItem("user",JSON.stringify(c)),console.log("âœ… User restored from Supabase session (fallback):",c))}}else a&&(localStorage.removeItem("user"),console.log("âŒ No user in Supabase session, cleared user data"))}catch(b){console.error("Error initializing auth with Supabase:",b),a&&(localStorage.removeItem("user"),x({type:g,payload:null}))}})();let b=(0,e.onAuthStateChange)(async(b,c)=>{if(console.log("ðŸ” Auth state changed:",b),a&&"SIGNED_IN"===b&&c?.user){let a=await (0,e.getUserProfile)();if(a){let b={id:a.id,name:c.user.user_metadata?.full_name||c.user.user_metadata?.name||c.user.email?.split("@")[0]||"User",email:c.user.email,avatar:c.user.user_metadata?.avatar||c.user.user_metadata?.picture||null,role:a.role,created_at:c.user.created_at};x({type:g,payload:b}),localStorage.setItem("user",JSON.stringify(b)),console.log("âœ… User set after sign in:",b)}else{let a={id:c.user.id,name:c.user.user_metadata?.full_name||c.user.user_metadata?.name||c.user.email?.split("@")[0]||"User",email:c.user.email,avatar:c.user.user_metadata?.avatar||c.user.user_metadata?.picture||null,role:"customer",created_at:c.user.created_at};x({type:g,payload:a}),localStorage.setItem("user",JSON.stringify(a)),console.log("âœ… User set after sign in (fallback):",a)}}else a&&"SIGNED_OUT"===b&&(localStorage.removeItem("user"),localStorage.removeItem("cartItems"),x({type:g,payload:null}),x({type:j,payload:[]}),console.log("âœ… User cleared after sign out"))});return()=>{a=!1,b&&b()}},[]);let z=async()=>{if(!w.user){x({type:j,payload:[]}),a.A(12974).then(a=>{a.useCartStore.getState().clearCart()});return}C("cart",!0),D("cart",null);try{let b=await d.apiClient.getCartItems();b.success&&b.data?(x({type:j,payload:b.data}),a.A(12974).then(a=>{a.useCartStore.getState().clearCart(),b.data.forEach(b=>{a.useCartStore.getState().addItem(b)})})):(console.warn("No cart items found for user:",b.error),x({type:j,payload:[]}),a.A(12974).then(a=>{a.useCartStore.getState().clearCart()}))}catch(b){console.error("Error fetching cart items:",b),D("cart",b.message||"Failed to load cart items. Please try again later."),x({type:j,payload:[]}),a.A(12974).then(a=>{a.useCartStore.getState().clearCart()})}finally{C("cart",!1)}};(0,c.useEffect)(()=>{w.user?z():x({type:j,payload:[]})},[w.user]),(0,c.useEffect)(()=>{a.A(12974).then(a=>{let{items:b}=a.useCartStore.getState();0===b.length&&w.cartItems.length>0?w.cartItems.forEach(b=>{a.useCartStore.getState().addItem(b)}):b.length>0&&0===w.cartItems.length&&x({type:j,payload:b})})},[w.cartItems]),(0,c.useEffect)(()=>{w.user||localStorage.setItem("cartItems",JSON.stringify(w.cartItems))},[w.cartItems,w.user]);let A=a=>{x({type:g,payload:a}),a?localStorage.setItem("user",JSON.stringify(a)):localStorage.removeItem("user")},B=a=>{x({type:h,payload:a}),a?localStorage.setItem("token",a):localStorage.removeItem("token")},C=(a,b)=>{x({type:m,payload:{type:a,value:b}})},D=(a,b)=>{x({type:n,payload:{type:a,value:b}})},E=async()=>{if(!w.loading.products){C("products",!0),D("products",null);try{let a=await d.apiClient.getProducts();if(a.success&&a.data){let b=(Array.isArray(a.data)?a.data:a.data?.products||[]).map(a=>({...a,price:"number"==typeof a.price?a.price:parseFloat(a.price),image_url:a.image_url&&(a.image_url.startsWith("http")||a.image_url.startsWith("/"))?a.image_url:void 0,imageClass:(a=>{if(!a)return"modern";let b=a.toLowerCase();if(b.includes("modern")||b.includes("coffee")||b.includes("sofa"))return"modern";if(b.includes("classic")||b.includes("armchair"))return"classic";if(b.includes("vintage")||b.includes("lamp"))return"coastal";if(b.includes("dining")||b.includes("dresser"))return"office";if(b.includes("wall")||b.includes("art"))return"hotel";else if(b.includes("rug"))return"restaurant";else return"modern"})(a.image_url)||a.imageClass||"modern"}));x({type:i,payload:b})}else throw Error(a.error||"Failed to load products")}catch(a){console.error("Error fetching products:",a),D("products",a.message||"Failed to load products. Please try again later.")}finally{C("products",!1)}}},F=new Set,G=async(b,c=1)=>{if(!F.has(b.id))if(w.user){F.add(b.id),C("cart",!0),D("cart",null);try{let e=await d.apiClient.addToCart(b.id,c);if(e.success&&e.data)x({type:o,payload:e.data}),a.A(12974).then(a=>{a.useCartStore.getState().addItem(e.data)});else throw Error(e.error||"Failed to add item to cart")}catch(a){console.error("Error adding to cart:",a),D("cart",a.message||"Failed to add item to cart. Please try again.")}finally{F.delete(b.id),C("cart",!1)}}else{let d={id:Date.now(),product_id:b.id,quantity:c,name:b.name,price:b.price,image_url:b.image_url};a.A(12974).then(a=>{a.useCartStore.getState().addItem(d)})}},H=async(b,c)=>{if(!b||"number"!=typeof b||b<=0)return void console.error("Invalid product ID provided to updateCartItem:",b);if(w.user){C("cart",!0),D("cart",null);try{let e=await d.apiClient.updateCartItem(b,c);if(e.success&&e.data)x({type:o,payload:e.data}),a.A(12974).then(a=>{a.useCartStore.getState().updateItem(product_id,c)});else if(c<=0&&e.success)x({type:p,payload:product_id}),a.A(12974).then(a=>{a.useCartStore.getState().removeItem(product_id)});else throw Error(e.error||"Failed to update cart item")}catch(a){console.error("Error updating cart item:",a),D("cart",a.message||"Failed to update cart item. Please try again.")}finally{C("cart",!1)}}else{c<=0?(x({type:p,payload:b}),a.A(12974).then(a=>{a.useCartStore.getState().removeItem(b)})):(x({type:q,payload:{product_id:b,quantity:c}}),a.A(12974).then(a=>{a.useCartStore.getState().updateItem(b,c)}));let d=JSON.parse(localStorage.getItem("cartItems")||"[]"),e=d.findIndex(a=>a.product_id===b);if(-1!==e)c<=0?d.splice(e,1):d[e].quantity=c;else if(c>0){let a=w.products.find(a=>a.id===b);a&&d.push({id:a.id,product_id:a.id,name:a.name,price:a.price,quantity:c,image_url:a.image_url,user_id:null})}localStorage.setItem("cartItems",JSON.stringify(d))}},I=async b=>{if(!b||"number"!=typeof b||b<=0)return void console.error("Invalid product ID provided to removeFromCart:",b);if(w.user){C("cart",!0),D("cart",null);try{let c=await d.apiClient.removeFromCart(b);if(c.success)x({type:p,payload:b}),a.A(12974).then(a=>{a.useCartStore.getState().removeItem(b)});else throw Error(c.error||"Failed to remove item from cart")}catch(a){console.error("Error removing from cart:",a),D("cart",a.message||"Failed to remove item from cart. Please try again.")}finally{C("cart",!1)}}else{x({type:p,payload:b}),a.A(12974).then(a=>{a.useCartStore.getState().removeItem(b)});let c=JSON.parse(localStorage.getItem("cartItems")||"[]").filter(a=>a.product_id!==b);localStorage.setItem("cartItems",JSON.stringify(c))}},J=async()=>{if(w.user){C("cart",!0),D("cart",null);try{let b=await d.apiClient.clearCart();if(b.success)x({type:r}),a.A(12974).then(a=>{a.useCartStore.getState().clearCart()});else throw Error(b.error||"Failed to clear cart")}catch(a){console.error("Error clearing cart:",a),D("cart",a.message||"Failed to clear cart. Please try again.")}finally{C("cart",!1)}}else x({type:r}),a.A(12974).then(a=>{a.useCartStore.getState().clearCart()}),localStorage.removeItem("cartItems")},K=async()=>{if(w.user){C("orders",!0),D("orders",null);try{let a=await d.apiClient.getOrders();if(a.success&&a.data)x({type:k,payload:a.data});else throw Error(a.error||"Failed to load orders")}catch(a){console.error("Error fetching orders:",a),D("orders",a.message||"Failed to load orders. Please try again later.")}finally{C("orders",!1)}}},L=async a=>{if(w.user){C("orders",!0),D("orders",null);try{let b=await d.apiClient.createOrder(a);if(b.success&&b.data)return x({type:s,payload:b.data}),x({type:r}),b.data;throw Error(b.error||"Failed to create order")}catch(a){throw console.error("Error creating order:",a),a.message&&a.message.includes("Validation Error")?D("orders","Please check your order details and try again."):D("orders",a.message||"Failed to create order. Please try again."),a}finally{C("orders",!1)}}},M=async()=>{if(w.user){C("user",!0),D("user",null);try{let a=await fetch("/api/profile",{headers:{Authorization:`Bearer ${w.token}`}}),b=await a.json();if(b.success&&b.data)return A(b.data),b.data;if(w.user)return w.user;throw Error(b.error||"Failed to fetch user profile")}catch(a){if(console.error("Error fetching user profile:",a),w.user)return w.user;throw D("user",a.message||"Failed to fetch user profile. Please try again later."),a}finally{C("user",!1)}}},N=async a=>{if(w.user){C("user",!0),D("user",null);try{let b=await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w.token}`},body:JSON.stringify(a)}),c=await b.json();if(c.success&&c.data)return A(c.data),c.data;throw Error(c.error||"Failed to update profile")}catch(a){throw console.error("Error updating profile:",a),D("user",a.message||"Failed to update profile. Please try again."),a}finally{C("user",!1)}}},O=async a=>{throw Error("Email/password login is not supported. Please use Google OAuth.")},P=async a=>{throw Error("Email/password registration is not supported. Please use Google OAuth.")},Q=async()=>{try{y.current=[...w.cartItems],localStorage.removeItem("cartItems"),A(null),B(null),localStorage.removeItem("user"),localStorage.removeItem("token"),x({type:r}),x({type:k,payload:[]});try{let{createClient:b}=await a.A(96707),c=b(),{error:d}=await c.auth.signOut();d&&console.error("Supabase sign out error:",d)}catch(a){console.error("Error with main Supabase sign out:",a)}try{let{signOut:b}=await a.A(73784);await b()}catch(a){console.warn("Additional signOut failed (this is ok):",a)}try{let{apiClient:b}=await a.A(78630);b.setToken(null)}catch(a){console.warn("Error resetting API client token:",a)}await new Promise(a=>setTimeout(a,300))}catch(a){console.error("Error during logout:",a)}},R=async a=>{if(w.user){C("products",!0),D("products",null);try{let b=await d.apiClient.createProduct(a);if(b.success&&b.data)return x({type:i,payload:[...w.products,b.data]}),b.data;throw Error(b.error||"Failed to create product")}catch(a){throw console.error("Error creating product:",a),D("products",a.message||"Failed to create product. Please try again."),a}finally{C("products",!1)}}},S=async(a,b)=>{if(w.user){C("products",!0),D("products",null);try{let c=await d.apiClient.updateProduct(a,b);if(c.success&&c.data){let b=w.products.map(b=>b.id===a?c.data:b);return x({type:i,payload:b}),c.data}throw Error(c.error||"Failed to update product")}catch(a){throw console.error("Error updating product:",a),D("products",a.message||"Failed to update product. Please try again."),a}finally{C("products",!1)}}},T=async a=>{C("products",!0),D("products",null);try{let b=await d.apiClient.getProductBySlug(a);if(b.success&&b.data){let c={...b.data,slug:b.data.slug||a},d=[...w.products],e=d.findIndex(a=>a.id===c.id);return -1!==e?d[e]=c:d.push(c),x({type:i,payload:d}),c}throw Error(b.error||"Failed to fetch product")}catch(a){throw console.error("Error fetching product by slug:",a),D("products",a.message||"Failed to fetch product. Please try again."),a}finally{C("products",!1)}},U=async a=>{C("products",!0),D("products",null);try{let b=await d.apiClient.searchProducts(a);if(b.success&&b.data){let a=(Array.isArray(b.data)?b.data:b.data?.products||[]).map(a=>({...a,price:"number"==typeof a.price?a.price:parseFloat(a.price),image_url:a.image_url&&(a.image_url.startsWith("http")||a.image_url.startsWith("/"))?a.image_url:void 0,imageClass:(a=>{if(!a)return"modern";let b=a.toLowerCase();if(b.includes("modern")||b.includes("coffee")||b.includes("sofa"))return"modern";if(b.includes("classic")||b.includes("armchair"))return"classic";if(b.includes("vintage")||b.includes("lamp"))return"coastal";if(b.includes("dining")||b.includes("dresser"))return"office";if(b.includes("wall")||b.includes("art"))return"hotel";else if(b.includes("rug"))return"restaurant";else return"modern"})(a.image_url)||a.imageClass||"modern"}));if(x({type:i,payload:a}),b.data.pagination)return{products:a,pagination:b.data.pagination,filters:b.data.filters};return a}throw Error(b.error||"Failed to search products")}catch(a){throw console.error("Error searching products:",a),D("products",a.message||"Failed to search products. Please try again."),a}finally{C("products",!1)}},V=async()=>{if(!w.user)return!1;try{if((await d.apiClient.getOrders()).success)return!0;throw Error("Token verification failed")}catch(a){return console.error("Token verification failed:",a),Q(),!1}},W=async a=>{if(w.user){C("appointments",!0),D("appointments",null);try{let b=await d.apiClient.getAppointments(a);if(b.success&&b.data)return x({type:l,payload:b.data.appointments}),b.data;throw Error(b.error||"Failed to fetch appointments")}catch(a){throw console.error("Error fetching appointments:",a),D("appointments",a.message||"Failed to fetch appointments. Please try again."),a}finally{C("appointments",!1)}}},X=async a=>{if(w.user)try{let b=await d.apiClient.createAppointment(a);if(b.success&&b.data)return await W(),b.data;throw Error(b.error||"Failed to create appointment")}catch(a){throw console.error("Error creating appointment:",a),a}},Y=async(a,b)=>{if(w.user)try{let c=await d.apiClient.updateAppointment(a,b);if(c.success&&c.data)return await W(),c.data;throw Error(c.error||"Failed to update appointment")}catch(a){throw console.error("Error updating appointment:",a),a}},Z={...w,setUser:A,setToken:B,setLoading:C,setError:D,fetchProducts:E,fetchCartItems:z,addToCart:G,updateCartItem:H,removeFromCart:I,clearCart:J,fetchOrders:K,createOrder:L,fetchAppointments:W,createAppointment:X,updateAppointment:Y,login:O,register:P,logout:Q,verifyToken:V,fetchUserProfile:M,updateUserProfile:N,createProduct:R,updateProduct:S,fetchProductBySlug:T,searchProducts:U,addToCartWithAuth:(a,b=1)=>w.user?{success:!0,requiresLogin:!1,product:a,quantity:b,action:()=>G(a,b)}:{success:!1,requiresLogin:!0,product:a,quantity:b},clearPendingCartAction:()=>{localStorage.removeItem("pendingCartAction")}};return(0,b.jsx)(u.Provider,{value:Z,children:v})},"useAppContext",0,()=>{let a=(0,c.useContext)(u);if(!a)throw Error("useAppContext must be used within an AppProvider");return a}])}];

//# sourceMappingURL=src_context_AppContext_tsx_4fd9c1a8._.js.map