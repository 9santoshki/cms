{"version":3,"sources":["turbopack:///[project]/src/app/checkout/page.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/src/app/checkout/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/checkout/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/checkout/page.tsx\",\n    \"default\",\n);\n","'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAppContext } from '@/context/AppContext';\nimport { useCartStore } from '@/store/cartStore';\nimport { apiClient } from '@/lib/api';\nimport Header from '@/components/Header';\nimport Footer from '@/components/Footer';\n\nconst CheckoutPage = () => {\n  const router = useRouter();\n  const { user } = useAppContext();\n  const [cartItems] = useCartStore(state => [state.items, state.getTotalPrice()]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [shippingAddress, setShippingAddress] = useState({\n    name: user?.name || '',\n    email: user?.email || '',\n    phone: '',\n    address: '',\n    city: '',\n    state: '',\n    zipCode: '',\n    country: 'India'\n  });\n\n  // Check if user is logged in\n  useEffect(() => {\n    if (!user) {\n      router.push('/auth?redirect=/checkout');\n    }\n  }, [user, router]);\n\n  // Update shipping address when user data becomes available\n  useEffect(() => {\n    if (user) {\n      setShippingAddress(prev => ({\n        ...prev,\n        name: user.name || prev.name,\n        email: user.email || prev.email\n      }));\n    }\n  }, [user]);\n\n  // Handle input changes for shipping address\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const { name, value } = e.target;\n    setShippingAddress(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  // Handle form submission\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError(null);\n\n    try {\n      // Verify cart is not empty\n      if (cartItems.length === 0) {\n        throw new Error('Cannot checkout with an empty cart');\n      }\n\n      // Create checkout session with Razorpay\n      const response = await apiClient.createCheckoutSession({\n        items: cartItems.map(item => ({\n          product_id: item.product_id,\n          quantity: item.quantity,\n          price: typeof item.price === 'number' ? item.price : parseFloat(item.price || '0'), // Ensure price is a number\n          name: item.name\n        })),\n        shipping_address\n      });\n\n      if (!response.success || !response.data) {\n        throw new Error(response.error || 'Failed to create checkout session');\n      }\n\n      const checkoutResult = response;\n\n      // Initialize Razorpay checkout\n      const options = {\n        key: process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID!, // Should be in environment variables\n        amount: result.data.amount, // Amount in paise\n        currency: result.data.currency,\n        name: 'Colour My Space',\n        description: 'Furniture Purchase',\n        order_id: result.data.razorpay_order_id,\n        handler: async (response: any) => {\n          try {\n            // Verify payment with our backend after successful payment\n            const verifyResponse = await apiClient.verifyPayment({\n              razorpay_order_id: response.razorpay_order_id,\n              razorpay_payment_id: response.razorpay_payment_id,\n              razorpay_signature: response.razorpay_signature\n            });\n\n            if (!verifyResponse.success || !verifyResponse.data) {\n              throw new Error(verifyResponse.error || 'Payment verification failed');\n            }\n\n            const verifyResult = verifyResponse;\n\n            if (verifyResponse.success && verifyResponse.data) {\n              // Payment successful - clear cart and redirect to success page\n              import('@/store/cartStore').then((module) => {\n                module.useCartStore.getState().clearCart();\n              });\n              router.push(`/checkout/success?orderId=${verifyResponse.data.order_id}`);\n            } else {\n              setError('Payment verification failed. Please contact support.');\n            }\n          } catch (verifyError) {\n            console.error('Payment verification error:', verifyError);\n            setError('Payment verification failed. Please contact support.');\n          }\n        },\n        prefill: {\n          name: shippingAddress.name,\n          email: shippingAddress.email,\n          contact: shippingAddress.phone\n        },\n        theme: {\n          color: '#F59E0B' // Amber color to match our theme\n        }\n      };\n\n      // Load Razorpay checkout\n      const script = document.createElement('script');\n      script.src = 'https://checkout.razorpay.com/v1/checkout.js';\n      script.onload = () => {\n        // @ts-ignore - Razorpay checkout is added to window by the script\n        const rzp = new window.Razorpay(options);\n        rzp.open();\n      };\n      script.onerror = () => {\n        setError('Failed to load payment gateway. Please try again.');\n        setLoading(false);\n      };\n      document.body.appendChild(script);\n    } catch (err: any) {\n      console.error('Checkout error:', err);\n      setError(err.message || 'An error occurred during checkout');\n      setLoading(false);\n    }\n  };\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Redirecting to login...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Header activePage=\"checkout\" />\n\n      <div className=\"container mx-auto px-4 py-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-8\">Checkout</h1>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Shipping Information */}\n          <div className=\"lg:col-span-2\">\n            <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Shipping Information</h2>\n              \n              <form onSubmit={handleSubmit}>\n                <div className=\"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6\">\n                  <div className=\"sm:col-span-3\">\n                    <label htmlFor=\"name\" className=\"block text-sm font-medium text-gray-700\">\n                      Full name\n                    </label>\n                    <div className=\"mt-1\">\n                      <input\n                        type=\"text\"\n                        name=\"name\"\n                        id=\"name\"\n                        value={shippingAddress.name}\n                        onChange={handleInputChange}\n                        required\n                        className=\"py-2 px-3 block w-full shadow-sm focus:ring-amber-500 focus:border-amber-500 border-gray-300 rounded-md\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"sm:col-span-3\">\n                    <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n                      Email address\n                    </label>\n                    <div className=\"mt-1\">\n                      <input\n                        type=\"email\"\n                        name=\"email\"\n                        id=\"email\"\n                        value={shippingAddress.email}\n                        onChange={handleInputChange}\n                        required\n                        className=\"py-2 px-3 block w-full shadow-sm focus:ring-amber-500 focus:border-amber-500 border-gray-300 rounded-md\"\n                        readOnly={!!user?.email} // Make email field read-only if user is logged in with email\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"sm:col-span-3\">\n                    <label htmlFor=\"phone\" className=\"block text-sm font-medium text-gray-700\">\n                      Phone number\n                    </label>\n                    <div className=\"mt-1\">\n                      <input\n                        type=\"tel\"\n                        name=\"phone\"\n                        id=\"phone\"\n                        value={shippingAddress.phone}\n                        onChange={handleInputChange}\n                        required\n                        className=\"py-2 px-3 block w-full shadow-sm focus:ring-amber-500 focus:border-amber-500 border-gray-300 rounded-md\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"sm:col-span-6\">\n                    <label htmlFor=\"address\" className=\"block text-sm font-medium text-gray-700\">\n                      Address\n                    </label>\n                    <div className=\"mt-1\">\n                      <input\n                        type=\"text\"\n                        name=\"address\"\n                        id=\"address\"\n                        value={shippingAddress.address}\n                        onChange={handleInputChange}\n                        required\n                        className=\"py-2 px-3 block w-full shadow-sm focus:ring-amber-500 focus:border-amber-500 border-gray-300 rounded-md\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"sm:col-span-2\">\n                    <label htmlFor=\"city\" className=\"block text-sm font-medium text-gray-700\">\n                      City\n                    </label>\n                    <div className=\"mt-1\">\n                      <input\n                        type=\"text\"\n                        name=\"city\"\n                        id=\"city\"\n                        value={shippingAddress.city}\n                        onChange={handleInputChange}\n                        required\n                        className=\"py-2 px-3 block w-full shadow-sm focus:ring-amber-500 focus:border-amber-500 border-gray-300 rounded-md\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"sm:col-span-2\">\n                    <label htmlFor=\"state\" className=\"block text-sm font-medium text-gray-700\">\n                      State / Province\n                    </label>\n                    <div className=\"mt-1\">\n                      <input\n                        type=\"text\"\n                        name=\"state\"\n                        id=\"state\"\n                        value={shippingAddress.state}\n                        onChange={handleInputChange}\n                        required\n                        className=\"py-2 px-3 block w-full shadow-sm focus:ring-amber-500 focus:border-amber-500 border-gray-300 rounded-md\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"sm:col-span-2\">\n                    <label htmlFor=\"zipCode\" className=\"block text-sm font-medium text-gray-700\">\n                      ZIP / Postal code\n                    </label>\n                    <div className=\"mt-1\">\n                      <input\n                        type=\"text\"\n                        name=\"zipCode\"\n                        id=\"zipCode\"\n                        value={shippingAddress.zipCode}\n                        onChange={handleInputChange}\n                        required\n                        className=\"py-2 px-3 block w-full shadow-sm focus:ring-amber-500 focus:border-amber-500 border-gray-300 rounded-md\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"sm:col-span-6\">\n                    <label htmlFor=\"country\" className=\"block text-sm font-medium text-gray-700\">\n                      Country\n                    </label>\n                    <div className=\"mt-1\">\n                      <input\n                        type=\"text\"\n                        name=\"country\"\n                        id=\"country\"\n                        value={shippingAddress.country}\n                        onChange={handleInputChange}\n                        required\n                        className=\"py-2 px-3 block w-full shadow-sm focus:ring-amber-500 focus:border-amber-500 border-gray-300 rounded-md\"\n                        readOnly\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"mt-8 flex justify-end\">\n                  <button\n                    type=\"submit\"\n                    disabled={loading || cartItems.length === 0}\n                    className=\"ml-3 inline-flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 disabled:opacity-50\"\n                  >\n                    {loading ? (\n                      <span className=\"flex items-center\">\n                        <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                          <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                          <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                        </svg>\n                        Processing...\n                      </span>\n                    ) : (\n                      `Pay ₹${useCartStore.getState().getTotalPrice().toLocaleString()}`\n                    )}\n                  </button>\n                </div>\n\n                {error && (\n                  <div className=\"mt-4 p-4 bg-red-50 border border-red-200 text-red-700 rounded-md\">\n                    {error}\n                  </div>\n                )}\n              </form>\n            </div>\n          </div>\n\n          {/* Order Summary */}\n          <div className=\"lg:col-span-1\">\n            <div className=\"bg-white rounded-lg shadow-md p-6 sticky top-6\">\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Order Summary</h2>\n\n              <div className=\"flow-root\">\n                <ul className=\"-my-6 divide-y divide-gray-200\">\n                  {cartItems.map((item) => (\n                    <li key={item.id} className=\"py-6 flex\">\n                      <div className=\"h-24 w-24 flex-shrink-0 overflow-hidden rounded-md border border-gray-200\">\n                        {item.image_url ? (\n                          <img\n                            src={item.image_url}\n                            alt={item.name}\n                            className=\"h-full w-full object-cover object-center\"\n                          />\n                        ) : (\n                          <div className=\"h-full w-full bg-gray-200 flex items-center justify-center\">\n                            <span className=\"text-gray-500\">No Image</span>\n                          </div>\n                        )}\n                      </div>\n\n                      <div className=\"ml-4 flex flex-1 flex-col\">\n                        <div>\n                          <div className=\"flex justify-between text-base font-medium text-gray-900\">\n                            <h3>{item.name}</h3>\n                            <p className=\"ml-4\">₹{(typeof item.price === 'number' ? item.price : parseFloat(item.price || '0')).toLocaleString()}</p>\n                          </div>\n                          <p className=\"mt-1 text-sm text-gray-500\">{item.description}</p>\n                        </div>\n                        <div className=\"flex flex-1 items-end justify-between text-sm\">\n                          <p className=\"text-gray-500\">Qty: {item.quantity}</p>\n\n                          <p className=\"font-medium text-gray-900\">\n                            ₹{typeof item.price === 'number'\n                              ? (item.price * item.quantity).toLocaleString()\n                              : (parseFloat(item.price || '0') * item.quantity).toLocaleString()}\n                          </p>\n                        </div>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n\n              <div className=\"mt-6 space-y-3 border-t border-gray-200 pt-4\">\n                <div className=\"flex justify-between text-base font-medium text-gray-900\">\n                  <p>Subtotal</p>\n                  <p>₹{useCartStore.getState().getTotalPrice().toLocaleString()}</p>\n                </div>\n                <div className=\"flex justify-between text-base font-medium text-gray-900\">\n                  <p>Shipping</p>\n                  <p>Calculated at checkout</p>\n                </div>\n                <div className=\"flex justify-between text-base font-medium text-gray-900\">\n                  <p>Total</p>\n                  <p>₹{useCartStore.getState().getTotalPrice().toLocaleString()}</p>\n                </div>\n              </div>\n\n              <p className=\"mt-6 text-xs text-gray-500\">\n                After clicking \"Pay Now\", you will be redirected to Razorpay to complete your purchase securely.\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <Footer />\n    </div>\n  );\n};\n\nexport default CheckoutPage;"],"names":["React","useState","useEffect","useRouter","useAppContext","useCartStore","apiClient","Header","Footer","CheckoutPage","router","user","cartItems","state","items","getTotalPrice","loading","setLoading","error","setError","shippingAddress","setShippingAddress","name","email","phone","address","city","zipCode","country","push","prev","handleInputChange","e","ChangeEvent","HTMLInputElement","HTMLTextAreaElement","value","target","handleSubmit","FormEvent","preventDefault","length","Error","response","createCheckoutSession","map","item","product_id","quantity","price","parseFloat","shipping_address","success","data","checkoutResult","options","key","process","env","NEXT_PUBLIC_RAZORPAY_KEY_ID","amount","result","currency","description","order_id","razorpay_order_id","handler","verifyResponse","verifyPayment","razorpay_payment_id","razorpay_signature","verifyResult","then","module","getState","clearCart","verifyError","console","prefill","contact","theme","color","script","document","createElement","src","onload","rzp","window","Razorpay","open","onerror","body","appendChild","err","message","toLocaleString","id","image_url"],"mappings":"2UAEe,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,2RAA6R,EAC1T,0DACA,8DAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,uQAAyQ,EACtS,sCACA","ignoreList":[0]}