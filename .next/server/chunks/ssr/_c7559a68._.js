module.exports=[63933,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(74886);let e=(0,c.createContext)(void 0);a.s(["CartContext",0,e,"CartProvider",0,({children:a})=>{let{items:c,addItem:f,updateItem:g,removeItem:h,clearCart:i,getTotalItems:j,getTotalPrice:k}=(0,d.useCartStore)();return(0,b.jsx)(e.Provider,{value:{items:c,loading:!1,error:null,cartCount:j(),cartTotal:k(),addItem:f,updateItem:g,removeItem:h,clearCart:i},children:a})},"useCart",0,()=>{let a=(0,c.useContext)(e);if(void 0===a)throw Error("useCart must be used within a CartProvider");return a}])},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},56025,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=async()=>{let a=new URL("https://accounts.google.com/o/oauth2/v2/auth");a.searchParams.set("client_id","774770475031-c7nqt1nrj05ntj4h9h1a2co56o5peb2o.apps.googleusercontent.com"),a.searchParams.set("redirect_uri","http://localhost:3000/auth/callback"),a.searchParams.set("response_type","code"),a.searchParams.set("scope","openid email profile"),a.searchParams.set("access_type","offline"),a.searchParams.set("prompt","consent"),window.location.href=a.toString()},e=async()=>{try{if(!(await fetch("/api/auth/logout",{method:"POST",credentials:"include"})).ok)throw Error("Logout failed");return{success:!0}}catch(a){throw console.error("Error signing out:",a),a}},f=async()=>{try{let a=await fetch("/api/auth/session",{credentials:"include"});if(!a.ok)return{user:null};return{user:(await a.json()).user||null}}catch(a){return console.error("Error getting session:",a),{user:null}}},g=async()=>{let{user:a}=await f();return a},h={user:null,token:null,loading:!1,error:null};function i(a,b){switch(b.type){case"SET_USER":return{...a,user:b.payload};case"SET_TOKEN":return{...a,token:b.payload};case"SET_LOADING":return{...a,loading:b.payload};case"SET_ERROR":return{...a,error:b.payload};case"LOGOUT":return{...a,user:null,token:null};default:return a}}let j=(0,c.createContext)(void 0);a.s(["AuthContext",0,j,"AuthProvider",0,({children:k})=>{let[l,m]=(0,c.useReducer)(i,h),n=(0,c.useCallback)(a=>m({type:"SET_USER",payload:a}),[]),o=(0,c.useCallback)(a=>m({type:"SET_TOKEN",payload:a}),[]),p=(0,c.useCallback)(a=>m({type:"SET_LOADING",payload:a}),[]),q=(0,c.useCallback)(a=>m({type:"SET_ERROR",payload:a}),[]),r=(0,c.useCallback)(async()=>{m({type:"LOGOUT"});try{await e()}catch(a){}},[]),s=(0,c.useCallback)(async()=>{p(!0),q(null);try{await d()}catch(a){throw q(a?.message||"Google sign-in failed"),a}finally{p(!1)}},[p,q]);return(0,c.useEffect)(()=>{var b;let c,d,e;console.log("AuthContext: Setting up auth state change listener"),(async()=>{console.log("AuthContext: Checking current session on mount...");try{let b=await g();if(console.log("AuthContext: getCurrentUser result:",b),b){console.log("AuthContext: Current user found on mount:",b),n(b);try{let{useCartStore:b}=await a.A(12974);console.log("AuthContext: Loading cart from server..."),await b.getState().loadServerCart(),console.log("AuthContext: ✅ Cart loaded from server successfully")}catch(a){console.error("AuthContext: ❌ Error loading cart:",a)}}else console.log("AuthContext: No current user found on mount")}catch(a){console.error("AuthContext: Error checking current session:",a)}})(),console.log("AuthContext: Subscribing to auth state changes...");let h=(b=async(b,c)=>{if(console.log("AuthContext: Auth state changed event:",b,"Session:",c),"SIGNED_IN"===b){let b=c.user;if(!b)return;console.log("AuthContext: Processing SIGNED_IN event for user:",b),n(b),o(null);try{let{useCartStore:b}=await a.A(12974);console.log("AuthContext: Loading cart after sign in..."),await b.getState().loadServerCart(),console.log("AuthContext: ✅ Cart loaded from server after sign in")}catch(a){console.error("AuthContext: ❌ Error loading cart after sign in:",a)}}if("SIGNED_OUT"===b){console.log("AuthContext: Processing SIGNED_OUT event"),m({type:"LOGOUT"});try{let{useCartStore:b}=await a.A(12974);b.setState({items:[]}),console.log("AuthContext: ✅ Local cart state cleared after sign out (database cart preserved)")}catch(a){console.error("AuthContext: ❌ Error clearing cart after sign out:",a)}}if("USER_UPDATED"===b){console.log("AuthContext: Processing USER_UPDATED event");let a=c.user;if(!a)return;n(a)}},c=null,(d=async()=>{let{user:a}=await f();a&&!c?(c=a,b("SIGNED_IN",{user:a})):!a&&c?(c=null,b("SIGNED_OUT",{user:null})):a&&c&&a.id!==c.id&&(c=a,b("USER_UPDATED",{user:a}))})(),e=setInterval(d,2e3),{unsubscribe:()=>{clearInterval(e)}}),i=async()=>{console.log("AuthContext: Window focused, checking for cart updates...");try{if(await g()){let{useCartStore:b}=await a.A(12974);await b.getState().loadServerCart(),console.log("AuthContext: ✅ Cart reloaded on window focus")}}catch(a){console.error("AuthContext: ❌ Error reloading cart on focus:",a)}};return window.addEventListener("focus",i),()=>{console.log("AuthContext: Cleaning up auth subscription"),window.removeEventListener("focus",i),h.unsubscribe()}},[n,o]),(0,b.jsx)(j.Provider,{value:{...l,setUser:n,setToken:o,setLoading:p,setError:q,signInWithGoogle:s,logout:r},children:k})},"useAuth",0,()=>{let a=(0,c.useContext)(j);if(!a)throw Error("useAuth must be used within AuthProvider");return a}],56025)},74886,a=>{"use strict";let b,c,d,e,f;var g,h=a.i(72131);let i=a=>{let b,c=new Set,d=(a,d)=>{let e="function"==typeof a?a(b):a;if(!Object.is(e,b)){let a=b;b=(null!=d?d:"object"!=typeof e||null===e)?e:Object.assign({},b,e),c.forEach(c=>c(b,a))}},e=()=>b,f={setState:d,getState:e,getInitialState:()=>g,subscribe:a=>(c.add(a),()=>c.delete(a))},g=b=a(d,e,f);return f},j=a=>b=>{try{let c=a(b);if(c instanceof Promise)return c;return{then:a=>j(a)(c),catch(a){return this}}}catch(a){return{then(a){return this},catch:b=>j(b)(a)}}};async function k(){try{let a=await fetch("/api/auth/session"),b=await a.json();return!0===b.authenticated}catch(a){return!1}}async function l(a,b){try{if(!await k())return;b<=0?await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:a,quantity:0})}):await fetch("/api/cart",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:a,quantity:b})})}catch(a){console.error("Failed to sync cart with server:",a)}}let m=(e=(g=(b=(a,b)=>({items:[],isLoading:!1,addItem:async b=>{a(a=>{let c=a.items.findIndex(a=>a.product_id===b.product_id);if(!(c>=0))return{items:[...a.items,b]};{let d=[...a.items];return d[c]={...d[c],quantity:d[c].quantity+b.quantity},{items:d}}});try{if(await k()){let a=await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:b.product_id,quantity:b.quantity})}),c=await a.json();a.ok||console.error("Failed to save cart item to server:",c)}}catch(a){console.error("Failed to sync cart with server:",a)}},updateItem:async(b,c)=>{a(a=>c<=0?{items:a.items.filter(a=>a.product_id!==b)}:{items:a.items.map(a=>a.product_id===b?{...a,quantity:c}:a)}),await l(b,c)},removeItem:async b=>{a(a=>({items:a.items.filter(a=>a.product_id!==b)})),await l(b,0)},clearCart:async()=>{a({items:[]});try{await k()&&await fetch("/api/cart",{method:"DELETE"})}catch(a){console.error("Failed to clear server cart:",a)}},loadServerCart:async()=>{try{a({isLoading:!0});let c=await fetch("/api/cart"),d=await c.json();if(d.success&&d.data){let c=d.data,e=b().items,f=new Map(c.map(a=>[a.product_id,a])),g=[];for(let a of(c.forEach(a=>{let b=e.find(b=>b.product_id===a.product_id);b&&b.quantity>a.quantity?(g.push({...a,quantity:b.quantity}),a.product_id&&b.quantity&&l(a.product_id,b.quantity)):g.push(a)}),e))f.has(a.product_id)||(g.push(a),fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:a.product_id,quantity:a.quantity})}).catch(a=>console.error("Failed to sync local item:",a)));a({items:g,isLoading:!1})}else a({isLoading:!1})}catch(b){console.error("Failed to load server cart:",b),a({isLoading:!1})}},syncWithServer:async()=>{try{if(!await k())return;for(let a of b().items)await fetch("/api/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:a.product_id,quantity:a.quantity})})}catch(a){console.error("Failed to sync cart with server:",a)}},getTotalItems:()=>b().items.reduce((a,b)=>a+b.quantity,0),getTotalPrice:()=>b().items.reduce((a,b)=>a+b.price*b.quantity,0)}),c=(a,c,d)=>{let e=d.subscribe;return d.subscribe=(a,b,c)=>{let f=a;if(b){let e=(null==c?void 0:c.equalityFn)||Object.is,g=a(d.getState());f=c=>{let d=a(c);if(!e(g,d)){let a=g;b(g=d,a)}},(null==c?void 0:c.fireImmediately)&&b(g,g)}return e(f)},b(a,c,d)},d={name:"cart-storage",partialize:a=>({items:a.items})},(a,b,e)=>{let f,g={storage:function(a,b){let c;try{c=a()}catch(a){return}return{getItem:a=>{var b;let d=a=>null===a?null:JSON.parse(a,void 0),e=null!=(b=c.getItem(a))?b:null;return e instanceof Promise?e.then(d):d(e)},setItem:(a,b)=>c.setItem(a,JSON.stringify(b,void 0)),removeItem:a=>c.removeItem(a)}}(()=>localStorage),partialize:a=>a,version:0,merge:(a,b)=>({...b,...a}),...d},h=!1,i=new Set,k=new Set,l=g.storage;if(!l)return c((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${g.name}', the given storage is currently unavailable.`),a(...b)},b,e);let m=()=>{let a=g.partialize({...b()});return l.setItem(g.name,{state:a,version:g.version})},n=e.setState;e.setState=(a,b)=>(n(a,b),m());let o=c((...b)=>(a(...b),m()),b,e);e.getInitialState=()=>o;let p=()=>{var c,d;if(!l)return;h=!1,i.forEach(a=>{var c;return a(null!=(c=b())?c:o)});let e=(null==(d=g.onRehydrateStorage)?void 0:d.call(g,null!=(c=b())?c:o))||void 0;return j(l.getItem.bind(l))(g.name).then(a=>{if(a)if("number"!=typeof a.version||a.version===g.version)return[!1,a.state];else{if(g.migrate){let b=g.migrate(a.state,a.version);return b instanceof Promise?b.then(a=>[!0,a]):[!0,b]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(c=>{var d;let[e,h]=c;if(a(f=g.merge(h,null!=(d=b())?d:o),!0),e)return m()}).then(()=>{null==e||e(f,void 0),f=b(),h=!0,k.forEach(a=>a(f))}).catch(a=>{null==e||e(void 0,a)})};return e.persist={setOptions:a=>{g={...g,...a},a.storage&&(l=a.storage)},clearStorage:()=>{null==l||l.removeItem(g.name)},getOptions:()=>g,rehydrate:()=>p(),hasHydrated:()=>h,onHydrate:a=>(i.add(a),()=>{i.delete(a)}),onFinishHydration:a=>(k.add(a),()=>{k.delete(a)})},g.skipHydration||p(),f||o}))?i(g):i,Object.assign(f=a=>(function(a,b=a=>a){let c=h.default.useSyncExternalStore(a.subscribe,h.default.useCallback(()=>b(a.getState()),[a,b]),h.default.useCallback(()=>b(a.getInitialState()),[a,b]));return h.default.useDebugValue(c),c})(e,a),e),f);a.s(["useCartStore",0,m],74886)}];

//# sourceMappingURL=_c7559a68._.js.map