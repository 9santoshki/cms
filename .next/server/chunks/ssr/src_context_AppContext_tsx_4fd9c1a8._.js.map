{"version":3,"sources":["turbopack:///[project]/src/context/AppContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useReducer, useEffect, useRef } from 'react';\nimport { apiClient } from '@/lib/api';\nimport { User, Product, CartItem, Order, LoadingState, ErrorState, State } from '@/types';\nimport { getCurrentUser, onAuthStateChange, getUserProfile } from '@/lib/supabase/auth';\n\n// Action types\ninterface Action {\n  type: string;\n  payload?: any;\n}\n\n// Initial state\nconst initialState: State = {\n  user: null,\n  token: null,\n  products: [],\n  cartItems: [],\n  orders: [],\n  appointments: [],\n  loading: {\n    products: false,\n    cart: false,\n    orders: false,\n    appointments: false,\n    auth: false,\n    user: false\n  },\n  error: {\n    products: null,\n    cart: null,\n    orders: null,\n    appointments: null,\n    auth: null,\n    user: null\n  }\n};\n\n// Action types\nconst ACTIONS = {\n  SET_USER: 'SET_USER',\n  SET_TOKEN: 'SET_TOKEN',\n  SET_PRODUCTS: 'SET_PRODUCTS',\n  SET_CART_ITEMS: 'SET_CART_ITEMS',\n  SET_ORDERS: 'SET_ORDERS',\n  SET_APPOINTMENTS: 'SET_APPOINTMENTS',\n  SET_LOADING: 'SET_LOADING',\n  SET_ERROR: 'SET_ERROR',\n  ADD_TO_CART: 'ADD_TO_CART',\n  REMOVE_FROM_CART: 'REMOVE_FROM_CART',\n  UPDATE_CART_ITEM: 'UPDATE_CART_ITEM',\n  CLEAR_CART: 'CLEAR_CART',\n  ADD_ORDER: 'ADD_ORDER'\n};\n\n// Reducer\nconst appReducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case ACTIONS.SET_USER:\n      return {\n        ...state,\n        user: action.payload\n      };\n\n    case ACTIONS.SET_TOKEN:\n      return {\n        ...state,\n        token: action.payload\n      };\n\n    case ACTIONS.SET_PRODUCTS:\n      return {\n        ...state,\n        products: action.payload\n      };\n\n    case ACTIONS.SET_CART_ITEMS:\n      return {\n        ...state,\n        cartItems: action.payload\n      };\n\n    case ACTIONS.SET_ORDERS:\n      return {\n        ...state,\n        orders: action.payload\n      };\n\n    case ACTIONS.SET_APPOINTMENTS:\n      return {\n        ...state,\n        appointments: action.payload\n      };\n\n    case ACTIONS.SET_LOADING:\n      return {\n        ...state,\n        loading: {\n          ...state.loading,\n          [action.payload.type]: action.payload.value\n        },\n      };\n\n    case ACTIONS.SET_ERROR:\n      return {\n        ...state,\n        error: {\n          ...state.error,\n          [action.payload.type]: action.payload.value\n        }\n      };\n\n    case ACTIONS.ADD_TO_CART:\n      // The API response contains the final cart item with the updated quantity\n      // So we should update the existing item or add a new one\n      const existingItem = state.cartItems.find(item => item.product_id === action.payload.product_id);\n      let updatedCartItems: CartItem[];\n\n      if (existingItem) {\n        // Replace the existing item with the updated one from the API response\n        updatedCartItems = state.cartItems.map(item =>\n          item.product_id === action.payload.product_id ? action.payload : item\n        );\n      } else {\n        // Add the new item as returned by the API\n        updatedCartItems = [...state.cartItems, action.payload];\n      }\n\n      return {\n        ...state,\n        cartItems: updatedCartItems\n      };\n\n    case ACTIONS.UPDATE_CART_ITEM:\n      return {\n        ...state,\n        cartItems: state.cartItems.map(item =>\n          item.product_id === action.payload.product_id\n            ? { ...item, quantity: action.payload.quantity }\n            : item\n        )\n      };\n\n    case ACTIONS.REMOVE_FROM_CART:\n      return {\n        ...state,\n        cartItems: state.cartItems.filter(item => item.product_id !== action.payload)\n      };\n\n    case ACTIONS.CLEAR_CART:\n      return {\n        ...state,\n        cartItems: []\n      };\n\n    case ACTIONS.ADD_ORDER:\n      return {\n        ...state,\n        orders: [action.payload, ...state.orders]\n      };\n\n    default:\n      return state;\n  }\n};\n\n// Create context\nexport const AppContext = createContext<{\n  // State\n  user: User | null;\n  token: string | null;\n  products: Product[];\n  cartItems: CartItem[];\n  orders: Order[];\n  appointments: any[];\n  loading: LoadingState;\n  error: ErrorState;\n  // Actions\n  setUser: (user: User | null) => void;\n  setToken: (token: string | null) => void;\n  setLoading: (type: keyof LoadingState, value: boolean) => void;\n  setError: (type: keyof ErrorState, value: string | null) => void;\n  fetchProducts: () => Promise<void>;\n  fetchCartItems: () => Promise<void>;\n  addToCart: (product: Product, quantity?: number) => Promise<void>;\n  updateCartItem: (productId: number, quantity: number) => Promise<void>;\n  removeFromCart: (productId: number) => Promise<void>;\n  clearCart: () => Promise<void>;\n  fetchOrders: () => Promise<void>;\n  createOrder: (orderData: any) => Promise<any>;\n  login: (credentials: any) => Promise<any>;\n  register: (userData: any) => Promise<any>;\n  logout: () => void;\n  verifyToken: () => Promise<boolean>;\n  fetchUserProfile: () => Promise<any>;\n  updateUserProfile: (profileData: any) => Promise<any>;\n  createProduct: (productData: any) => Promise<any>;\n  updateProduct: (id: number, productData: any) => Promise<any>;\n  fetchProductBySlug: (slug: string) => Promise<Product>,\n  searchProducts: (params: {\n    q?: string;\n    search?: string;\n    category?: string;\n    minPrice?: number;\n    maxPrice?: number;\n    page?: number;\n    limit?: number;\n  }) => Promise<any>;\n  fetchAppointments: (filters?: {\n    status?: string;\n    date?: string;\n    page?: number;\n    limit?: number;\n  }) => Promise<any>;\n  createAppointment: (appointmentData: {\n    appointment_date: string;\n    notes?: string;\n  }) => Promise<any>;\n  updateAppointment: (id: string, updateData: {\n    status?: string;\n    notes?: string;\n  }) => Promise<any>;\n  addToCartWithAuth: (product: Product, quantity?: number) => {\n    success: boolean;\n    requiresLogin: boolean;\n    product?: Product;\n    quantity?: number;\n    action?: () => Promise<void>;\n  };\n  clearPendingCartAction: () => void;\n} | undefined>(undefined);\n\n// Provider component\ninterface AppProviderProps {\n  children: React.ReactNode;\n}\n\nexport const AppProvider: React.FC<AppProviderProps> = ({ children }) => {\n  const [state, dispatch] = useReducer(appReducer, initialState);\n  const tempSavedCart = useRef<CartItem[] | null>(null);\n\n  // DEBUG: Track initialization\n  console.log('ðŸ”„ AppContext initializing...');\n\n  // Load user from Supabase session on initial render\n  useEffect(() => {\n    let isMounted = true; // Flag to prevent state updates after unmount\n\n    const initializeAuth = async () => {\n      try {\n        const supabaseUser = await getCurrentUser();\n\n        if (isMounted && supabaseUser) {\n          // Get user profile from the profiles table\n          const userProfile = await getUserProfile();\n\n          if (userProfile) {\n            const userObject = {\n              id: userProfile.id,\n              name: supabaseUser.user_metadata?.full_name || supabaseUser.user_metadata?.name || supabaseUser.email?.split('@')[0] || 'User',\n              email: supabaseUser.email,\n              avatar: supabaseUser.user_metadata?.avatar || supabaseUser.user_metadata?.picture || null,\n              role: userProfile.role,\n              created_at: supabaseUser.created_at\n            };\n\n            if (isMounted) {\n              dispatch({ type: ACTIONS.SET_USER, payload: userObject });\n              localStorage.setItem('user', JSON.stringify(userObject));\n              console.log('âœ… User restored from Supabase session:', userObject);\n            }\n          } else {\n            // Fallback: use session data directly if profile fetch fails\n            const userObject = {\n              id: supabaseUser.id,\n              name: supabaseUser.user_metadata?.full_name || supabaseUser.user_metadata?.name || supabaseUser.email?.split('@')[0] || 'User',\n              email: supabaseUser.email,\n              avatar: supabaseUser.user_metadata?.avatar || supabaseUser.user_metadata?.picture || null,\n              role: 'customer', // Default role if profile doesn't exist yet\n              created_at: supabaseUser.created_at\n            };\n\n            if (isMounted) {\n              dispatch({ type: ACTIONS.SET_USER, payload: userObject });\n              localStorage.setItem('user', JSON.stringify(userObject));\n              console.log('âœ… User restored from Supabase session (fallback):', userObject);\n            }\n          }\n        } else if (isMounted) {\n          // No user in Supabase session, clear any local data\n          localStorage.removeItem('user');\n          console.log('âŒ No user in Supabase session, cleared user data');\n        }\n      } catch (error) {\n        console.error('Error initializing auth with Supabase:', error);\n        if (isMounted) {\n          localStorage.removeItem('user');\n          dispatch({ type: ACTIONS.SET_USER, payload: null });\n        }\n      }\n    };\n\n    initializeAuth();\n\n    // Set up auth state change listener\n    const unsubscribe = onAuthStateChange(async (event, session) => {\n      console.log('ðŸ” Auth state changed:', event);\n\n      if (isMounted && event === 'SIGNED_IN' && session?.user) {\n        // Get user profile from the profiles table\n        const userProfile = await getUserProfile();\n\n        if (userProfile) {\n          const userObject = {\n            id: userProfile.id,\n            name: session.user.user_metadata?.full_name || session.user.user_metadata?.name || session.user.email?.split('@')[0] || 'User',\n            email: session.user.email,\n            avatar: session.user.user_metadata?.avatar || session.user.user_metadata?.picture || null,\n            role: userProfile.role,\n            created_at: session.user.created_at\n          };\n\n          dispatch({ type: ACTIONS.SET_USER, payload: userObject });\n          localStorage.setItem('user', JSON.stringify(userObject));\n          console.log('âœ… User set after sign in:', userObject);\n        } else {\n          // Fallback: use session data directly if profile fetch fails\n          const userObject = {\n            id: session.user.id,\n            name: session.user.user_metadata?.full_name || session.user.user_metadata?.name || session.user.email?.split('@')[0] || 'User',\n            email: session.user.email,\n            avatar: session.user.user_metadata?.avatar || session.user.user_metadata?.picture || null,\n            role: 'customer', // Default role if profile doesn't exist yet\n            created_at: session.user.created_at\n          };\n\n          dispatch({ type: ACTIONS.SET_USER, payload: userObject });\n          localStorage.setItem('user', JSON.stringify(userObject));\n          console.log('âœ… User set after sign in (fallback):', userObject);\n        }\n      } else if (isMounted && event === 'SIGNED_OUT') {\n        localStorage.removeItem('user');\n        localStorage.removeItem('cartItems');\n        dispatch({ type: ACTIONS.SET_USER, payload: null });\n        dispatch({ type: ACTIONS.SET_CART_ITEMS, payload: [] });\n        console.log('âœ… User cleared after sign out');\n      }\n    });\n\n    // Cleanup function\n    return () => {\n      isMounted = false;\n      unsubscribe && unsubscribe();\n    };\n  }, []);\n\n  // Fetch cart items\n  const fetchCartItems = async () => {\n    if (!state.user) {\n      // For guest users, always set cart to empty as requested\n      dispatch({ type: ACTIONS.SET_CART_ITEMS, payload: [] });\n      // Sync Zustand cart with empty array\n      import('@/store/cartStore').then((module) => {\n        module.useCartStore.getState().clearCart();\n      });\n      return;\n    }\n\n    setLoading('cart', true);\n    setError('cart', null);\n\n    try {\n      const response = await apiClient.getCartItems();\n      if (response.success && response.data) {\n        dispatch({ type: ACTIONS.SET_CART_ITEMS, payload: response.data });\n        // Sync Zustand cart with fetched data\n        import('@/store/cartStore').then((module) => {\n          module.useCartStore.getState().clearCart();\n          response.data.forEach(item => {\n            module.useCartStore.getState().addItem(item);\n          });\n        });\n      } else {\n        // Don't throw an error for empty cart, just log and handle gracefully\n        console.warn('No cart items found for user:', response.error);\n        dispatch({ type: ACTIONS.SET_CART_ITEMS, payload: [] });\n        // Sync Zustand cart with empty array\n        import('@/store/cartStore').then((module) => {\n          module.useCartStore.getState().clearCart();\n        });\n      }\n    } catch (error: any) {\n      // Handle network errors, etc.\n      console.error('Error fetching cart items:', error);\n      setError('cart', error.message || 'Failed to load cart items. Please try again later.');\n      // Still set empty cart to avoid breaking the UI\n      dispatch({ type: ACTIONS.SET_CART_ITEMS, payload: [] });\n      // Sync Zustand cart with empty array\n      import('@/store/cartStore').then((module) => {\n        module.useCartStore.getState().clearCart();\n      });\n    } finally {\n      setLoading('cart', false);\n    }\n  };\n\n  // Load cart from localStorage based on login state\n  useEffect(() => {\n    if (!state.user) {\n      // User is not logged in, set cart to empty to ensure it appears empty in the UI\n      dispatch({ type: ACTIONS.SET_CART_ITEMS, payload: [] });\n    } else {\n      // User is logged in, fetch their cart from the server\n      fetchCartItems();\n    }\n  }, [state.user]); // Re-run when user changes\n\n  // Sync Zustand cart with AppContext cart\n  useEffect(() => {\n    // Initialize Zustand cart from AppContext\n    import('@/store/cartStore').then((module) => {\n      const { items } = module.useCartStore.getState();\n      if (items.length === 0 && state.cartItems.length > 0) {\n        // If Zustand store is empty but AppContext has items, populate Zustand\n        state.cartItems.forEach(item => {\n          module.useCartStore.getState().addItem(item);\n        });\n      } else if (items.length > 0 && state.cartItems.length === 0) {\n        // If Zustand has items but AppContext is empty, populate AppContext\n        dispatch({ type: ACTIONS.SET_CART_ITEMS, payload: items });\n      }\n    });\n  }, [state.cartItems]);\n\n  // Save cart to localStorage only when not logged in\n  useEffect(() => {\n    // Only save guest cart to localStorage if not logged in\n    if (!state.user) {\n      localStorage.setItem('cartItems', JSON.stringify(state.cartItems));\n    }\n  }, [state.cartItems, state.user]);\n\n  // Actions\n  const setUser = (user: User | null) => {\n    dispatch({ type: ACTIONS.SET_USER, payload: user });\n    if (user) {\n      localStorage.setItem('user', JSON.stringify(user));\n    } else {\n      localStorage.removeItem('user');\n    }\n  };\n\n  const setToken = (token: string | null) => {\n    dispatch({ type: ACTIONS.SET_TOKEN, payload: token });\n    if (token) {\n      localStorage.setItem('token', token);\n    } else {\n      localStorage.removeItem('token');\n    }\n  };\n\n  const setLoading = (type: keyof LoadingState, value: boolean) => {\n    dispatch({ type: ACTIONS.SET_LOADING, payload: { type, value } });\n  };\n\n  const setError = (type: keyof ErrorState, value: string | null) => {\n    dispatch({ type: ACTIONS.SET_ERROR, payload: { type, value } });\n  };\n\n  // Fetch products\n  const fetchProducts = async () => {\n    // Don't fetch if already loading to prevent race conditions\n    if (state.loading.products) return;\n\n    setLoading('products', true);\n    setError('products', null);\n\n    try {\n      const response = await apiClient.getProducts();\n      if (response.success && response.data) {\n        // Handle the new response structure with pagination\n        const productsData = Array.isArray(response.data) ? response.data : response.data?.products || [];\n        \n        // Convert price strings to numbers for proper formatting\n        // Map mock image_url identifiers to appropriate imageClass values\n        const mapImageIdentifierToClass = (identifier: string) => {\n          if (!identifier) return 'modern';\n\n          const lowerIdentifier = identifier.toLowerCase();\n          if (lowerIdentifier.includes('modern') || lowerIdentifier.includes('coffee') || lowerIdentifier.includes('sofa')) {\n            return 'modern';\n          } else if (lowerIdentifier.includes('classic') || lowerIdentifier.includes('armchair')) {\n            return 'classic';\n          } else if (lowerIdentifier.includes('vintage') || lowerIdentifier.includes('lamp')) {\n            return 'coastal'; // Using coastal for lighting items\n          } else if (lowerIdentifier.includes('dining') || lowerIdentifier.includes('dresser')) {\n            return 'office'; // Using office for furniture items\n          } else if (lowerIdentifier.includes('wall') || lowerIdentifier.includes('art')) {\n            return 'hotel'; // Using hotel for decor items\n          } else if (lowerIdentifier.includes('rug')) {\n            return 'restaurant'; // Using restaurant for decor items\n          } else {\n            return 'modern'; // default\n          }\n        };\n\n        const formattedProducts = productsData.map((product: any) => ({\n          ...product,\n          price: typeof product.price === 'number' ? product.price : parseFloat(product.price),\n          // Only set image_url to undefined if it's not a proper URL\n          // If it looks like an actual URL (contains http), keep it\n          image_url: product.image_url && (product.image_url.startsWith('http') || product.image_url.startsWith('/'))\n            ? product.image_url\n            : undefined,\n          // Use the identifier to determine the appropriate CSS class\n          imageClass: mapImageIdentifierToClass(product.image_url) || product.imageClass || 'modern'\n        }));\n        dispatch({ type: ACTIONS.SET_PRODUCTS, payload: formattedProducts });\n      } else {\n        throw new Error(response.error || 'Failed to load products');\n      }\n    } catch (error: any) {\n      console.error('Error fetching products:', error);\n      setError('products', error.message || 'Failed to load products. Please try again later.');\n    } finally {\n      setLoading('products', false);\n    }\n  };\n\n  // Add item to cart\n  // Track ongoing cart requests to prevent duplicates\n  const ongoingCartRequests = new Set<number>(); // Set to track product IDs with ongoing requests\n\n  const addToCart = async (product: Product, quantity = 1) => {\n    // Prevent multiple requests for the same product\n    if (ongoingCartRequests.has(product.id)) {\n      return; // Skip if already processing a request for this product\n    }\n\n    if (state.user) {\n      ongoingCartRequests.add(product.id); // Mark this product as having an ongoing request\n      setLoading('cart', true);\n      setError('cart', null);\n\n      try {\n        const response = await apiClient.addToCart(product.id, quantity);\n        if (response.success && response.data) {\n          dispatch({ type: ACTIONS.ADD_TO_CART, payload: response.data });\n          // Sync with Zustand store\n          import('@/store/cartStore').then((module) => {\n            module.useCartStore.getState().addItem(response.data);\n          });\n        } else {\n          throw new Error(response.error || 'Failed to add item to cart');\n        }\n      } catch (error: any) {\n        console.error('Error adding to cart:', error);\n        setError('cart', error.message || 'Failed to add item to cart. Please try again.');\n      } finally {\n        ongoingCartRequests.delete(product.id); // Remove the tracking\n        setLoading('cart', false);\n      }\n    } else {\n      // For non-authenticated users, add to Zustand cart directly\n      const cartItem = {\n        id: Date.now(), // Temporary ID\n        product_id: product.id,\n        quantity,\n        name: product.name,\n        price: product.price,\n        image_url: product.image_url,\n      };\n      \n      import('@/store/cartStore').then((module) => {\n        module.useCartStore.getState().addItem(cartItem);\n      });\n    }\n  };\n\n  // Update cart item\n  const updateCartItem = async (productId: number, quantity: number) => {\n    // Only proceed if product ID is valid\n    if (!productId || typeof productId !== 'number' || productId <= 0) {\n      console.error('Invalid product ID provided to updateCartItem:', productId);\n      return;\n    }\n\n    if (state.user) {\n      setLoading('cart', true);\n      setError('cart', null);\n\n      try {\n        const response = await apiClient.updateCartItem(productId, quantity);\n        if (response.success && response.data) {\n          // Use ADD_TO_CART action to properly handle the full cart item data from API\n          // This will add a new item or update an existing one with the full API response data\n          dispatch({ type: ACTIONS.ADD_TO_CART, payload: response.data });\n          // Sync with Zustand store\n          import('@/store/cartStore').then((module) => {\n            module.useCartStore.getState().updateItem(product_id, quantity);\n          });\n        } else if (quantity <= 0 && response.success) {\n          // When quantity is 0, the item was removed\n          dispatch({ type: ACTIONS.REMOVE_FROM_CART, payload: product_id });\n          // Sync with Zustand store\n          import('@/store/cartStore').then((module) => {\n            module.useCartStore.getState().removeItem(product_id);\n          });\n        } else {\n          throw new Error(response.error || 'Failed to update cart item');\n        }\n      } catch (error: any) {\n        console.error('Error updating cart item:', error);\n        setError('cart', error.message || 'Failed to update cart item. Please try again.');\n      } finally {\n        setLoading('cart', false);\n      }\n    } else {\n      if (quantity <= 0) {\n        dispatch({ type: ACTIONS.REMOVE_FROM_CART, payload: productId });\n        // Sync with Zustand store\n        import('@/store/cartStore').then((module) => {\n          module.useCartStore.getState().removeItem(productId);\n        });\n      } else {\n        dispatch({ type: ACTIONS.UPDATE_CART_ITEM, payload: { product_id: productId, quantity } });\n        // Sync with Zustand store\n        import('@/store/cartStore').then((module) => {\n          module.useCartStore.getState().updateItem(productId, quantity);\n        });\n      }\n\n      // Update localStorage for guest cart\n      const currentCart = JSON.parse(localStorage.getItem('cartItems') || '[]');\n      const existingItemIndex = currentCart.findIndex((item: any) => item.product_id === productId);\n\n      if (existingItemIndex !== -1) {\n        if (quantity <= 0) {\n          // Remove item from localStorage\n          currentCart.splice(existingItemIndex, 1);\n        } else {\n          // Update quantity in localStorage\n          currentCart[existingItemIndex].quantity = quantity;\n        }\n      } else if (quantity > 0) {\n        // Find the product to get its details and add to localStorage\n        const product = state.products.find(p => p.id === productId);\n        if (product) {\n          currentCart.push({\n            id: product.id,\n            product_id: product.id,\n            name: product.name,\n            price: product.price,\n            quantity,\n            image_url: product.image_url,\n            user_id: null\n          });\n        }\n      }\n\n      localStorage.setItem('cartItems', JSON.stringify(currentCart));\n    }\n  };\n\n  // Remove item from cart\n  const removeFromCart = async (productId: number) => {\n    // Only proceed if product ID is valid\n    if (!productId || typeof productId !== 'number' || productId <= 0) {\n      console.error('Invalid product ID provided to removeFromCart:', productId);\n      return;\n    }\n\n    if (state.user) {\n      setLoading('cart', true);\n      setError('cart', null);\n\n      try {\n        const response = await apiClient.removeFromCart(productId);\n        if (response.success) {\n          dispatch({ type: ACTIONS.REMOVE_FROM_CART, payload: productId });\n          // Sync with Zustand store\n          import('@/store/cartStore').then((module) => {\n            module.useCartStore.getState().removeItem(productId);\n          });\n        } else {\n          throw new Error(response.error || 'Failed to remove item from cart');\n        }\n      } catch (error: any) {\n        console.error('Error removing from cart:', error);\n        setError('cart', error.message || 'Failed to remove item from cart. Please try again.');\n      } finally {\n        setLoading('cart', false);\n      }\n    } else {\n      dispatch({ type: ACTIONS.REMOVE_FROM_CART, payload: productId });\n      // Sync with Zustand store\n      import('@/store/cartStore').then((module) => {\n        module.useCartStore.getState().removeItem(productId);\n      });\n\n      // Update localStorage for guest cart\n      const currentCart = JSON.parse(localStorage.getItem('cartItems') || '[]');\n      const updatedCart = currentCart.filter((item: any) => item.product_id !== productId);\n      localStorage.setItem('cartItems', JSON.stringify(updatedCart));\n    }\n  };\n\n  // Clear cart\n  const clearCart = async () => {\n    if (state.user) {\n      setLoading('cart', true);\n      setError('cart', null);\n\n      try {\n        const response = await apiClient.clearCart();\n        if (response.success) {\n          dispatch({ type: ACTIONS.CLEAR_CART });\n          // Sync with Zustand store\n          import('@/store/cartStore').then((module) => {\n            module.useCartStore.getState().clearCart();\n          });\n        } else {\n          throw new Error(response.error || 'Failed to clear cart');\n        }\n      } catch (error: any) {\n        console.error('Error clearing cart:', error);\n        setError('cart', error.message || 'Failed to clear cart. Please try again.');\n      } finally {\n        setLoading('cart', false);\n      }\n    } else {\n      dispatch({ type: ACTIONS.CLEAR_CART });\n      // Sync with Zustand store\n      import('@/store/cartStore').then((module) => {\n        module.useCartStore.getState().clearCart();\n      });\n      // Clear localStorage for guest cart\n      localStorage.removeItem('cartItems');\n    }\n  };\n\n  // Fetch orders\n  const fetchOrders = async () => {\n    if (!state.user) return;\n\n    setLoading('orders', true);\n    setError('orders', null);\n\n    try {\n      const response = await apiClient.getOrders();\n      if (response.success && response.data) {\n        dispatch({ type: ACTIONS.SET_ORDERS, payload: response.data });\n      } else {\n        throw new Error(response.error || 'Failed to load orders');\n      }\n    } catch (error: any) {\n      console.error('Error fetching orders:', error);\n      setError('orders', error.message || 'Failed to load orders. Please try again later.');\n    } finally {\n      setLoading('orders', false);\n    }\n  };\n\n  // Create order\n  const createOrder = async (orderData: any) => {\n    if (!state.user) return;\n\n    setLoading('orders', true);\n    setError('orders', null);\n\n    try {\n      const response = await apiClient.createOrder(orderData);\n      if (response.success && response.data) {\n        dispatch({ type: ACTIONS.ADD_ORDER, payload: response.data });\n        dispatch({ type: ACTIONS.CLEAR_CART });\n        return response.data;\n      } else {\n        throw new Error(response.error || 'Failed to create order');\n      }\n    } catch (error: any) {\n      console.error('Error creating order:', error);\n\n      // Handle validation errors from backend\n      if (error.message && error.message.includes('Validation Error')) {\n        setError('orders', 'Please check your order details and try again.');\n      } else {\n        setError('orders', error.message || 'Failed to create order. Please try again.');\n      }\n\n      throw error;\n    } finally {\n      setLoading('orders', false);\n    }\n  };\n\n  // Fetch user profile\n  const fetchUserProfile = async () => {\n    if (!state.user) return;\n\n    setLoading('user', true);\n    setError('user', null);\n\n    try {\n      const response = await fetch('/api/profile', {\n        headers: {\n          'Authorization': `Bearer ${state.token}` // This might need to be updated for Supabase\n        }\n      });\n\n      const result = await response.json();\n      if (result.success && result.data) {\n        // Always update user in context with the latest data from the API\n        setUser(result.data);\n        return result.data;\n      } else {\n        // If API call fails, and we have existing user data, return that.\n        // Otherwise, throw an error.\n        if (state.user) {\n          return state.user;\n        } else {\n          throw new Error(result.error || 'Failed to fetch user profile');\n        }\n      }\n    } catch (error: any) {\n      console.error('Error fetching user profile:', error);\n      // If an error occurs and we have existing user data, return that.\n      // Otherwise, set an error.\n      if (state.user) {\n        return state.user;\n      }\n      setError('user', error.message || 'Failed to fetch user profile. Please try again later.');\n      throw error; // Re-throw to propagate the error for handling in components\n    } finally {\n      setLoading('user', false);\n    }\n  };\n\n\n\n  // Update user profile\n  const updateUserProfile = async (profileData: any) => {\n    if (!state.user) return;\n\n    setLoading('user', true);\n    setError('user', null);\n\n    try {\n      const response = await fetch('/api/profile', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${state.token}` // This might need to be updated for Supabase\n        },\n        body: JSON.stringify(profileData)\n      });\n\n      const result = await response.json();\n      if (result.success && result.data) {\n        // Update user in context\n        setUser(result.data);\n        return result.data;\n      } else {\n        throw new Error(result.error || 'Failed to update profile');\n      }\n    } catch (error: any) {\n      console.error('Error updating profile:', error);\n      setError('user', error.message || 'Failed to update profile. Please try again.');\n      throw error;\n    } finally {\n      setLoading('user', false);\n    }\n  };\n\n  // Login - This should be removed since we're using Google OAuth exclusively\n  const login = async (credentials: any) => {\n    throw new Error('Email/password login is not supported. Please use Google OAuth.');\n  };\n\n  // Register - This should be removed since we're using Google OAuth exclusively\n  const register = async (userData: any) => {\n    throw new Error('Email/password registration is not supported. Please use Google OAuth.');\n  };\n\n  // Logout\n  const logout = async () => {\n    try {\n      // Store the current cart in temp ref for potential restoration on login\n      tempSavedCart.current = [...state.cartItems];\n\n      // Clear cart items from localStorage to ensure cart appears empty after logout\n      localStorage.removeItem('cartItems');\n\n      // Clear user from app context\n      setUser(null);\n      setToken(null);\n      \n      // Clear all user-related data from localStorage\n      localStorage.removeItem('user');\n      localStorage.removeItem('token');\n      \n      // Dispatch actions to clear state\n      dispatch({ type: ACTIONS.CLEAR_CART });\n      dispatch({ type: ACTIONS.SET_ORDERS, payload: [] });\n      \n      // Also logout from Supabase to clear all session cookies\n      try {\n        const { createClient } = await import('@/lib/supabase/client');\n        const supabase = createClient();\n        const { error } = await supabase.auth.signOut();\n        if (error) {\n          console.error('Supabase sign out error:', error);\n        }\n      } catch (supabaseSignOutError) {\n        console.error('Error with main Supabase sign out:', supabaseSignOutError);\n      }\n      \n      // For good measure, also try to clear any possible remaining session data\n      // by calling the signOut function from auth utils which we updated\n      try {\n        const { signOut } = await import('@/lib/supabase/auth');\n        await signOut();\n      } catch (authSignOutError) {\n        // If auth signOut fails, that's ok as long as the main signOut worked\n        console.warn('Additional signOut failed (this is ok):', authSignOutError);\n      }\n      \n      // Reset the API client token to ensure it doesn't hold any auth data\n      try {\n        const { apiClient } = await import('@/lib/api');\n        apiClient.setToken(null);\n      } catch (apiClientError) {\n        console.warn('Error resetting API client token:', apiClientError);\n      }\n      \n      // Add a small delay to ensure all async operations complete\n      await new Promise(resolve => setTimeout(resolve, 300));\n    } catch (error) {\n      console.error('Error during logout:', error);\n    }\n  };\n\n  // Create product\n  const createProduct = async (productData: any) => {\n    if (!state.user) return;\n\n    setLoading('products', true);\n    setError('products', null);\n\n    try {\n      const response = await apiClient.createProduct(productData);\n      if (response.success && response.data) {\n        // Update products list to include the new product\n        dispatch({ type: ACTIONS.SET_PRODUCTS, payload: [...state.products, response.data] });\n        return response.data;\n      } else {\n        throw new Error(response.error || 'Failed to create product');\n      }\n    } catch (error: any) {\n      console.error('Error creating product:', error);\n      setError('products', error.message || 'Failed to create product. Please try again.');\n      throw error;\n    } finally {\n      setLoading('products', false);\n    }\n  };\n\n  // Update product\n  const updateProduct = async (id: number, productData: any) => {\n    if (!state.user) return;\n\n    setLoading('products', true);\n    setError('products', null);\n\n    try {\n      const response = await apiClient.updateProduct(id, productData);\n      if (response.success && response.data) {\n        // Update products list to reflect the changes\n        const updatedProducts = state.products.map(product =>\n          product.id === id ? response.data : product\n        );\n        dispatch({ type: ACTIONS.SET_PRODUCTS, payload: updatedProducts });\n        return response.data;\n      } else {\n        throw new Error(response.error || 'Failed to update product');\n      }\n    } catch (error: any) {\n      console.error('Error updating product:', error);\n      setError('products', error.message || 'Failed to update product. Please try again.');\n      throw error;\n    } finally {\n      setLoading('products', false);\n    }\n  };\n\n  // Fetch specific product by slug\n  const fetchProductBySlug = async (slug: string): Promise<Product> => {\n    setLoading('products', true);\n    setError('products', null);\n\n    try {\n      const response = await apiClient.getProductBySlug(slug);\n      if (response.success && response.data) {\n        // Ensure slug is present in the returned product\n        const productData: Product = {\n          ...response.data,\n          slug: response.data.slug || slug\n        };\n\n        // Add the fetched product to the products list\n        const updatedProducts = [...state.products];\n        const existingIndex = updatedProducts.findIndex(p => p.id === productData.id);\n\n        if (existingIndex !== -1) {\n          // Update existing product\n          updatedProducts[existingIndex] = productData;\n        } else {\n          // Add new product\n          updatedProducts.push(productData);\n        }\n\n        dispatch({ type: ACTIONS.SET_PRODUCTS, payload: updatedProducts });\n        return productData;\n      } else {\n        throw new Error(response.error || 'Failed to fetch product');\n      }\n    } catch (error: any) {\n      console.error('Error fetching product by slug:', error);\n      setError('products', error.message || 'Failed to fetch product. Please try again.');\n      throw error;\n    } finally {\n      setLoading('products', false);\n    }\n  };\n\n  // Search products\n  const searchProducts = async (params: {\n    q?: string;\n    search?: string;\n    category?: string;\n    minPrice?: number;\n    maxPrice?: number;\n    page?: number;\n    limit?: number;\n  }) => {\n    setLoading('products', true);\n    setError('products', null);\n\n    try {\n      const response = await apiClient.searchProducts(params);\n      if (response.success && response.data) {\n        // Handle both response formats (old direct array and new with pagination object)\n        const productsData = Array.isArray(response.data) ? response.data : response.data?.products || [];\n        \n        // Map imageClass to products\n        const mapImageIdentifierToClass = (identifier: string) => {\n          if (!identifier) return 'modern';\n\n          const lowerIdentifier = identifier.toLowerCase();\n          if (lowerIdentifier.includes('modern') || lowerIdentifier.includes('coffee') || lowerIdentifier.includes('sofa')) {\n            return 'modern';\n          } else if (lowerIdentifier.includes('classic') || lowerIdentifier.includes('armchair')) {\n            return 'classic';\n          } else if (lowerIdentifier.includes('vintage') || lowerIdentifier.includes('lamp')) {\n            return 'coastal'; // Using coastal for lighting items\n          } else if (lowerIdentifier.includes('dining') || lowerIdentifier.includes('dresser')) {\n            return 'office'; // Using office for furniture items\n          } else if (lowerIdentifier.includes('wall') || lowerIdentifier.includes('art')) {\n            return 'hotel'; // Using hotel for decor items\n          } else if (lowerIdentifier.includes('rug')) {\n            return 'restaurant'; // Using restaurant for decor items\n          } else {\n            return 'modern'; // default\n          }\n        };\n\n        const formattedProducts = productsData.map((product: any) => ({\n          ...product,\n          price: typeof product.price === 'number' ? product.price : parseFloat(product.price),\n          image_url: product.image_url && (product.image_url.startsWith('http') || product.image_url.startsWith('/'))\n            ? product.image_url\n            : undefined,\n          imageClass: mapImageIdentifierToClass(product.image_url) || product.imageClass || 'modern'\n        }));\n\n        dispatch({ type: ACTIONS.SET_PRODUCTS, payload: formattedProducts });\n        \n        // Return pagination data if it exists\n        if (response.data.pagination) {\n          return {\n            products: formattedProducts,\n            pagination: response.data.pagination,\n            filters: response.data.filters\n          };\n        } else {\n          return formattedProducts;\n        }\n      } else {\n        throw new Error(response.error || 'Failed to search products');\n      }\n    } catch (error: any) {\n      console.error('Error searching products:', error);\n      setError('products', error.message || 'Failed to search products. Please try again.');\n      throw error;\n    } finally {\n      setLoading('products', false);\n    }\n  };\n\n  // Verify token - we can use any authenticated endpoint to verify the token\n  const verifyToken = async () => {\n    if (!state.user) return false;\n\n    try {\n      // Using the getOrders endpoint as a way to verify the token\n      const response = await apiClient.getOrders();\n      if (response.success) {\n        return true;\n      } else {\n        throw new Error('Token verification failed');\n      }\n    } catch (error: any) {\n      console.error('Token verification failed:', error);\n      logout();\n      return false;\n    }\n  };\n\n  // Fetch appointments\n  const fetchAppointments = async (filters?: {\n    status?: string;\n    date?: string;\n    page?: number;\n    limit?: number;\n  }) => {\n    if (!state.user) return;\n\n    setLoading('appointments', true);\n    setError('appointments', null);\n\n    try {\n      const response = await apiClient.getAppointments(filters);\n      if (response.success && response.data) {\n        dispatch({ type: ACTIONS.SET_APPOINTMENTS, payload: response.data.appointments });\n        return response.data;\n      } else {\n        throw new Error(response.error || 'Failed to fetch appointments');\n      }\n    } catch (error: any) {\n      console.error('Error fetching appointments:', error);\n      setError('appointments', error.message || 'Failed to fetch appointments. Please try again.');\n      throw error;\n    } finally {\n      setLoading('appointments', false);\n    }\n  };\n\n  // Create appointment\n  const createAppointment = async (appointmentData: {\n    appointment_date: string;\n    notes?: string;\n  }) => {\n    if (!state.user) return;\n\n    try {\n      const response = await apiClient.createAppointment(appointmentData);\n      if (response.success && response.data) {\n        // Refresh appointments list after creating new one\n        await fetchAppointments();\n        return response.data;\n      } else {\n        throw new Error(response.error || 'Failed to create appointment');\n      }\n    } catch (error: any) {\n      console.error('Error creating appointment:', error);\n      throw error;\n    }\n  };\n\n  // Update appointment\n  const updateAppointment = async (id: string, updateData: {\n    status?: string;\n    notes?: string;\n  }) => {\n    if (!state.user) return;\n\n    try {\n      const response = await apiClient.updateAppointment(id, updateData);\n      if (response.success && response.data) {\n        // Refresh appointments list after updating\n        await fetchAppointments();\n        return response.data;\n      } else {\n        throw new Error(response.error || 'Failed to update appointment');\n      }\n    } catch (error: any) {\n      console.error('Error updating appointment:', error);\n      throw error;\n    }\n  };\n\n  // Clear pending cart action\n  const clearPendingCartAction = () => {\n    localStorage.removeItem('pendingCartAction');\n  };\n\n  // Add item to cart or request login if guest\n  const addToCartWithAuth = (product: Product, quantity = 1) => {\n    if (state.user) {\n      // User is logged in, return success and the cart action to be performed\n      return { success: true, requiresLogin: false, product, quantity, action: () => addToCart(product, quantity) };\n    } else {\n      // User is not logged in, indicate they need to log in\n      return { success: false, requiresLogin: true, product, quantity };\n    }\n  };\n\n  const value = {\n    ...state,\n    setUser,\n    setToken,\n    setLoading,\n    setError,\n    fetchProducts,\n    fetchCartItems,\n    addToCart,\n    updateCartItem,\n    removeFromCart,\n    clearCart,\n    fetchOrders,\n    createOrder,\n    fetchAppointments,\n    createAppointment,\n    updateAppointment,\n    login,\n    register,\n    logout,\n    verifyToken,\n    fetchUserProfile,\n    updateUserProfile,\n    createProduct,\n    updateProduct,\n    fetchProductBySlug,\n    searchProducts,\n    addToCartWithAuth,\n    clearPendingCartAction\n  };\n\n  return (\n    <AppContext.Provider value={value}>\n      {children}\n    </AppContext.Provider>\n  );\n};\n\n// Custom hook to use the context\nexport const useAppContext = () => {\n  const context = useContext(AppContext);\n  if (!context) {\n    throw new Error('useAppContext must be used within an AppProvider');\n  }\n  return context;\n};"],"names":["React","createContext","useContext","useReducer","useEffect","useRef","apiClient","User","Product","CartItem","Order","LoadingState","ErrorState","State","getCurrentUser","onAuthStateChange","getUserProfile","Action","type","payload","initialState","user","token","products","cartItems","orders","appointments","loading","cart","auth","error","ACTIONS","SET_USER","SET_TOKEN","SET_PRODUCTS","SET_CART_ITEMS","SET_ORDERS","SET_APPOINTMENTS","SET_LOADING","SET_ERROR","ADD_TO_CART","REMOVE_FROM_CART","UPDATE_CART_ITEM","CLEAR_CART","ADD_ORDER","appReducer","state","action","value","existingItem","find","item","product_id","updatedCartItems","map","quantity","filter","AppContext","setUser","setToken","setLoading","setError","fetchProducts","Promise","fetchCartItems","addToCart","product","updateCartItem","productId","removeFromCart","clearCart","fetchOrders","createOrder","orderData","login","credentials","register","userData","logout","verifyToken","fetchUserProfile","updateUserProfile","profileData","createProduct","productData","updateProduct","id","fetchProductBySlug","slug","searchProducts","params","q","search","category","minPrice","maxPrice","page","limit","fetchAppointments","filters","status","date","createAppointment","appointmentData","appointment_date","notes","updateAppointment","updateData","addToCartWithAuth","success","requiresLogin","clearPendingCartAction","undefined","AppProviderProps","children","ReactNode","AppProvider","FC","dispatch","tempSavedCart","console","log","isMounted","initializeAuth","supabaseUser","userProfile","userObject","name","user_metadata","full_name","email","split","avatar","picture","role","created_at","localStorage","setItem","JSON","stringify","removeItem","unsubscribe","event","session","then","module","useCartStore","getState","response","getCartItems","data","forEach","addItem","warn","message","items","length","getProducts","productsData","Array","isArray","mapImageIdentifierToClass","identifier","lowerIdentifier","toLowerCase","includes","formattedProducts","price","parseFloat","image_url","startsWith","imageClass","Error","ongoingCartRequests","Set","has","add","delete","cartItem","Date","now","updateItem","currentCart","parse","getItem","existingItemIndex","findIndex","splice","p","push","user_id","updatedCart","getOrders","fetch","headers","result","json","method","body","current","createClient","supabase","signOut","supabaseSignOutError","authSignOutError","apiClientError","resolve","setTimeout","updatedProducts","getProductBySlug","existingIndex","pagination","getAppointments","useAppContext","context"],"mappings":"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"}