{"version":3,"sources":["turbopack:///[project]/src/app/dashboard/users/page.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/src/app/dashboard/users/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/dashboard/users/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/dashboard/users/page.tsx\",\n    \"default\",\n);\n","'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { useAppContext } from '@/context/AppContext';\nimport { useRouter } from 'next/navigation';\nimport { getAllUserProfiles, updateUserRole } from '@/lib/supabase/auth';\n\nconst DashboardUsersPage = () => {\n  const router = useRouter();\n  const { user, loading } = useAppContext();\n  const [users, setUsers] = useState<any[]>([]);\n  const [loadingState, setLoadingState] = useState<boolean>(true);\n  const [roleFilter, setRoleFilter] = useState<string>('all');\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!loading.user && !user) {\n      router.push('/auth?redirect=/dashboard/users');\n    } else if (user && user.role === 'admin') {\n      loadUsers();\n    } else {\n      router.push('/dashboard'); // Redirect if not authorized\n    }\n  }, [user, loading]);\n\n  const loadUsers = async () => {\n    setLoadingState(true);\n    setError(null);\n    \n    try {\n      // In a real implementation, this would call getAllUserProfiles()\n      // For now, we'll use mock data\n      const mockUsers = [\n        {\n          id: '1',\n          role: 'customer',\n          created_at: '2023-11-01T10:00:00.000Z',\n          updated_at: '2023-11-01T10:00:00.000Z',\n          user_info: { name: 'John Doe', email: 'john@example.com' }\n        },\n        {\n          id: '2',\n          role: 'moderator',\n          created_at: '2023-11-02T11:00:00.000Z',\n          updated_at: '2023-11-15T14:30:00.000Z',\n          user_info: { name: 'Jane Smith', email: 'jane@example.com' }\n        },\n        {\n          id: '3',\n          role: 'admin',\n          created_at: '2023-11-03T12:00:00.000Z',\n          updated_at: '2023-11-20T09:15:00.000Z',\n          user_info: { name: 'Robert Johnson', email: 'robert@example.com' }\n        },\n        {\n          id: '4',\n          role: 'customer',\n          created_at: '2023-11-04T13:00:00.000Z',\n          updated_at: '2023-11-04T13:00:00.000Z',\n          user_info: { name: 'Emily Davis', email: 'emily@example.com' }\n        }\n      ];\n      \n      setUsers(mockUsers);\n    } catch (err: any) {\n      console.error('Error fetching users:', err);\n      setError(err.message || 'Failed to load users');\n    } finally {\n      setLoadingState(false);\n    }\n  };\n\n  const updateUserRoleLocally = async (userId: string, newRole: string) => {\n    try {\n      // In a real implementation, this would call updateUserRole(userId, newRole)\n      console.log(`Updating user ${userId} to ${newRole}`);\n      \n      // Update local state\n      setUsers(prev => \n        prev.map(user => \n          user.id === userId ? { ...user, role: newRole } : user\n        )\n      );\n    } catch (error) {\n      console.error('Error updating user role:', error);\n      setError('Failed to update user role');\n    }\n  };\n\n  // Apply role filter\n  const filteredUsers = roleFilter === 'all' \n    ? users \n    : users.filter(u => u.role === roleFilter);\n\n  if (loading.user || loadingState) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading users...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!user || user.role !== 'admin') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"text-center p-8 max-w-md\">\n          <div className=\"text-5xl text-red-500 mb-4\">‚ùå</div>\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Access Denied</h2>\n          <p className=\"text-gray-600 mb-6\">\n            You don't have permission to access user management.\n          </p>\n          <button\n            onClick={() => router.push('/')}\n            className=\"px-6 py-3 bg-amber-600 text-white rounded-md hover:bg-amber-700\"\n          >\n            Go Home\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"bg-white shadow\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between h-16\">\n            <div className=\"flex\">\n              <div className=\"flex-shrink-0 flex items-center\">\n                <h1 className=\"text-xl font-bold text-gray-900\">User Management</h1>\n              </div>\n              <div className=\"hidden sm:ml-6 sm:flex sm:space-x-8\">\n                <button \n                  onClick={() => router.push('/dashboard')}\n                  className=\"border-b-2 border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 text-sm font-medium\"\n                >\n                  Dashboard\n                </button>\n                <span className=\"border-b-2 border-amber-500 text-amber-600 inline-flex items-center px-1 pt-1 text-sm font-medium\">\n                  Users\n                </span>\n              </div>\n            </div>\n            <div className=\"flex items-center\">\n              <div className=\"ml-3 relative\">\n                <div className=\"text-sm text-gray-700\">\n                  Welcome, <span className=\"font-medium capitalize\">{user.role}</span> {user.name}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"py-6\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"lg:text-center mb-8\">\n            <h2 className=\"text-base text-amber-600 font-semibold tracking-wide uppercase\">User Management</h2>\n            <p className=\"mt-2 text-3xl leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl\">\n              Manage User Roles\n            </p>\n          </div>\n\n          {error && (\n            <div className=\"mb-6 p-4 bg-red-50 border border-red-200 text-red-700 rounded-md\">\n              {error}\n            </div>\n          )}\n\n          {/* Filter Controls */}\n          <div className=\"mb-6 flex flex-wrap gap-4 items-center\">\n            <div>\n              <label htmlFor=\"roleFilter\" className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Filter by Role\n              </label>\n              <select\n                id=\"roleFilter\"\n                value={roleFilter}\n                onChange={(e) => setRoleFilter(e.target.value)}\n                className=\"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm rounded-md\"\n              >\n                <option value=\"all\">All Roles</option>\n                <option value=\"customer\">Customer</option>\n                <option value=\"moderator\">Moderator</option>\n                <option value=\"admin\">Admin</option>\n              </select>\n            </div>\n            \n            <button\n              onClick={loadUsers}\n              className=\"mt-6 px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500\"\n            >\n              Refresh\n            </button>\n          </div>\n\n          {loadingState ? (\n            <div className=\"flex justify-center items-center h-64\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600\"></div>\n            </div>\n          ) : filteredUsers.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <div className=\"text-gray-400 text-5xl mb-4\">üë•</div>\n              <h3 className=\"text-xl font-medium text-gray-900 mb-2\">No users found</h3>\n              <p className=\"text-gray-600\">\n                {roleFilter === 'all' \n                  ? \"No users to display.\" \n                  : `No ${roleFilter} users found.`}\n              </p>\n            </div>\n          ) : (\n            <div className=\"bg-white shadow overflow-hidden sm:rounded-md\">\n              <ul className=\"divide-y divide-gray-200\">\n                {filteredUsers.map((userItem) => (\n                  <li key={userItem.id}>\n                    <div className=\"px-4 py-4 sm:px-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"text-sm font-medium text-amber-600 truncate\">\n                          {userItem.user_info?.name || 'Unknown User'}\n                        </div>\n                        <div className=\"ml-2 flex-shrink-0 flex\">\n                          <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\n                            userItem.role === 'admin' ? 'bg-purple-100 text-purple-800' :\n                            userItem.role === 'moderator' ? 'bg-blue-100 text-blue-800' :\n                            userItem.role === 'customer' ? 'bg-green-100 text-green-800' :\n                            'bg-gray-100 text-gray-800'\n                          }`}>\n                            {userItem.role.charAt(0).toUpperCase() + userItem.role.slice(1)}\n                          </span>\n                        </div>\n                      </div>\n                      <div className=\"mt-2 sm:flex sm:justify-between\">\n                        <div className=\"sm:flex\">\n                          <div className=\"mr-6 text-sm text-gray-500\">\n                            Email: <span className=\"text-gray-900\">{userItem.user_info?.email || 'N/A'}</span>\n                          </div>\n                          <div className=\"mt-2 flex items-center text-sm text-gray-500 sm:mt-0\">\n                            <svg className=\"flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                              <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" />\n                            </svg>\n                            Joined: {new Date(userItem.created_at).toLocaleDateString('en-IN')}\n                          </div>\n                        </div>\n                        <div className=\"mt-2 flex items-center text-sm text-gray-500 sm:mt-0\">\n                          Last updated: {new Date(userItem.updated_at).toLocaleDateString('en-IN')}\n                        </div>\n                      </div>\n                      \n                      <div className=\"mt-4 flex items-center\">\n                        <div className=\"mr-4\">\n                          <label htmlFor={`role-select-${userItem.id}`} className=\"block text-sm font-medium text-gray-700 mb-1\">\n                            Change Role\n                          </label>\n                          <select\n                            id={`role-select-${userItem.id}`}\n                            value={userItem.role}\n                            onChange={(e) => updateUserRoleLocally(userItem.id, e.target.value)}\n                            className=\"block w-40 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm rounded-md\"\n                          >\n                            <option value=\"customer\">Customer</option>\n                            <option value=\"moderator\">Moderator</option>\n                            <option value=\"admin\">Admin</option>\n                          </select>\n                        </div>\n                        <button\n                          onClick={() => router.push(`/dashboard/users/${userItem.id}`)}\n                          className=\"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500\"\n                        >\n                          View Details\n                        </button>\n                      </div>\n                    </div>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DashboardUsersPage;"],"names":["React","useState","useEffect","useAppContext","useRouter","getAllUserProfiles","updateUserRole","DashboardUsersPage","router","user","loading","users","setUsers","loadingState","setLoadingState","roleFilter","setRoleFilter","error","setError","push","role","loadUsers","mockUsers","id","created_at","updated_at","user_info","name","email","err","console","message","updateUserRoleLocally","userId","newRole","log","prev","map","filteredUsers","filter","u","e","target","value","length","userItem","charAt","toUpperCase","slice","Date","toLocaleDateString"],"mappings":"sWAEe,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,kSAAoS,EACjU,iEACA,8DAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,8QAAgR,EAC7S,6CACA","ignoreList":[0]}