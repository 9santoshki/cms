module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},88693,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),o=e.i(61916),s=e.i(14444),i=e.i(37092),l=e.i(69741),c=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(47587),h=e.i(66012),g=e.i(70101),m=e.i(26937),x=e.i(10372),R=e.i(93695);e.i(52474);var C=e.i(5232),A=e.i(89171);let w=(0,e.i(87464).createClient)("https://fykdwqlayqcxycrvbhew.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ5a2R3cWxheXFjeHljcnZiaGV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNzIxMTMsImV4cCI6MjA3ODY0ODExM30.MT3Ph18Rz6pWy6vL-oitq5buSwJ_Jk1imhlCekho8xo");async function E(e){return A.NextResponse.json({},{headers:{"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,DELETE,PATCH,POST,PUT,OPTIONS","Access-Control-Allow-Headers":"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"}})}async function y(e){try{let{searchParams:t}=new URL(e.url),r=t.get("q")||t.get("search")||"",a=t.get("category")||"",n=t.get("minPrice")?parseFloat(t.get("minPrice")):null,o=t.get("maxPrice")?parseFloat(t.get("maxPrice")):null,s=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"12"),l=(s-1)*i,c=w.from("products").select(`
        id, 
        name, 
        description, 
        price, 
        category, 
        images, 
        stock_quantity,
        created_at,
        updated_at
      `).range(l,l+i-1);r&&(c=c.or(`name.ilike.%${r}%,description.ilike.%${r}%`)),a&&(c=c.eq("category",a)),null===n||isNaN(n)||(c=c.gte("price",n)),null===o||isNaN(o)||(c=c.lte("price",o)),c=c.order("created_at",{ascending:!1});let{data:d,error:u}=await c;if(u)return console.error("Error searching products:",u),A.NextResponse.json({success:!1,error:"Failed to search products"},{status:500});let p=await Promise.all(d.map(async e=>{try{let{data:t,error:r}=await w.from("product_images").select("image_url, is_primary, sort_order").eq("product_id",e.id).order("sort_order");if(r)throw r;return{...e,images:t.map(e=>e.image_url),primary_image:t.find(e=>e.is_primary)?.image_url||e.image_url}}catch(t){return console.warn(`Could not fetch images for product ${e.id}:`,t.message||t),{...e,images:Array.isArray(e.images)?e.images:e.image_url?[e.image_url]:[],primary_image:e.image_url}}})),h=w.from("products").select("id",{count:"exact",head:!0});r&&(h=h.or(`name.ilike.%${r}%,description.ilike.%${r}%`)),a&&(h=h.eq("category",a)),null===n||isNaN(n)||(h=h.gte("price",n)),null===o||isNaN(o)||(h=h.lte("price",o));let{count:g,error:m}=await h;if(m)return console.error("Error counting products:",m),A.NextResponse.json({success:!1,error:"Failed to count products"},{status:500});let x=g||0;return A.NextResponse.json({success:!0,data:{products:p,pagination:{page:s,limit:i,total:x,pages:Math.ceil(x/i),hasMore:s<Math.ceil(x/i)},filters:{search:r,category:a,minPrice:n,maxPrice:o}}},{headers:{"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,DELETE,PATCH,POST,PUT,OPTIONS","Access-Control-Allow-Headers":"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"}})}catch(e){return console.error("Error searching products:",e),A.NextResponse.json({success:!1,error:"Internal server error"},{status:500,headers:{"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,DELETE,PATCH,POST,PUT,OPTIONS","Access-Control-Allow-Headers":"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization"}})}}e.s(["GET",()=>y,"OPTIONS",()=>E],16260);var f=e.i(16260);let v=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/search/products/route",pathname:"/api/search/products",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/search/products/route.ts",nextConfigOutput:"",userland:f}),{workAsyncStorage:T,workUnitAsyncStorage:N,serverHooks:P}=v;function O(){return(0,a.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:N})}async function _(e,t,a){v.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let A="/api/search/products/route";A=A.replace(/\/index$/,"")||"/";let w=await v.prepare(e,t,{srcPage:A,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:E,params:y,nextConfig:f,parsedUrl:T,isDraftMode:N,prerenderManifest:P,routerServerContext:O,isOnDemandRevalidate:_,revalidateOnlyGenerated:I,resolvedPathname:k,clientReferenceManifest:S,serverActionsManifest:b}=w,M=(0,l.normalizeAppPath)(A),q=!!(P.dynamicRoutes[M]||P.routes[k]),j=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,T,!1):t.end("This page could not be found"),null);if(q&&!N){let e=!!P.routes[k],t=P.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(f.experimental.adapterPath)return await j();throw new R.NoFallbackError}}let D=null;!q||v.isDev||N||(D="/index"===(D=k)?"/":D);let H=!0===v.isDev||!q,U=q&&!H;b&&S&&(0,s.setReferenceManifestsSingleton)({page:A,clientReferenceManifest:S,serverActionsManifest:b,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:b})});let F=e.method||"GET",X=(0,o.getTracer)(),L=X.getActiveScopeSpan(),$={params:y,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!f.experimental.authInterrupts},cacheComponents:!!f.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:f.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>v.onRequestError(e,t,a,O)},sharedContext:{buildId:E}},V=new c.NodeNextRequest(e),z=new c.NodeNextResponse(t),G=d.NextRequestAdapter.fromNodeNextRequest(V,(0,d.signalFromNodeResponse)(t));try{let s=async e=>v.handle(G,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=X.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${A}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let c=async({previousCacheEntry:r})=>{try{if(!i&&_&&I&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(n);e.fetchMetrics=$.renderOpts.fetchMetrics;let l=$.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=$.renderOpts.collectedTags;if(!q)return await (0,h.sendResponse)(V,z,o,$.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[x.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,a=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:C.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await v.onRequestError(e,t,{routerKind:"App Router",routePath:A,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:_})},O),t}},d=await v.handleResponse({req:e,nextConfig:f,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:I,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:i});if(!q)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==C.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",_?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return i&&q||u.delete(x.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(V,z,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};L?await l(L):await X.withPropagatedContext(e.headers,()=>X.trace(u.BaseServerSpan.handleRequest,{spanName:`${F} ${A}`,kind:o.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await v.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:_})}),q)throw t;return await (0,h.sendResponse)(V,z,new Response(null,{status:500})),null}}e.s(["handler",()=>_,"patchFetch",()=>O,"routeModule",()=>v,"serverHooks",()=>P,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>N],88693)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__6c6736e3._.js.map